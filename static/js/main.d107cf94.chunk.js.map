{"version":3,"sources":["components/StructureCardGrid.tsx","components/ranking/LineupWrapper.tsx","components/ranking/StructureImageRenderer.ts","components/ranking/StructureImageColumn.ts","components/StructureCard.tsx","components/LoadingPage.tsx","CollectionContext.tsx","components/HorizontalCollapse.tsx","components/form/InterpolationForm.tsx","components/FileUploadModal.tsx","App.tsx","InterpolationPage.tsx","components/PlotComponent.tsx","components/ButtonWithUpload.tsx","components/JSMEModal.tsx","components/UseStructureInputAddon.tsx","components/CurveEditorModal.tsx","components/form/MSOForm.tsx","components/form/ComputeEmbeddingsForm.tsx","components/form/SubstructureMatchingForm.tsx","components/form/TanimotoForm.tsx","components/GridItemOptions.tsx","components/Grid.tsx","components/ParallelCoordinatesPlot.tsx","components/LocalNeighborhoodPlot.tsx","components/GroupFlowSankeyPlot.tsx","ClusterSidePanel.tsx","components/ScatterPlot.tsx","components/form/MatchedMolecularPairsForm.tsx","components/form/NeighborSamplingForm.tsx","components/form/RecomputeEmbeddingsForm.tsx","components/form/StonedSelfiesForm.tsx","components/PlotSelect.tsx","components/PlotSelectJaccardExtension.tsx","components/PlotSelectNNDiffExtension.tsx","components/PlotSelectKNNExtension.tsx","components/PlotSelectClusterExtension.tsx","components/PlotSelectEvalExtension.tsx","components/form/ProjectionSettingsForm.tsx","components/ProjectionSettingsModal.tsx","EmbeddingPage.tsx","reportWebVitals.ts","index.tsx","utils/api.tsx","utils/hooks.tsx","components/form/DetailsSummaryWrapper.tsx","components/form/FormWrapper.tsx","utils/index.ts","components/StructureImage.tsx","utils/constants.ts","interfaces.tsx"],"names":["StructureCardGridUnwrapped","collections","structureCardProps","tableClass","renderTopForm","setSelected","selected","setFiltered","initialMode","React","cardSize","setCardSize","mode","setMode","external","setExternal","counter","setCounter","gridSize","className","style","height","type","title","onClick","c","role","disabled","marginRight","onSelectionSet","lineup","rankings","selectionColumn","find","col","SelectionColumn","getSortCriteria","length","isSortedByMe","asc","sortByMe","display","gridTemplateColumns","gridAutoRows","gridGap","map","collection","data","flat","structure","i","full","structures","undefined","StructureCardGrid","buildDefaultRanking","rankingBuilder","buildRanking","supportTypes","allColumns","LineupWrapper","getRankingBuilders","adjustRankings","align","innerProps","divRef","lineupRef","rankingRef","indexMapRef","disableLineUpSelectionListener","setSelectedRef","useSyncedRef","setFilteredRef","onSelectionSetRef","mergedData","reduce","acc","cur","forEach","d","push","_dataset","name","_particle","current","destroy","rankingBuilders","b","builder","animated","castArray","ranking","aggregationStrategy","propagateAggregationState","registerColumnType","StructureImageColumn","registerRenderer","StructureImageRenderer","livePreviews","filter","sidePanel","dynamicHeight","defaultHeight","padding","deriveColumns","column","buildStringColumn","label","renderer","width","build","mergedDataProperties","properties","propertyWithMostEntries","Object","keys","lazyColumns","key","getOwnPropertyDescriptor","propertiesBuilder","includes","columns","groupRenderer","buildTaggle","imageColumn","getRenderer","console","error","debouncedWidthChanged","debounce","prev","Math","min","max","update","debouncedFilterChanged","hasSubstructureMatch","then","matches","validSmiles","entries","counts","smiles","setFilter","valid","Set","filterMissing","catch","e","on","Column","EVENT_WIDTH_CHANGED","StringColumn","EVENT_FILTER_CHANGED","rowsToSelection","rows","LineUp","EVENT_SELECTION_CHANGED","a","view","getSelection","disableTrigger","LocalDataProvider","EVENT_ADD_COLUMN","index","columnName","desc","toLowerCase","lazy","createdColumnDesc","createdColumn","getFirstRanking","insertAfter","create","markDirty","EVENT_ORDER_CHANGED","oldSelection","newSelection","isEqual","slice","sort","getRankings","set","Map","structureColumn","flatColumns","setAlign","selectedIndices","values","p","get","setSelection","ref","flex","fontSize","template","svgToImageSrc","svg","btoa","svgToCSSBackground","ERenderMode","CELL","GROUP","n","renderMissingDOM","v","images","backgroundImage","value","getValue","abortAble","Promise","resolve","setTimeout","image","getImageURL","getFilter","getAlign","href","context","group","tasks","groupRows","getReducedImages","Array","from","row","getLabel","res","structureFilter","this","isFiltered","has","size","fire","EVENT_DIRTY_VALUES","EVENT_DIRTY","StructureCard","enableModeSwitch","_enableModeSwitch","showProperties","singleMode","setSingleMode","Boolean","s","toLocaleString","LoadingPage","children","loading","loadingText","fallback","flexDirection","overflow","animation","CollectionContext","HorizontalCollapse","position","collapsed","setCollapsed","oppositePosition","window","dispatchEvent","Event","collapseButton","top","InterpolationForm","open","setCollection","setStructures","setLoading","useNameInput","setName","nameInput","onSubmit","validStructures","interpolateStructures","serverCollection","htmlFor","id","onChange","currentTarget","split","join","curr","aria-hidden","FileUploadModal","setOpen","onSave","input","setInput","handleClose","handleSave","show","onHide","Header","closeButton","Title","Body","files","text","substr","Footer","variant","App","importFileModalShow","setImportFileModalShow","EActiveTabs","EMBEDDING","activeTab","setActiveTab","_setCollections","registry","setRegistry","offline","setOffline","interpolationStructures","setInterpolationStructures","getRegistry","setCollections","injectEval","object","func","injectGetter","eval","injectJaccard","embeddingName1","embeddingName2","nn","nn1","nearest_neighbors","nn2","Error","xIndices","knn_ind","yIndices","x","injectNNDiff","embeddingName","property","method","knn_particles","ARRAY_DISTANCE_METRICS","injectCluster","cluster","clusters","startsWith","isProxySymbol","Proxy","obj","prop","propertyValue","lookup","particle","abs","nearestNeighbors","distance_metric","knn_dist","importedDataset","default","interpolationCollection","setInterpolationCollection","Provider","collapseOnSelect","expand","bg","Brand","Toggle","aria-controls","Collapse","Link","active","onSelect","INTERPOLATION","Text","color","marginLeft","downloadJSONFile","JSON","parse","InterpolationPage","useState","optionsCollapsed","setOptionsCollapsed","scaffold","PlotComponent","plotComponentFactory","Plotly","PLOTLY_CONFIG","displaylogo","responsive","showLink","ButtonWithUpload","onUploadData","onUploadResult","uploadModalOpen","setUploadModalOpen","Dropdown","as","ButtonGroup","drop","Button","Menu","Item","JSMEModal","initialSmiles","setSmiles","showJSME","setShowJSME","bodyRef","timeout","clearTimeout","Modal","getBoundingClientRect","options","src","UseStructureInputAddon","selection","setValue","editorOpen","setEditorOpen","VIEWBOX_SIZE","CurveEditorModal","initialPoints","points","setPoints","setMin","setMax","inputMin","setInputMin","inputMax","setInputMax","y","toString","extent","minimum","maximum","scales","scaleLinear","domain","range","clamp","alignItems","flexFlow","justifyContent","preventDefault","stopPropagation","valueAsNumber","viewBoxSize","curveType","DEFAULT_CURVE_TYPES","MSOForm","availableObjectives","addCollection","msoStartingStructure","setMsoStartingStructure","nrOfParticles","setNrOfParticles","nrOfIterations","setNrOfIterations","nrOfSwarms","setNrOfSwarms","vMin","setVMin","vMax","setVMax","inertiaWeight","setInertiaWeight","phi1","setPhi1","phi2","setPhi2","phi3","setPhi3","selectedObjective","setSelectedObjective","objectives","setObjectives","desirabilityCurveObjective","setDesirabilityCurveObjective","FormWrapper","runMSO","iterations","num_swarms","num_part","v_min","v_max","inertia_weight","msoCollection","desirability","o","required","overflowX","objective","additional_args","description","step","weight","placeholder","aria-describedby","Alert","ComputeEmbeddingsForm","cdddInput","setCdddInput","additional","result","header","skipEmptyLines","dynamicTyping","transformHeader","trim","toLocaleLowerCase","transform","field","meta","fields","rest","embeddings","embedStructures","include_embedding","newCollection","additionalProperties","original_structure","DEFAULT_COLLECTION","SubstructureMatchingForm","smarts","setSmarts","computeSubstructures","all","results","validity","TanimotoForm","similarityRef","setSimilarityRef","similaryFP","setSimilarityFP","getTanimotoSimilarity","tanimoto","reference","embedding","availableEmbeddings","pow","GridItemOptions","gridOptions","onClose","onSettings","renderInfo","enableMove","zIndex","left","cursor","OverlayTrigger","trigger","placement","overlay","Popover","SizedGridLayout","WidthProvider","GridLayout","Grid","_children","layout","setLayout","isArray","validChildren","missingLayout","l","h","w","props","draggableHandle","cols","rowHeight","verticalCompact","compactType","onLayoutChange","ParallelCoordinatesPlot","filterSelection","figureState","setFigureState","enabledProperties","setEnabledProperties","colorProperty","setColorProperty","constraintRange","setConstraintRange","filteredCollections","hidden","availableProperties","filtered","newFigureState","frames","autosize","colorway","DEFAULT_COLORWAY","showlegend","line","showscale","DEFAULT_PLOTLY_COLORSCALE","fill","dimensions","order","minValue","maxValue","reverse","constraintrange","log","menuPosition","isMulti","openMenuOnClick","closeMenuOnSelect","formatOptionLabel","option","maxWidth","isClearable","allSelected","config","onRestyle","dim","every","some","onUpdate","figure","newOrdering","LocalNeighborhoodPlot","hover","setHover","referenceEmbedding","setReferenceEmbedding","enabledEmbeddings","setEnabledEmbeddings","allAvailableProperties","filteredAvailableEmbeddings","sortBy","distanceColumn","NumberColumn","Infinity","indexOccurances","selectionCollections","originalParticle","Occurances","indexOf","setSelectedFromLineup","normalizedDistances","fromEntries","normalizeArray","referenceIndexToDist","referenceNN","plotDataLines","previousKey","previousValue","previousInd","ind","previousX","legendgroup","opacity","plotDataSelection","selectedXValues","NaN","isNaN","marker","plotDataScatter","toNumber","dist","hoverinfo","customdata","selectedpoints","coloraxis","getPointsFromEvent","StructureImage","dragmode","hovermode","legend","orientation","colorbar","titleside","thickness","outlinewidth","lenmode","len","yanchor","scene","aspectmode","margin","r","t","yaxis","categoryorder","categoryarray","onSelected","onHover","onUnhover","LAYOUT","GroupFlowSankeyPlot","setSelectionCollections","valueIndex","labels","valueLookup","clear","matrix","assignments","next","currentIndex","link","source","target","toValues","particles","to","arrangement","node","backgroundColor","isDisabled","hoveredPoints","ClusterSidePanel","setVisibleNeighborhoodSamplings","selectedParticles","concat","hoverOrSelected","lastHoverOrSelected","setHoverOrLastSelected","selectionCollection","visibleProjectionModels","setVisibleProjectionModels","recomputeEmbeddings","setRecomputeEmbeddings","removeFromOriginal","setRemoveFromOriginal","includeNeighbors","setIncludeNeighbors","newCollectionLoading","setNewCollectionLoading","showStructures","setShowStructures","rankingSelection","setRankingSelection","heatmapData","setHeatmapData","heatmapLoading","setHeatmapLoading","heatmapHover","setHeatmapHover","heatmapHoverIndices","setHeatmapHoverIndices","parallelCoordinatesCollections","setParallelCoordinatesCollections","structuresToShow","filteredParticles","groupByLodash","model","dialogClassName","visibility","gap","pointIndex","z","originalZ","emptyZ","xanchor","pad","xaxis","scaleanchor","visible","autorange","displayModeBar","Tabs","defaultActiveKey","unmountOnExit","Tab","eventKey","projections","downloadCSVFile","selectedWithEmbeddings","cdddSimilarities","selectedStructures","tanimotoSimilaritiesRaw","tanimotoSimilarities","reversescale","zmin","zmax","colorscale","neighbors","cloneDeepWith","stack","oldCollections","checked","TRAJECTORY_TRACE_NAME","ScatterPlot","xAccessor","yAccessor","debouncedHover","innerHover","setInnerHover","setHoverRef","traces","connectBy","delete","isHover","knnHoverFields","isKNNHover","selectedInstancesByConnectBy","allInstances","allSizes","allColors","lineOpacityScaling","scaleSymlog","hoverColor","darker","lineColor","copy","sizeScaling","groups","groupBy","instances","lodashGet","instanceScaler","_","allBorderColors","shape","existing","annotatedCollections","plotOptions","colorBy","opacityBy","sizeBy","constantOpacity","colorExtent","opacityExtent","sizeExtent","toExtent","sizeref","bgcolor","existingData","indices","extendedParticles","ys","cmin","cmax","symbol","sizemin","sizemax","transforms","styles","localeCompare","stringify","particleIndex","handledIndices","curveNumber","add","onDeselect","MatchedMolecularPairsForm","setStructure","substructure","setSubstructure","minVariableSize","setMinVariableSize","maxVariableSize","setMaxVariableSize","minConstantSize","setMinConstantSize","minRadius","setMinRadius","minPairs","setMinPairs","rel","getMatchedMolecularPairs","min_variable_size","max_variable_size","min_constant_size","min_radius","min_pairs","embeddedCollection","NeighborSamplingForm","setVisible","setMethod","nr","setNr","scale","setScale","computeNeighborSamples","getNeighborSamples","similarity","neighborhoodSimilarity","sqrt","sample","floor","border","RecomputeEmbeddingsForm","setFrom","projection","setProjection","setTo","recomputeProjections","computeProjectionsWithModels","recomputedParticles","toName","newTo","newFrom","collectionsWithProjections","collectionsWithEmbeddings","StonedSelfiesForm","randomSamples","setRandomSamples","maxMutations","setMaxMutations","getStonedSelfies","random_samples","max_mutations","PlotSelect","inline","multi","setOption","availableNearestNeighbors","availableClusters","extensions","whiteSpace","minWidth","menu","base","onCreateOption","additionalOptions","component","PlotSelectJaccardExtension","jaccardEmb1","jaccardEmb2","jaccardNN","PlotSelectNNDiffExtension","emb","PlotSelectKNNExtension","PlotSelectClusterExtension","PlotSelectEvalExtension","ProjectionSettingsForm","setConfig","availableProjections","availableOpacityProperties","availableConnectByProperties","uniqueId","colorCoding","ProjectionSettingsModal","oldConfig","EmbeddingPage","allParticles","visibleNeighborhoodSamplings","enabledProjections","setEnabledProjections","editProjection","setEditProjection","_setSelection","_setParticleSelected","setPlotOptions","customX","setCustomX","customY","setCustomY","customPlotSettings","setCustomPlotSettings","showSelectedOnly","setShowSelectedOnly","visibleCollections","latentSpaceCollections","latentX","latentY","gutterSize","sizes","paddingLeft","onDragEnd","paddingRight","setter","newConfig","pickBy","bottom","toUpperCase","newOption","toFixed","handleWidth","reportWebVitals","onPerfEntry","Function","getCLS","getFID","getFCP","getLCP","getTTFB","ReactDOM","render","StrictMode","document","getElementById","fetchRaw","url","fetch","headers","redirect","body","stringifyWithoutCycles","ok","json","message","statusText","fetchJSON","fetchText","maxSamples","encodeURIComponent","models","fingerprint","samples","valueRef","Tooltip","anchor","setNode","setPosition","setFromEvent","throttle","clientX","clientY","addEventListener","removeEventListener","useMousePosition","container","createElement","pointerEvents","appendChild","removeChild","initialValue","uniqueRef","currentName","replaceAll","nameAlreadyTaken","pattern","DetailsSummaryWrapper","lead","setError","reportValidity","dismissible","list","def","parseFloat","getter","downloadFile","blob","URL","createObjectURL","download","click","Blob","valueCreator","cache","defineProperty","configurable","enumerable","setSrc","alt","onLoad","onError","euclidean_difference","mean","mean_rel_diff","mean_rel_diff_log10","log10","max_difference","min_difference","Symbol"],"mappings":"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","file":"static/js/main.d107cf94.chunk.js","sourcesContent":["import { SelectionColumn } from \"lineupjs\";\nimport * as React from \"react\";\nimport { ICollection, IParticle, IParticleSelection } from \"../interfaces\";\nimport { ExternalViewPortal } from \"./ExternalViewPortal\";\nimport { LineupWrapper } from \"./ranking/LineupWrapper\";\nimport { StructureCard } from \"./StructureCard\";\n\nconst StructureCardGridUnwrapped = <T extends IParticle>({\n  collections,\n  structureCardProps,\n  tableClass,\n  renderTopForm,\n  setSelected,\n  selected,\n  setFiltered,\n  initialMode = \"table\",\n}: {\n  collections: ICollection<T>[];\n  setCollections?(collections: ICollection<T>[]): void;\n  structureCardProps?: (structure: T, index: number) => React.HTMLAttributes<HTMLDivElement>;\n  tableClass?: string;\n  renderTopForm?: React.ReactNode;\n  selected?: IParticleSelection;\n  setSelected?: (selected: IParticleSelection) => void;\n  setFiltered?: (selected: IParticleSelection) => void;\n  initialMode?: \"table\" | \"grid\";\n}) => {\n  const [cardSize, setCardSize] = React.useState<\"large\" | \"medium\" | \"small\">(\"small\");\n  const [mode, setMode] = React.useState<\"table\" | \"grid\">(initialMode);\n  const [external, setExternal] = React.useState<boolean>(false);\n  const [counter, setCounter] = React.useState<number>(0);\n\n  const gridSize = cardSize === \"large\" ? \"12rem\" : cardSize === \"medium\" ? \"9em\" : \"6em\";\n\n  return (\n    // <ExternalViewPortal active={external} onWindowClosed={() => setExternal(false)}>\n      <div className=\"d-flex flex-column\" style={{ height: \"100%\" }}>\n        <form className=\"row mb-2 mt-2\">\n          <div className=\"col flex-row d-flex\">\n            {renderTopForm}\n          </div>\n          <div className=\"col d-flex justify-content-end\">\n            <button\n              type=\"button\"\n              title=\"Force update ranking\"\n              className={`btn btn-sm btn-light ms-2 me-2`}\n              onClick={() => setCounter((c) => c+1)}\n            >\n              <i className=\"fas fa-fw fa-sync-alt\" />\n            </button>\n            {!external ? (\n              <button\n                type=\"button\"\n                title=\"Open as new window\"\n                className={`btn btn-sm btn-light ms-2 me-2`}\n                onClick={() => setExternal(true)}\n              >\n                <i className=\"fas fa-fw fa-external-link-square-alt\" />\n              </button>\n            ) : null}\n            <div className=\"btn-group btn-group-sm ms-2 me-2\" role=\"group\">\n              <button\n                type=\"button\"\n                className={`btn btn-light ${mode === \"table\" ? \"active\" : \"\"}`}\n                onClick={() => setMode(\"table\")}\n              >\n                <i className=\"fas fa-fw fa-table\" />\n              </button>\n              <button\n                type=\"button\"\n                className={`btn btn-light ${mode === \"grid\" ? \"active\" : \"\"}`}\n                onClick={() => setMode(\"grid\")}\n              >\n                <i className=\"fas fa-fw fa-th\" />\n              </button>\n            </div>\n            <div className=\"btn-group btn-group-sm ms-2\" role=\"group\">\n              <button\n                type=\"button\"\n                className={`btn btn-light ${cardSize === \"large\" ? \"active\" : \"\"}`}\n                disabled={mode !== \"grid\"}\n                onClick={() => setCardSize(\"large\")}\n              >\n                <i className=\"fas fa-fw fa-grip-vertical\" />\n              </button>\n              <button\n                type=\"button\"\n                className={`btn btn-light ${cardSize === \"medium\" ? \"active\" : \"\"}`}\n                disabled={mode !== \"grid\"}\n                onClick={() => setCardSize(\"medium\")}\n              >\n                <i className=\"fas fa-fw fa-th\" />\n              </button>\n              <button\n                type=\"button\"\n                className={`btn btn-light ${cardSize === \"small\" ? \"active\" : \"\"}`}\n                disabled={mode !== \"grid\"}\n                onClick={() => setCardSize(\"small\")}\n              >\n                <i className=\"fas fa-fw fa-grip-vertical\" style={{ marginRight: \"0.15em\" }} />\n                <i className=\"fas fa-fw fa-grip-vertical\" />\n              </button>\n            </div>\n          </div>\n        </form>\n        <LineupWrapper\n          key={counter}\n          collections={collections}\n          setSelected={setSelected}\n          selected={selected}\n          setFiltered={setFiltered}\n          className={`lineup-wrapper ${mode !== \"table\" ? \"d-none\" : \"\"} ${tableClass || \"\"}`}\n          onSelectionSet={(lineup, rankings) => {\n            const selectionColumn = rankings?.[0].find((col) => col instanceof SelectionColumn);\n            // Only sort by the selection column if it was not changed\n            if (rankings[0]?.getSortCriteria().length === 0 || selectionColumn?.isSortedByMe()?.asc) {\n              // Trigger it twice to force a resort in lineup, otherwise it does not reapply the sort.\n              selectionColumn?.sortByMe(true);\n              selectionColumn?.sortByMe(false);\n            }\n          }}\n        />\n        {mode === \"grid\" ? (\n          <div\n            style={{\n              display: mode !== \"grid\" ? \"none\" : \"grid\",\n              gridTemplateColumns: `repeat(auto-fill, minmax(${gridSize}, 1fr))`,\n              gridAutoRows: \"auto\",\n              gridGap: \"1rem\",\n            }}\n          >\n            {collections\n              .map((collection) => collection.data)\n              .flat()\n              .map((structure, i, full) => (\n                <StructureCard\n                  key={i}\n                  structure={structure}\n                  structures={i > 0 ? [structure, full[i - 1]] : undefined}\n                  {...(structureCardProps?.(structure, i) || {})}\n                />\n              ))}\n          </div>\n        ) : null}\n      </div>\n    // </ExternalViewPortal>\n  );\n};\n\nexport const StructureCardGrid = React.memo(StructureCardGridUnwrapped) as typeof StructureCardGridUnwrapped;\n","import * as React from \"react\";\nimport LineUp, {\n  builder,\n  buildRanking,\n  buildStringColumn,\n  Column,\n  IColumnDesc,\n  LocalDataProvider,\n  Taggle,\n  Ranking,\n  StringColumn,\n  IStringFilter,\n  RankingBuilder,\n} from \"lineupjs\";\nimport { ICollection, IParticle, IParticleSelection } from \"../../interfaces\";\nimport debounce from \"lodash.debounce\";\nimport { useSyncedRef } from \"../../utils/hooks\";\nimport { StructureImageRenderer } from \"./StructureImageRenderer\";\nimport { StructureImageColumn } from \"./StructureImageColumn\";\nimport { hasSubstructureMatch } from \"../../utils/api\";\nimport isEqual from \"lodash.isequal\";\nimport castArray from \"lodash.castarray\";\n\nexport const buildDefaultRanking = () => {\n  const rankingBuilder = buildRanking();\n  rankingBuilder.supportTypes();\n  rankingBuilder.allColumns();\n  return rankingBuilder;\n};\n\nexport const LineupWrapper = ({\n  collections,\n  getRankingBuilders = buildDefaultRanking,\n  adjustRankings,\n  setSelected,\n  align,\n  selected,\n  setFiltered,\n  onSelectionSet,\n  ...innerProps\n}: {\n  collections: ICollection[];\n  getRankingBuilders?: () => RankingBuilder | RankingBuilder[];\n  align?: string;\n  adjustRankings?: (lineup: Taggle, rankings: Ranking[]) => void;\n  setSelected?: (selection: IParticleSelection) => void;\n  selected?: IParticleSelection;\n  setFiltered?: (filtered: IParticleSelection) => void;\n  onSelectionSet?: (lineup: Taggle, rankings: Ranking[]) => void;\n} & React.HTMLAttributes<HTMLDivElement>) => {\n  const divRef = React.useRef<HTMLDivElement>(null);\n  const lineupRef = React.useRef<Taggle | null>(null);\n  const rankingRef = React.useRef<Ranking[] | null>(null);\n  const indexMapRef = React.useRef<Map<IParticle, number> | null>(null);\n  const disableLineUpSelectionListener = React.useRef<boolean>(false);\n\n  const setSelectedRef = useSyncedRef(setSelected);\n  const setFilteredRef = useSyncedRef(setFiltered);\n  const onSelectionSetRef = useSyncedRef(onSelectionSet);\n\n  // Reduce the collections to an array of objects with a dataset property\n  const mergedData = React.useMemo(\n    () =>\n      collections.reduce<(IParticle & { _dataset: string; _particle: IParticle } & Record<string, unknown>)[]>((acc, cur) => {\n        cur.data.forEach((d) =>\n          acc.push({\n            ...d,\n            _dataset: cur.name,\n            _particle: d,\n          })\n        );\n        return acc;\n      }, []),\n    [collections]\n  );\n\n  React.useEffect(() => {\n    lineupRef.current?.destroy();\n\n    const DEFAULT_HEIGHT = 18;\n    let height = 36;\n\n    const rankingBuilders = getRankingBuilders();\n\n    const b = builder(mergedData).animated(false);\n    castArray(rankingBuilders).forEach((builder) => b.ranking(builder));\n    b.aggregationStrategy(\"group+item+top\")\n      .propagateAggregationState(true)\n      .registerColumnType(\"structureImage\", StructureImageColumn)\n      .registerRenderer(\"structureImage\", new StructureImageRenderer())\n      .livePreviews({\n        filter: false,\n      })\n      .sidePanel(true, true)\n      // .deriveColors()\n      .dynamicHeight(() => ({\n        defaultHeight: DEFAULT_HEIGHT,\n        height: () => height,\n        padding: () => 0,\n      }));\n\n    b.deriveColumns(\"_dataset\");\n\n    // Use image column as link and text instead\n    // b.column(\n    //   buildStringColumn(\"structure\")\n    //     .label(\"Structure\")\n    //     // eslint-disable-next-line no-template-curly-in-string\n    //     .pattern(\"https://pubchem.ncbi.nlm.nih.gov/#query=${value}\")\n    //     .build([])\n    // );\n\n    b.column({\n      ...buildStringColumn(\"structure\")\n        .label(\"Structure\")\n        .renderer(\"structureImage\", \"structureImage\")\n        .width(height * 3)\n        .build([]),\n      type: \"structureImage\",\n    });\n\n    // TODO: I really don't like that, but Lineup infers the columns by the *first* entry in the data.\n    // So here we move the object with the most properties to the first position. We should probably create a \"merged\" object for that.\n    // https://github.com/lineupjs/lineupjs/blob/develop/src/provider/utils.ts#L268-L269\n    const mergedDataProperties = mergedData.map(({ properties = {} }) => properties);\n    const propertyWithMostEntries =\n      mergedDataProperties.reduce<Record<string, unknown> | null>((acc, cur) => {\n        return !acc || Object.keys(acc!).length < Object.keys(cur).length ? cur : acc;\n      }, null) || {};\n\n    const lazyColumns = Object.keys(propertyWithMostEntries).filter(\n      (key) => Object.getOwnPropertyDescriptor(propertyWithMostEntries, key)![\"get\"]\n    );\n    const eagerColumns = Object.keys(propertyWithMostEntries).filter((key) => !lazyColumns.includes(key));\n    // console.log(propertyWithMostEntries, lazyColumns, eagerColumns);\n    // The properties are a nested object, so we derive it using the builder and then inject the 'properties.' in the column.\n    const propertiesBuilder = builder([propertyWithMostEntries, ...mergedDataProperties]).deriveColumns();\n    // lazyColumns.forEach((col) =>\n    //   propertiesBuilder.column(buildNumberColumn(col).custom(\"visible\", false).custom(\"lazy\", true).build([]))\n    // );\n\n    // @ts-ignore\n    const propertiesColumns = (propertiesBuilder.columns as IColumnDesc[]).map(\n      // @ts-ignore\n      (col) => ({ ...col, column: `properties.${col.column}` })\n    );\n    propertiesColumns.forEach((col) => b.column(col));\n\n    // Change the default renderer of the embedding column\n    // TODO: Adjust to multiple embeddings\n    // b.deriveColumns(\"embedding\");\n    // @ts-ignore\n    (b.columns as IColumnDesc[]).forEach((col) => {\n      // Patch the default renderer for all numbers columns\n      if (col.type === \"numbers\") {\n        col.renderer = \"histogram\"; // verticalbar is nice but slow..\n        col.groupRenderer = \"histogram\"; // verticalbar is nice but slow..\n      }\n      if (col.type === \"number\") {\n        col.groupRenderer = \"histogram\"; // boxplot is nice but slow..\n      }\n    });\n\n    // Build the ranking\n    const lineup = b.buildTaggle(divRef.current!);\n\n    // Lookup the image column\n    const imageColumn: StructureImageColumn | null = lineup.data.find(\n      (col) => col.getRenderer() === \"structureImage\"\n    ) as StructureImageColumn | null;\n    if (!imageColumn) {\n      console.error(\"Column with image renderer not found. Autoresizing disabled.\");\n    }\n    const debouncedWidthChanged = debounce((prev, cur) => {\n      // Adjust the height according to the image column\n      height = Math.min(Math.max(DEFAULT_HEIGHT, (cur - 0) / 3), 150);\n      lineup.update();\n    }, 500);\n\n    const debouncedFilterChanged = debounce((prev, cur: IStringFilter) => {\n      const filter = typeof cur?.filter === \"string\" ? cur?.filter : null;\n      if (imageColumn && filter) {\n        hasSubstructureMatch(\n          mergedData.map((d) => d.structure),\n          filter\n        )\n          .then((matches) => {\n            // TODO: Race condition check\n            const validSmiles = Object.entries(matches.counts)\n              .filter(([smiles, count]) => count > 0)\n              .map(([smiles, count]) => smiles);\n            imageColumn.setFilter({\n              filter,\n              valid: new Set(validSmiles),\n              filterMissing: true,\n            });\n          })\n          .catch((e) => {\n            console.error(e);\n            imageColumn.setFilter(null);\n          });\n      }\n    }, 1000);\n    imageColumn?.on(Column.EVENT_WIDTH_CHANGED, debouncedWidthChanged);\n    imageColumn?.on(StringColumn.EVENT_FILTER_CHANGED, debouncedFilterChanged);\n\n    const rowsToSelection = (rows: any[]) => {\n      return rows.reduce<{ [key: string]: IParticle[] }>((acc, cur) => {\n        if (!acc[cur._dataset]) {\n          acc[cur._dataset] = [];\n        }\n        acc[cur._dataset].push(cur._particle);\n        return acc;\n      }, {});\n    };\n\n    // Listen to selection\n    lineup.on(LineUp.EVENT_SELECTION_CHANGED, async () => {\n      if (!disableLineUpSelectionListener.current) {\n        const data = rowsToSelection(await lineup.data.view(lineup.getSelection()));\n        setSelectedRef.current?.(Object.entries(data).length === 0 ? null : data);\n      }\n    });\n\n    let disableTrigger = false;\n    lineup.data.on(LocalDataProvider.EVENT_ADD_COLUMN, (col, index) => {\n      if (disableTrigger) {\n        return;\n      }\n      const columnName = col.desc.label.toLowerCase();\n      // @ts-ignore\n      if (col.desc.lazy) {\n        propertiesBuilder.deriveColumns(columnName);\n        // @ts-ignore\n        const createdColumnDesc = (propertiesBuilder.columns as IColumnDesc[])\n          // @ts-ignore\n          .filter((col) => col.column === columnName && !col.lazy)\n          .map(\n            // @ts-ignore\n            (col) => ({ ...col, column: `properties.${col.column}` })\n          )?.[0];\n        disableTrigger = true;\n        const createdColumn = lineup.data.getFirstRanking().insertAfter(lineup.data.create(createdColumnDesc)!, col);\n        disableTrigger = false;\n        createdColumn?.markDirty(\"all\");\n        lineup.update();\n      }\n    });\n\n    lineup.data.on(LocalDataProvider.EVENT_ORDER_CHANGED, async (oldSelection, newSelection) => {\n      if (newSelection.length === mergedData.length) {\n        setFilteredRef?.current?.(null);\n      } else if (!isEqual(oldSelection.slice().sort(), newSelection.slice().sort())) {\n        // If we actually filtered the table\n        setFilteredRef?.current?.(rowsToSelection(await lineup.data.view(newSelection)));\n      }\n    });\n\n    // @ts-ignore\n    lineupRef.current = lineup;\n    rankingRef.current = lineup.data.getRankings();\n\n    adjustRankings?.(lineupRef.current, rankingRef.current);\n\n    indexMapRef.current = mergedData.reduce((acc, cur, i) => {\n      acc.set(cur._particle, i);\n      return acc;\n    }, new Map());\n\n    return () => {\n      lineupRef.current?.destroy();\n    };\n  }, [collections, mergedData, setFilteredRef, setSelectedRef, getRankingBuilders, adjustRankings]);\n\n  React.useEffect(() => {\n    lineupRef.current?.data.getRankings().forEach((ranking) => {\n      const structureColumn = ranking.flatColumns.find((col) => col instanceof StructureImageColumn) as StructureImageColumn | undefined;\n      structureColumn?.setAlign(align || null);\n    })\n  }, [align]);\n\n  React.useEffect(() => {\n    if (lineupRef.current && rankingRef.current && indexMapRef.current) {\n      disableLineUpSelectionListener.current = true;\n      if (!selected) {\n        lineupRef.current.setSelection([]);\n      } else if (!isEqual(selected, lineupRef.current.getSelection())) {\n        const selectedIndices = Object.values(selected)\n          .flat()\n          .map((p) => indexMapRef.current!.get(p)!);\n        lineupRef.current.setSelection(selectedIndices);\n      }\n      onSelectionSetRef.current?.(lineupRef.current, rankingRef.current);\n      disableLineUpSelectionListener.current = false;\n    }\n  }, [selected, onSelectionSetRef]);\n\n  return (\n    <div\n      {...(innerProps || {})}\n      ref={divRef}\n      style={{\n        ...(innerProps?.style || {}),\n        flex: 1,\n        fontSize: \"smaller\",\n      }}\n    ></div>\n  );\n};\n","import {\n  ICellRendererFactory,\n  ERenderMode,\n  ICellRenderer,\n  IDataRow,\n  IRenderContext,\n  IGroupCellRenderer,\n  IOrderedGroup,\n  renderMissingDOM,\n} from \"lineupjs\";\nimport { getImageURL, getReducedImages } from \"../../utils/api\";\nimport { StructureImageColumn } from \"./StructureImageColumn\";\nimport { abortAble } from \"lineupengine\";\n\nconst template =\n  '<a target=\"_blank\" rel=\"noopener\" style=\"background-size: contain; background-position: center; background-repeat: no-repeat;\"></a>';\n\nexport function svgToImageSrc(svg: string): string {\n  return `data:image/svg+xml;base64,${btoa(svg)}`;\n}\n\nexport function svgToCSSBackground(svg: string): string {\n  return `url('${svgToImageSrc(svg)}')`;\n}\n\nexport class StructureImageRenderer implements ICellRendererFactory {\n  readonly title: string = \"Chemical Structure\";\n\n  canRender(col: StructureImageColumn, mode: ERenderMode): boolean {\n    return col instanceof StructureImageColumn && (mode === ERenderMode.CELL || mode === ERenderMode.GROUP);\n  }\n\n  create(col: StructureImageColumn): ICellRenderer {\n    return {\n      template,\n      update: (n: HTMLLinkElement, d: IDataRow) => {\n        if (!renderMissingDOM(n, col, d)) {\n          if(d.v.images?.[0]) {\n            n.style.backgroundImage = svgToCSSBackground(d.v.images[0]);\n            return;\n          }\n          const value = col.getValue(d)!;\n          // Load aysnc to avoid triggering\n          return abortAble(new Promise((resolve) => setTimeout(() => resolve(value), 500))).then((image) => {\n            if (typeof image === \"symbol\") {\n              return;\n            }\n            n.style.backgroundImage = `url('${getImageURL(value, col.getFilter()?.filter, col.getAlign())}')`;\n            n.title = value;\n            n.href = `https://pubchem.ncbi.nlm.nih.gov/#query=${value}`;\n          });\n        }\n      },\n    };\n  }\n\n  createGroup(col: StructureImageColumn, context: IRenderContext): IGroupCellRenderer {\n    return {\n      template,\n      update: (n: HTMLImageElement, group: IOrderedGroup) => {\n        context.tasks.groupRows(col, group, \"StructureImageRendererGroup\", (rows) => {\n          return abortAble(getReducedImages(Array.from(rows.map((row) => col.getLabel(row))))).then((res: any) => {\n            n.style.backgroundImage = res ? svgToCSSBackground(res) : \"\";\n          });\n        });\n      },\n    };\n  }\n}\n","import { StringColumn, IDataRow, IStringFilter, Column } from \"lineupjs\";\nimport { isEqual } from \"lodash\";\n\nexport interface IStructureFilter extends IStringFilter {\n  filter: string;\n  valid: Set<string>;\n}\n\nexport class StructureImageColumn extends StringColumn {\n  protected structureFilter: IStructureFilter | null = null;\n  protected align: string | null = null;\n\n  filter(row: IDataRow): boolean {\n    if (!this.isFiltered()) {\n      return true;\n    }\n    return this.structureFilter!.valid.has(this.getLabel(row));\n  }\n\n  isFiltered(): boolean {\n    return this.structureFilter != null && this.structureFilter.valid?.size > 0;\n  }\n\n  getFilter() {\n    return this.structureFilter!;\n  }\n\n  setFilter(filter: IStructureFilter | null) {\n    if (isEqual(filter, this.structureFilter)) {\n      return;\n    }\n\n    this.fire(\n      [StringColumn.EVENT_FILTER_CHANGED, Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      this.structureFilter,\n      (this.structureFilter = filter)\n    );\n  }\n\n  getAlign(): string | null {\n    return this.align;\n  }\n\n  setAlign(structure: string | null): void {\n    if (isEqual(structure, this.align)) {\n      return;\n    }\n    \n    this.fire(\n      [Column.EVENT_DIRTY_VALUES, Column.EVENT_DIRTY],\n      (this.align = structure)\n    );\n  }\n}\n","import * as React from \"react\";\nimport { IParticle } from \"../interfaces\";\nimport { StructureImage } from \"./StructureImage\";\n\nexport const StructureCard = React.memo(\n  ({\n    structure,\n    structures,\n    enableModeSwitch: _enableModeSwitch = true,\n    showProperties = true,\n    ...innerProps\n  }: {\n    structure: IParticle;\n    structures?: IParticle[];\n    enableModeSwitch?: boolean;\n    showProperties?: boolean;\n  } & React.HTMLAttributes<HTMLDivElement>) => {\n    const [singleMode, setSingleMode] = React.useState<boolean>(true);\n    const enableModeSwitch = _enableModeSwitch && Boolean(structures);\n\n    return (\n      <div {...innerProps} className={`card structure-card ${innerProps?.className || \"\"}`}>\n        <StructureImage\n          role={enableModeSwitch ? \"button\" : undefined}\n          title={enableModeSwitch ? \"Switch molecule view\" : undefined}\n          onClick={enableModeSwitch ? () => setSingleMode(!singleMode) : undefined}\n          className=\"card-img-top\"\n          // TODO: Support proper switching between all images\n          structure={singleMode || !enableModeSwitch ? structure.structure : structures!.map((s) => s.structure)}\n          image={singleMode || !enableModeSwitch ? structure.images?.[singleMode ? 0 : 1] : undefined}\n        />\n        <div className=\"card-body\" style={{ padding: \"0.25rem\" }}>\n          <h5 className=\"card-title text-truncate\">{structure.structure}</h5>\n          <div className=\"card-text\">\n            {showProperties\n              ? Object.entries(structure?.properties || {}).map(([key, value]) => (\n                  <div className=\"text-truncate\" title={`${key} ${value?.toLocaleString()}`}>\n                    <strong>{key}</strong> {value?.toLocaleString()}\n                  </div>\n                ))\n              : null}\n          </div>\n        </div>\n      </div>\n    );\n  }\n);\n","import * as React from \"react\";\nimport { Spinner } from \"react-bootstrap\";\n\nexport function LoadingPage({\n  children = null,\n  loading,\n  loadingText,\n  fallback = null,\n}: {\n  children?: React.ReactNode;\n  loading: boolean;\n  loadingText?: React.ReactNode;\n  fallback?: React.ReactNode;\n}) {\n  if (!loading && children) {\n    return <>{children}</>;\n  }\n\n  return (\n    <div\n      className=\"d-flex align-items-center justify-content-center\"\n      style={{ flexDirection: \"column\", flex: 1, overflow: \"auto\" }}\n    >\n      {loading ? (\n        <>\n          <Spinner animation=\"border\" className=\"mb-1\" />\n          {loadingText}\n        </>\n      ) : (\n        fallback\n      )}\n    </div>\n  );\n}\n","import * as React from 'react';\nimport { ICollection } from './interfaces';\n\nexport const CollectionContext = React.createContext<ICollection[]>([]);\n","import * as React from \"react\";\n\nexport function HorizontalCollapse({\n  label,\n  position,\n  collapsed,\n  setCollapsed,\n  children,\n  size,\n}: {\n  label: string;\n  position: \"left\" | \"right\";\n  collapsed: boolean;\n  size: string;\n  setCollapsed: React.Dispatch<React.SetStateAction<boolean>>;\n  children: React.ReactNode;\n}) {\n  //   const [collapsed, setCollapsed] = React.useState<boolean>(true);\n\n  const oppositePosition = position === \"right\" ? \"start\" : \"end\";\n\n  React.useEffect(() => {\n    // Trigger a resize for plotly\n    window.dispatchEvent(new Event(\"resize\"));\n  }, [collapsed]);\n\n  const collapseButton = (\n    <button\n      onClick={() => {\n        setCollapsed((collapsed) => !collapsed);\n      }}\n      style={\n        {\n          //   zIndex: 1000,\n          // position: \"absolute\",\n          // top: 0,\n          // right: collapsed ? (position === 'right' ? 0 : undefined) : 0,\n          // // [position]: collapsed ? 0 : undefined,\n          // // [oppositePosition]: collapsed ? undefined : 0,\n        }\n      }\n      className=\"btn btn-sm btn-outline-primary\"\n    >\n      <i className={`fas fa-fw fa-long-arrow-alt-${collapsed ? (position === \"right\" ? \"up\" : \"down\") : position}`}></i>{\" \"}\n      {collapsed ? label : null}\n    </button>\n  );\n\n  return (\n    <>\n      {collapsed ? (\n        <div>\n          <div\n            style={{\n              position: \"absolute\",\n              top: 50,\n              //   [oppositePosition]: '100%',\n              [position]: 0,\n              whiteSpace: \"nowrap\",\n              transform: `rotate(270deg) translate(${position === \"right\" ? \"0, -100%\" : \"-100%, 0\"})`,\n              transformOrigin: `${position} 0`,\n              zIndex: 1000,\n            }}\n          >\n            {collapseButton}\n          </div>\n        </div>\n      ) : null}\n      {collapsed ? null : (\n        <div\n          className={`${size} ${collapsed ? \"\" : `border-${oppositePosition}`}`}\n          style={{ position: \"relative\", height: \"100%\", overflow: \"auto\" }}\n        >\n          <div className=\"sticky-top\">\n            {collapseButton}\n            {children}\n          </div>\n        </div>\n      )}\n    </>\n  );\n}\n","import * as React from \"react\";\nimport { ICollection, IInterpolatedParticle } from \"../../interfaces\";\nimport { interpolateStructures } from \"../../utils/api\";\nimport { FormWrapper } from \"./FormWrapper\";\nimport { StructureImage } from \"../StructureImage\";\nimport { useNameInput } from \"../../utils/hooks\";\n\nexport const InterpolationForm = ({\n    open,\n  setCollection,\n  structures,\n  setStructures,\n  loading,\n  setLoading,\n}: {\n  open?: boolean;\n  setCollection(collection: ICollection<IInterpolatedParticle>): void;\n  structures?: string[];\n  setStructures?(structures: string[]): void;\n  loading: boolean;\n  setLoading(loading: boolean): void;\n}) => {\n  const [name, setName, nameInput] = useNameInput(\"interpolationNameInput\", \"Interpolated\");\n\n  return (\n    <FormWrapper\n      open={open}\n      title=\"Interpolate between Structures\"\n      loading={loading}\n      setLoading={setLoading}\n      onSubmit={async () => {\n        const validStructures = structures?.filter(Boolean);\n        if (validStructures && validStructures.length > 0) {\n          setLoading(true);\n          const serverCollection = await interpolateStructures(validStructures, 100);\n          setCollection({\n            name,\n            ...serverCollection,\n          });\n          setName(\"\");\n        }\n        setLoading(false);\n      }}\n    >\n          {nameInput}\n          <div className=\"mb-3\">\n            <label htmlFor=\"inpolationStructures\">Structures (newline separated)</label>\n            <textarea\n              className=\"form-control form-control-sm\"\n              id=\"inpolationStructures\"\n              rows={3}\n              onChange={(e) => setStructures?.(e.currentTarget.value.split(\"\\n\"))}\n              value={structures?.join(\"\\n\") || \"\"}\n            />\n          </div>\n          <div className=\"text-center\">\n            {structures && structures.length > 0\n              ? structures\n                  .map<React.ReactNode>((structure) => (\n                    <StructureImage key={structure} structure={structure} width=\"70px\" height=\"70px\" />\n                  ))\n                  .reduce((prev, curr, i) => [\n                    prev,\n                    <i key={i} className=\"fas  fa-fw fa-long-arrow-alt-end ms-2 me-2\" />,\n                    curr,\n                  ])\n              : null}\n          </div>\n          <div className=\"text-end\">\n            <button className=\"btn btn-primary\" type=\"submit\" disabled={loading}>\n              {loading ? (\n                <>\n                  <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\"></span> Loading...\n                </>\n              ) : (\n                <>Compute Interpolation</>\n              )}\n            </button>\n          </div>\n    </FormWrapper>\n  );\n};\n","import * as React from \"react\";\nimport { Modal } from \"react-bootstrap\";\nimport { Button } from \"react-bootstrap\";\n\nexport function FileUploadModal({\n  open,\n  setOpen,\n  onSave,\n}: {\n  open: boolean;\n  setOpen?(show: boolean): void;\n  onSave?(value: string | null): void;\n}) {\n  const [input, setInput] = React.useState<string>(\"\");\n\n  const handleClose = React.useCallback(() => {\n    setOpen?.(false);\n  }, [setOpen]);\n\n  const handleSave = React.useCallback(() => {\n    onSave?.(input || null);\n  }, [onSave, input]);\n\n  return (\n    <>\n      <Modal show={open} onHide={handleClose} size=\"lg\">\n        <Modal.Header closeButton>\n          <Modal.Title>Upload dataset</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <form>\n            <div className=\"mb-3\">\n              <label htmlFor=\"customFileInput\">Either upload a file</label>\n                <input\n                  type=\"file\"\n                  className=\"form-control\"\n                  id=\"customFileInput\"\n                  onChange={(e) => {\n                    const files = Array.from(e.currentTarget.files || []);\n                    if (files.length === 1) {\n                      files[0].text().then((res) => {\n                        setInput(res);\n                      });\n                    }\n                  }}\n                />\n            </div>\n            <div className=\"mb-3\">\n              <label htmlFor=\"customFileTextarea\">Or paste the content</label>\n              <textarea\n                id=\"customFileTextarea\"\n                className=\"form-control\"\n                onChange={(e) => setInput(e.currentTarget.value)}\n                value={input.substr(0, 1000)}\n              />\n            </div>\n          </form>\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"secondary\" onClick={handleClose}>\n            Close\n          </Button>\n          <Button variant=\"primary\" onClick={handleSave}>\n            Upload\n          </Button>\n        </Modal.Footer>\n      </Modal>\n    </>\n  );\n}\n","import * as React from \"react\";\nimport { InterpolationPage } from \"./InterpolationPage\";\nimport { Navbar, Container, Form, Button, Nav } from \"react-bootstrap\";\nimport { EActiveTabs, ICollection, IInterpolatedParticle, INearestNeighbors, IParticle, IRegistry } from \"./interfaces\";\nimport { EmbeddingPage } from \"./EmbeddingPage\";\nimport { downloadJSONFile, injectGetter } from \"./utils\";\nimport { ARRAY_DISTANCE_METRICS, isProxySymbol } from \"./utils/constants\";\nimport { getRegistry } from \"./utils/api\";\nimport { FileUploadModal } from \"./components/FileUploadModal\";\nimport { CollectionContext } from \"./CollectionContext\";\n\nfunction App() {\n  const [importFileModalShow, setImportFileModalShow] = React.useState<boolean>(false);\n  const [activeTab, setActiveTab] = React.useState<EActiveTabs>(EActiveTabs.EMBEDDING);\n  const [collections, _setCollections] = React.useState<ICollection[]>([]);\n  const [registry, setRegistry] = React.useState<IRegistry | null>(null);\n  const [offline, setOffline] = React.useState<boolean>(false);\n  const [interpolationStructures, setInterpolationStructures] = React.useState<string[]>([\n    \"NC1CC1C(=O)c1ccc2ccccc2c1\",\n    \"O=C(CN1C(=O)CSc2ccc(S(=O)C3CC3)cc21)NCc1cccnc1\",\n  ]);\n\n\n  React.useEffect(() => {\n    getRegistry()\n      .then((registry) => setRegistry(registry))\n      .catch((e) => {\n        setOffline(true);\n        console.error(\"Error initializing registry\", e);\n      });\n  }, []);\n\n  const setCollections = React.useCallback(\n    (collections: ICollection[]) => {\n      collections.forEach((collection) => {\n        collection.data.forEach((p, i) => {\n          p.index = i;\n          p.collection = collection.name;\n        });\n        collection.data.forEach((p, i) => {\n          // Remove jaccard distances\n          Object.keys(p.properties)\n            .filter((key) => key.toLowerCase().startsWith(\"jaccard_\") || key.toLowerCase().startsWith(\"nn_diff_\"))\n            .forEach((key) => delete p.properties[key]);\n\n          Object.entries(p.nearest_neighbors || {}).forEach(([nnKey, nn]) => {\n            // Inject the actual particles into the nearest neighbors collection\n            nn.knn_particles = nn.knn_ind.map((i) => collection.data[i]);\n          });\n\n          function injectEval(p: IParticle, object: any, key: string, func: string) {\n            injectGetter(object, key, () => {\n              try {\n                return eval(func);\n              } catch {\n                return null;\n              }\n            });\n          }\n\n          function injectJaccard(object: any, key: string, embeddingName1: string, embeddingName2: string, nn: number) {\n            const nn1 = p.nearest_neighbors?.[embeddingName1];\n            const nn2 = p.nearest_neighbors?.[embeddingName2];\n            if (nn1 && nn2) {\n              injectGetter(object, key, () => {\n                const xIndices = nn1.knn_ind.slice(0, nn);\n                const yIndices = new Set(nn2.knn_ind.slice(0, nn));\n                return xIndices.filter((x) => yIndices.has(x)).length / xIndices.length;\n              });\n            } else {\n              throw Error(`Could not inject jaccard getter: ${embeddingName1} or ${embeddingName2} are undefined.`);\n            }\n          }\n\n          function injectNNDiff(\n            object: any,\n            key: string,\n            embeddingName: string,\n            property: string,\n            method: string,\n            nn: number\n          ) {\n            const nn1 = p.nearest_neighbors?.[embeddingName];\n            const value = p.properties[property];\n            if (nn1 && typeof value === \"number\") {\n              const values = nn1.knn_particles.slice(0, nn).map((p) => (p.properties[property] as number) || 0);\n              injectGetter(object, key, () => ARRAY_DISTANCE_METRICS[method]?.(value, values));\n            } else {\n              throw Error(`Could not inject nn_diff getter: ${embeddingName} is undefined or value is not a number.`);\n            }\n          }\n\n          function injectCluster(\n            object: any,\n            key: string,\n            embeddingName: string,\n          ) {\n            const cluster = p.clusters?.[embeddingName];\n            if (cluster) {\n              injectGetter(object, key, () => cluster.label);\n            } else {\n              throw Error(`Could not inject cluster getter: ${embeddingName} is undefined.`);\n            }\n          }\n\n          if (p.nearest_neighbors && !p.nearest_neighbors[isProxySymbol]) {\n            p.nearest_neighbors = new Proxy(p.nearest_neighbors, {\n              get: function (obj, prop) {\n                if (prop === isProxySymbol) {\n                  return true;\n                }\n\n                if (typeof prop === \"symbol\") {\n                  return undefined;\n                }\n\n                // console.log(\"Nearest neighbor\", obj, prop);\n                if (prop.startsWith(\"property=\") && !(prop in obj)) {\n                  const [key, property] = prop.split(\"=\");\n                  const propertyValue = p.properties[property];\n                  if (typeof propertyValue === \"number\") {\n                    const lookup = new Map(\n                      collection.data.map((particle) => [\n                        particle,\n                        Math.abs(propertyValue - (particle.properties[property]! as number)),\n                      ])\n                    );\n                    const nearestNeighbors = collection.data\n                      .sort((a, b) => lookup.get(a)! - lookup.get(b)!)\n                      .slice(1, 51);\n\n                    obj[prop] = {\n                      distance_metric: \"absolute_property_difference\",\n                      knn_dist: nearestNeighbors.map((n) => lookup.get(n)),\n                      knn_ind: nearestNeighbors.map((n) => n.index),\n                      knn_particles: nearestNeighbors,\n                    } as INearestNeighbors;\n                    // injectGetter(obj, prop, () => {})\n                  } else if (typeof propertyValue === \"string\") {\n                    const nearestNeighbors = collection.data.filter(\n                      (particle) => p !== particle && particle.properties[property] === propertyValue\n                    );\n\n                    obj[prop] = {\n                      distance_metric: \"string_equality\",\n                      knn_dist: nearestNeighbors.map((n) => 0),\n                      knn_ind: nearestNeighbors.map((n) => n.index),\n                      knn_particles: nearestNeighbors,\n                    } as INearestNeighbors;\n                  }\n                }\n                return obj[prop];\n              },\n            });\n          }\n\n          if (!p.properties[isProxySymbol]) {\n            p.properties = new Proxy(p.properties, {\n              get: function (obj, prop) {\n                if (prop === isProxySymbol) {\n                  return true;\n                }\n\n                if (typeof prop === \"symbol\") {\n                  return undefined;\n                }\n\n                try {\n                  if (prop.startsWith(\"eval=\") && !(prop in obj)) {\n                    // Pattern: eval=<URL encoded function>\n                    const [key, func] = prop.split(\"=\");\n                    injectEval(p, obj, prop, func);\n                  }\n\n                  if (prop.startsWith(\"jaccard=\") && !(prop in obj)) {\n                    // Pattern: jaccard=<emb1>=<emb2>=<nn>\n                    const [key, emb1, emb2, nn] = prop.split(\"=\");\n                    injectJaccard(obj, prop, emb1, emb2, +nn);\n                  }\n\n                  if (prop.startsWith(\"nn_diff=\") && !(prop in obj)) {\n                    // Pattern: nn_diff=<emb>=<prop>=<method>=<nn>\n                    const [key, emb, property, method, nn] = prop.split(\"=\");\n                    injectNNDiff(obj, prop, emb, property, method, +nn);\n                  }\n\n                  if (prop.startsWith(\"cluster=\") && !(prop in obj)) {\n                    // Pattern: cluster=<emb>\n                    const [key, emb] = prop.split(\"=\");\n                    injectCluster(obj, prop, emb);\n                  }\n                } catch (e) {\n                  console.error(`Error injecting ${prop} getter`, e);\n                }\n\n                return obj[prop];\n              },\n            });\n          }\n        });\n      });\n\n      _setCollections(collections);\n    },\n    [_setCollections]\n  );\n\n  React.useEffect(() => {\n    // Import the bbbp dataset by default\n    import('./bbbp.json').then((importedDataset) => {\n      setCollections(importedDataset.default as any);\n    })\n  }, [setCollections])\n\n  const interpolationCollection = React.useMemo(\n    () => collections.find((c) => c.name === \"Interpolated\") as ICollection<IInterpolatedParticle> | undefined,\n    [collections]\n  );\n\n  const setInterpolationCollection = React.useCallback(\n    (collection: ICollection<IInterpolatedParticle>) => {\n      _setCollections((collections) => [...collections.filter((c) => c.name !== \"Interpolated\"), collection]);\n    },\n    [_setCollections]\n  );\n\n  return (\n    <CollectionContext.Provider value={collections}>\n      <div className=\"vh-100 d-flex flex-column\">\n        <Navbar collapseOnSelect expand=\"lg\" bg=\"dark\" variant=\"dark\">\n          <Container>\n          <Navbar.Brand href=\"#home\">ChEmbVis</Navbar.Brand>\n          <Navbar.Toggle aria-controls=\"responsive-navbar-nav\" />\n          <Navbar.Collapse id=\"responsive-navbar-nav\">\n            <Nav className=\"me-auto\">\n              <Nav className=\"me-auto\">\n                <Nav.Link\n                  href=\"#\"\n                  active={activeTab === EActiveTabs.EMBEDDING}\n                  onSelect={() => setActiveTab(EActiveTabs.EMBEDDING)}\n                >\n                  Embedding\n                </Nav.Link>\n                <Nav.Link\n                  href=\"#\"\n                  active={activeTab === EActiveTabs.INTERPOLATION}\n                  onSelect={() => setActiveTab(EActiveTabs.INTERPOLATION)}\n                >\n                  Interpolation\n                </Nav.Link>\n                {/* <Nav.Link href=\"/datasets/\" target=\"_blank\" active={false}>\n                  Datasets\n                </Nav.Link> */}\n              </Nav>\n\n              {offline ? <Navbar.Text style={{color: 'red', marginLeft: 16}}>\n                backend not reachable, some features may not be available\n              </Navbar.Text> : null}\n            </Nav>\n            <Form>\n              <Button\n                onClick={() => {\n                  setImportFileModalShow(true);\n                }}\n              >\n                Import\n              </Button>\n              <Button\n                className=\"ms-2\"\n                disabled={collections.length === 0}\n                onClick={() => {\n                  downloadJSONFile(collections, \"export\");\n                }}\n              >\n                Export\n              </Button>\n            </Form>\n          </Navbar.Collapse>\n        </Container>\n        </Navbar>\n        <FileUploadModal\n          open={importFileModalShow}\n          setOpen={setImportFileModalShow}\n          onSave={(value) => {\n            if (value) {\n              try {\n                setCollections(JSON.parse(value));\n                setImportFileModalShow(false);\n              } catch (e) {\n                console.error(\"Error parsing imported file.\");\n              }\n            }\n          }}\n        />\n        <div className=\"container-fluid mt-2\" style={{ flex: 1, overflow: \"auto\" }}>\n          <div className=\"row\" style={{ height: \"100%\", overflow: \"auto\", position: \"relative\" }}>\n            {activeTab === EActiveTabs.EMBEDDING ? (\n              <EmbeddingPage\n                registry={registry}\n                collections={collections}\n                setCollections={setCollections}\n                interpolationStructures={interpolationStructures}\n                setInterpolationStructures={setInterpolationStructures}\n                setActiveTab={setActiveTab}\n              />\n            ) : null}\n            {activeTab === EActiveTabs.INTERPOLATION ? (\n              <InterpolationPage\n                collection={interpolationCollection}\n                setCollection={setInterpolationCollection}\n                structures={interpolationStructures}\n                setStructures={(structures: string[]) => setInterpolationStructures(structures)}\n              />\n            ) : null}\n          </div>\n        </div>\n      </div>\n    </CollectionContext.Provider>\n  );\n}\n\nexport default App;\n","import React from \"react\";\nimport { LoadingPage } from \"./components/LoadingPage\";\nimport { StructureCardGrid } from \"./components/StructureCardGrid\";\nimport { ICollection, IInterpolatedParticle } from \"./interfaces\";\nimport { HorizontalCollapse } from \"./components/HorizontalCollapse\";\nimport { InterpolationForm } from \"./components/form/InterpolationForm\";\n\nexport function InterpolationPage({\n  structures,\n  setStructures,\n  collection,\n  setCollection,\n}: {\n  structures?: string[];\n  setStructures?(structures: string[]): void;\n  collection?: ICollection<IInterpolatedParticle>;\n  setCollection(collection: ICollection<IInterpolatedParticle>): void;\n}) {\n  const [optionsCollapsed, setOptionsCollapsed] = React.useState<boolean>(false);\n  const [loading, setLoading] = React.useState<boolean>(false);\n\n  return (\n    <>\n      <HorizontalCollapse\n        label=\"Options\"\n        position=\"left\"\n        size=\"col-md-2\"\n        collapsed={optionsCollapsed}\n        setCollapsed={setOptionsCollapsed}\n      >\n        <InterpolationForm open={true} setCollection={setCollection} loading={loading} setLoading={setLoading} setStructures={setStructures} structures={structures} />\n      </HorizontalCollapse>\n      <div\n        // className=\"col-md-10\"\n        style={{\n          display: \"flex\",\n          flex: 1,\n          flexDirection: \"column\",\n          overflow: \"auto\",\n          marginLeft: 33,\n        }}\n      >\n        <LoadingPage loading={loading} fallback=\"Please select structures for interpolation\">\n          {collection && collection.data.length > 0 ? (\n            <StructureCardGrid\n              collections={[collection]}\n              tableClass=\"main-ranking\"\n              structureCardProps={(structure) => ({\n                className: structure.scaffold ? \"border-primary\" : \"\"\n              })}\n            />\n          ) : null}\n        </LoadingPage>\n      </div>\n    </>\n  );\n}\n","import plotComponentFactory from \"react-plotly.js/factory\";\n// Only use Plotly Geo to reduce bundle size significantly\n// @ts-ignore\nimport Plotly from \"plotly.js-dist\";\n// Solution for using plotly.js-dist with react-plotly.js: https://github.com/plotly/react-plotly.js/issues/143\nexport const PlotComponent = plotComponentFactory(Plotly);\n\nexport const PLOTLY_CONFIG = {\n    displaylogo: false,\n    responsive: true,\n    showLink: false,\n    // showEditInChartStudio: true,\n    // plotlyServerURL: \"https://chart-studio.plotly.com\"\n};","import * as React from \"react\";\nimport { Dropdown, Button, ButtonGroup } from \"react-bootstrap\";\nimport { FileUploadModal } from \"./FileUploadModal\";\n\nexport function ButtonWithUpload({\n  loading,\n  disabled,\n  text,\n  onUploadData,\n  onUploadResult,\n}: {\n  loading?: boolean;\n  disabled?: boolean;\n  text: string;\n  onUploadData?(data: string | null): boolean | void;\n  onUploadResult?(data: string | null): boolean | void;\n}) {\n  const [uploadModalOpen, setUploadModalOpen] = React.useState<\"result\" | \"data\" | null>(null);\n  return (\n    <>\n      <FileUploadModal\n        open={Boolean(uploadModalOpen)}\n        setOpen={(open) => setUploadModalOpen(null)}\n        onSave={(value) => {\n          if (\n            (uploadModalOpen === \"result\" ? onUploadResult : uploadModalOpen === \"data\" ? onUploadData : null)?.(value)\n          ) {\n            setUploadModalOpen(null);\n          }\n        }}\n      />\n      <Dropdown as={ButtonGroup} drop=\"end\">\n        <Button variant=\"primary\" type=\"submit\" disabled={loading || disabled}>\n          {loading ? (\n            <>\n              <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\" /> Loading...\n            </>\n          ) : (\n            text\n          )}\n        </Button>\n        {onUploadData || onUploadResult ? (\n          <>\n            <Dropdown.Toggle split variant=\"primary\" disabled={loading} />\n            <Dropdown.Menu>\n              {onUploadData ? (\n                <Dropdown.Item\n                  onClick={() => {\n                    setUploadModalOpen(\"data\");\n                  }}\n                >\n                  Upload data\n                </Dropdown.Item>\n              ) : null}\n              {onUploadResult ? (\n                <Dropdown.Item\n                  onClick={() => {\n                    setUploadModalOpen(\"result\");\n                  }}\n                >\n                  Upload precomputed result\n                </Dropdown.Item>\n              ) : null}\n            </Dropdown.Menu>\n          </>\n        ) : null}\n      </Dropdown>\n    </>\n  );\n}\n","import * as React from \"react\";\nimport { Modal } from \"react-bootstrap\";\nimport { Button } from \"react-bootstrap\";\n// @ts-ignore\nimport { Jsme } from \"jsme-react\";\n\nexport function JSMEModal({\n  open,\n  initialSmiles = \"\",\n  setOpen,\n  onSave,\n}: {\n  open: boolean;\n  initialSmiles?: string;\n  setOpen?(show: boolean): void;\n  onSave?(value: string | null): void;\n}) {\n  const [smiles, setSmiles] = React.useState<string>(initialSmiles);\n  const [showJSME, setShowJSME] = React.useState<boolean>(false);\n  const bodyRef = React.useRef<HTMLDivElement>(null);\n\n  const handleClose = React.useCallback(() => {\n    setOpen?.(false);\n  }, [setOpen]);\n\n  const handleSave = React.useCallback(() => {\n    onSave?.(smiles || null);\n  }, [onSave, smiles]);\n\n  React.useEffect(() => {\n    if (open) {\n      const timeout = setTimeout(() => {\n        setShowJSME(true);\n      }, 200);\n      return () => clearTimeout(timeout);\n    } else {\n      setShowJSME(false);\n    }\n  }, [open]);\n\n  return (\n    <>\n      <Modal show={open} onHide={handleClose} size=\"lg\">\n        <Modal.Header closeButton>\n          <Modal.Title>Draw molecule</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <div ref={bodyRef}></div>\n          {showJSME ? (\n            <Jsme\n              height=\"600px\"\n              width={`${bodyRef.current?.getBoundingClientRect().width || 600}px`}\n              options=\"star\"\n              // src=\"/jsme/jsme.nocache.js\"\n              // Load the distribution from the official \"CDN\".\n              src=\"https://jsme-editor.github.io/dist/jsme/jsme.nocache.js\"\n              smiles={initialSmiles || undefined}\n              onChange={setSmiles}\n            />\n          ) : null}\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"secondary\" onClick={handleClose}>\n            Close\n          </Button>\n          <Button variant=\"primary\" onClick={handleSave}>\n            Save\n          </Button>\n        </Modal.Footer>\n      </Modal>\n    </>\n  );\n}\n","import * as React from \"react\";\nimport { IParticle, IParticleSelection } from \"../interfaces\";\nimport { JSMEModal } from \"./JSMEModal\";\n\nexport function UseStructureInputAddon({\n  value,\n  selection,\n  setValue,\n}: {\n  value: string;\n  selection?: IParticleSelection;\n  setValue: (structure: string) => void;\n}) {\n  const selected = React.useMemo<IParticle | undefined>(\n    () => Object.values(selection || {}).find((s) => s.length > 0)?.[0],\n    [selection]\n  );\n  const [editorOpen, setEditorOpen] = React.useState<boolean>(false);\n\n  return (\n    <>\n      <JSMEModal\n        open={editorOpen}\n        setOpen={setEditorOpen}\n        initialSmiles={value}\n        onSave={(smiles) => {\n          if (smiles) {\n            setValue(smiles);\n          }\n          setEditorOpen(false);\n        }}\n      />\n        <button\n          className=\"btn btn-outline-secondary\"\n          type=\"button\"\n          title=\"Use selected structure as input\"\n          disabled={!selected}\n          onClick={() => (selected ? setValue(selected.structure) : undefined)}\n        >\n          <i className=\"fas fa-mouse-pointer\"></i>\n        </button>\n        <button\n          className=\"btn btn-outline-secondary\"\n          type=\"button\"\n          title=\"Draw structure\"\n          onClick={() => setEditorOpen(true)}\n        >\n          <i className=\"fas fa-draw-polygon\"></i>\n        </button>\n    </>\n  );\n}\n","import * as React from \"react\";\nimport { Modal, Button } from \"react-bootstrap\";\nimport { CurveEditor, DEFAULT_CURVE_TYPES, IPoint } from \"visyn_component_curve_editor\";\n// Include style for default styling\nimport \"visyn_component_curve_editor/dist/curveEditor.css\";\nimport { scaleLinear } from \"d3-scale\";\nimport { extent } from \"d3-array\";\n\nconst MARGIN_BOTTOM = 50;\nconst MARGIN_RIGHT = 50;\n\nconst VIEWBOX_SIZE: [number, number] = [600, 400];\n\nexport function CurveEditorModal({\n  open,\n  initialPoints = [],\n  setOpen,\n  onSave,\n}: {\n  open: boolean;\n  initialPoints?: { x: number; y: number }[];\n  setOpen?(show: boolean): void;\n  onSave?(value: { x: number; y: number }[]): void;\n}) {\n  const [points, setPoints] = React.useState<IPoint[]>([]);\n  const [min, setMin] = React.useState<number>(0);\n  const [max, setMax] = React.useState<number>(1);\n  const [inputMin, setInputMin] = React.useState<number>(min);\n  const [inputMax, setInputMax] = React.useState<number>(max);\n\n  React.useEffect(() => {\n    setInputMin(min);\n    setInputMax(max);\n  }, [min, max]);\n\n  React.useEffect(() => {\n    setPoints(initialPoints.map(({ x, y }, i) => ({ id: i.toString(), x, y })));\n    const [minimum, maximum] = extent(initialPoints.map(({ x }) => x));\n    setMin(minimum ?? 0);\n    setMax(maximum ?? 1);\n  }, [initialPoints]);\n\n  const scales = React.useMemo(() => {\n    return {\n      x: scaleLinear()\n        .domain([min, max])\n        .range([0, VIEWBOX_SIZE[0] - 2 * MARGIN_RIGHT])\n        .clamp(true),\n      y: scaleLinear()\n        .domain([0, 1])\n        .range([VIEWBOX_SIZE[1] - 2 * MARGIN_BOTTOM, 0])\n        .clamp(true),\n    };\n  }, [min, max]);\n\n  const handleClose = React.useCallback(() => {\n    setOpen?.(false);\n  }, [setOpen]);\n\n  const handleSave = React.useCallback(() => {\n    onSave?.(points.map(({ x, y }) => ({ x, y })));\n  }, [onSave, points]);\n\n  return (\n    <>\n      <Modal show={open} onHide={handleClose} size=\"lg\">\n        <Modal.Header closeButton>\n          <Modal.Title>Draw desirability</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          <form\n            className=\"row mb-2\"\n            style={{ alignItems: \"baseline\", flexFlow: \"row\", justifyContent: \"center\" }}\n            onSubmit={(e) => {\n              e.preventDefault();\n              e.stopPropagation();\n              setMin(inputMin);\n              setMax(inputMax);\n            }}\n          >\n            <div className=\"col mb-3 me-4\">\n              <label htmlFor=\"curveMinInput\">Minimum</label>\n              <input\n                type=\"number\"\n                className=\"form-control form-control-sm ms-2\"\n                id=\"curveMinInput\"\n                value={inputMin}\n                onChange={(e) => setInputMin(e.currentTarget.valueAsNumber)}\n              />\n            </div>\n            <div className=\"col mb-3 me-4\">\n              <label htmlFor=\"curveMaxInput\">Maximum</label>\n              <input\n                type=\"number\"\n                className=\"form-control  form-control-sm ms-2\"\n                id=\"curveMaxInput\"\n                value={inputMax}\n                onChange={(e) => setInputMax(e.currentTarget.valueAsNumber)}\n              />\n            </div>\n            <div className=\"col\">\n              <button type=\"submit\" className=\"btn btn-sm btn-primary\">\n                Apply\n              </button>\n            </div>\n          </form>\n          <CurveEditor\n            points={points}\n            setPoints={setPoints}\n            scales={scales}\n            viewBoxSize={VIEWBOX_SIZE}\n            curveType={DEFAULT_CURVE_TYPES[\"Linear\"]}\n          />\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"secondary\" onClick={handleClose}>\n            Close\n          </Button>\n          <Button variant=\"primary\" onClick={handleSave}>\n            Save\n          </Button>\n        </Modal.Footer>\n      </Modal>\n    </>\n  );\n}\n","import * as React from \"react\";\nimport { ICollection, IObjective, IParticleSelection } from \"../../interfaces\";\nimport { ButtonWithUpload } from \"../ButtonWithUpload\";\nimport { runMSO } from \"../../utils/api\";\nimport { FormWrapper } from \"./FormWrapper\";\nimport { UseStructureInputAddon } from \"../UseStructureInputAddon\";\nimport { Alert } from \"react-bootstrap\";\nimport { CurveEditorModal } from \"../CurveEditorModal\";\nimport { useNameInput } from \"../../utils/hooks\";\n\nexport const MSOForm = ({\n  availableObjectives,\n  addCollection,\n  selection,\n  loading,\n  setLoading,\n}: {\n  availableObjectives?: IObjective[];\n  addCollection(collection: ICollection): void;\n  selection: IParticleSelection;\n  loading: boolean;\n  setLoading(loading: boolean): void;\n}) => {\n  const [name, setName, nameInput] = useNameInput(\"msoNameInput\", \"MSO\");\n  const [msoStartingStructure, setMsoStartingStructure] = React.useState<string>(\"\");\n  const [nrOfParticles, setNrOfParticles] = React.useState<number>(50);\n  const [nrOfIterations, setNrOfIterations] = React.useState<number>(10);\n  const [nrOfSwarms, setNrOfSwarms] = React.useState<number>(5);\n  const [vMin, setVMin] = React.useState<number>(-0.6);\n  const [vMax, setVMax] = React.useState<number>(0.6);\n  const [inertiaWeight, setInertiaWeight] = React.useState<number>(0.9);\n  const [phi1, setPhi1] = React.useState<number>(2.0);\n  const [phi2, setPhi2] = React.useState<number>(2.0);\n  const [phi3, setPhi3] = React.useState<number>(2.0);\n  const [selectedObjective, setSelectedObjective] = React.useState<any | null>();\n  const [objectives, setObjectives] = React.useState<IObjective[]>([]);\n  const [desirabilityCurveObjective, setDesirabilityCurveObjective] = React.useState<IObjective | null>(null);\n\n  return (\n    <FormWrapper\n      title=\"Molecular Swarm Optimization\"\n      loading={loading}\n      setLoading={setLoading}\n      onSubmit={async () => {\n        const msoCollection = await runMSO({\n          structure: msoStartingStructure,\n          iterations: nrOfIterations,\n          num_swarms: nrOfSwarms,\n          num_part: nrOfParticles,\n          v_min: vMin,\n          v_max: vMax,\n          inertia_weight: inertiaWeight,\n          phi1,\n          phi2,\n          phi3,\n          objectives,\n        });\n\n        addCollection({ ...msoCollection, name });\n        setName(\"\");\n      }}\n    >\n      {desirabilityCurveObjective ? (\n        <CurveEditorModal\n          open={desirabilityCurveObjective != null}\n          initialPoints={desirabilityCurveObjective.desirability}\n          setOpen={(open) => (open ? null : setDesirabilityCurveObjective(null))}\n          onSave={(points) => {\n            setObjectives(\n              objectives.map((o) => (o === desirabilityCurveObjective ? { ...o, desirability: points } : o))\n            );\n            setDesirabilityCurveObjective(null);\n          }}\n        />\n      ) : null}\n      {nameInput}\n      {availableObjectives ? (\n        <>\n          <div className=\"mb-3\">\n            <label htmlFor=\"msoObjectivesSelect\">Objectives</label>\n            <div className=\"input-group input-group-sm\">\n              <select\n                className=\"form-control\"\n                id=\"msoObjectivesSelect\"\n                value={selectedObjective?.name}\n                onChange={(e) => {\n                  setSelectedObjective(availableObjectives.find((o) => o.name === e.currentTarget.value));\n                }}\n              >\n                <option value=\"\">Choose...</option>\n                {availableObjectives.map((o) => (\n                  <option key={o.name} value={o.name}>{o.name}</option>\n                ))}\n              </select>\n              <input\n                type=\"number\"\n                className=\"form-control-plaintext form-control-sm\"\n                required\n                value={objectives.length}\n                onChange={() => null}\n                min={1}\n                style={{\n                  flex: \"0 0 1px\",\n                }}\n              />\n                <button\n                  disabled={!selectedObjective}\n                  className=\"btn btn-outline-secondary\"\n                  type=\"button\"\n                  onClick={() => setObjectives([...objectives, selectedObjective])}\n                >\n                  Add\n                </button>\n            </div>\n            <small id=\"msoObjectivesSelect\" className=\"form-text text-muted\">\n              Objectives define the optimization goal of MSO\n            </small>\n          </div>\n          <div className=\"mb-3\" style={{ overflowX: \"hidden\" }}>\n            {objectives.map((objective) => (\n              <details key={objective.name} className=\"mb-1\" open={Boolean(objective.additional_args)}>\n                <summary className=\"text-truncate\">\n                  {objective.name}{\" \"}\n                  <div className=\"btn-group btn-group-sm ms-2 me-2 float-end\" role=\"group\">\n                    <button\n                      type=\"button\"\n                      className=\"btn btn-light\"\n                      title=\"Adjust desirability curve\"\n                      onClick={() => {\n                        setDesirabilityCurveObjective(objective);\n                      }}\n                    >\n                      <i className=\"fas fa-fw fa-bezier-curve\" />\n                    </button>\n                    <button\n                      type=\"button\"\n                      className=\"btn btn-danger\"\n                      title=\"Delete objective\"\n                      onClick={() => {\n                        setObjectives(objectives.filter((o) => o !== objective));\n                      }}\n                    >\n                      <i className=\"fas fa-fw fa-times\" />\n                    </button>\n                  </div>\n                </summary>\n                <small title={objective.description} className=\"text-truncate\">\n                  {objective.description}\n                </small>\n                <div className=\"d-flex\" title=\"Relative weight of objective\">\n                  {/* <label for=\"formControlRange\" className=\"form-label\">Example Range input</label> */}\n                  <input\n                    type=\"range\"\n                    className=\"form-range me-2\"\n                    min={1}\n                    max={100}\n                    step={1}\n                    value={objective.weight}\n                    onChange={(e) => {\n                      setObjectives(\n                        objectives.map((o) => (o === objective ? { ...o, weight: e.currentTarget.valueAsNumber } : o))\n                      );\n                    }}\n                  />\n                  {objective.weight}%\n                </div>\n                {Object.entries(objective.additional_args || {}).map(([key, value]) => {\n                  const setValue = (value: string) =>\n                    setObjectives(\n                      objectives.map((o) =>\n                        o === objective\n                          ? {\n                              ...o,\n                              additional_args: {\n                                ...o.additional_args,\n                                [key]: value,\n                              },\n                            }\n                          : o\n                      )\n                    );\n\n                  return (\n                    <div key={key} className=\"input-group input-group-sm\">\n                      {key === \"query\" ? (\n                        <UseStructureInputAddon value={value} selection={selection} setValue={setValue} />\n                      ) : null}\n                      <input\n                        key={key}\n                        type=\"text\"\n                        className=\"form-control form-control-sm\"\n                        placeholder={key}\n                        value={value}\n                        required={true}\n                        onChange={(e) => setValue(e.currentTarget.value)}\n                      />\n                    </div>\n                  );\n                })}\n                <hr />\n              </details>\n            ))}\n          </div>\n          <div className=\"mb-3\">\n            <label htmlFor=\"startingStructureInput\">Starting structure</label>\n            <div className=\"input-group input-group-sm\">\n              <UseStructureInputAddon\n                value={msoStartingStructure}\n                selection={selection}\n                setValue={setMsoStartingStructure}\n              />\n              <input\n                type=\"text\"\n                className=\"form-control form-control-sm\"\n                id=\"startingStructureInput\"\n                aria-describedby=\"startingStructureInputHelp\"\n                required\n                value={msoStartingStructure}\n                onChange={(e) => setMsoStartingStructure(e.currentTarget.value)}\n              />\n            </div>\n            <small id=\"startingStructureInputHelp\" className=\"form-text text-muted\"></small>\n          </div>\n          <details>\n            <summary>Advanced Settings</summary>\n            <div className=\"mb-3\">\n              <label htmlFor=\"nrOfSwarmsInput\">Swarms</label>\n              <input\n                type=\"number\"\n                className=\"form-control form-control-sm\"\n                id=\"nrOfSwarmsInput\"\n                value={nrOfSwarms}\n                required\n                min={1}\n                onChange={(e) => setNrOfSwarms(e.currentTarget.valueAsNumber)}\n              />\n            </div>\n            <div className=\"mb-3\">\n              <label htmlFor=\"nrOfParticlesInput\">Particles</label>\n              <input\n                type=\"number\"\n                className=\"form-control form-control-sm\"\n                id=\"nrOfParticlesInput\"\n                value={nrOfParticles}\n                required\n                min={1}\n                onChange={(e) => setNrOfParticles(e.currentTarget.valueAsNumber)}\n              />\n            </div>\n            <div className=\"mb-3\">\n              <label htmlFor=\"nrOfIterationsInput\">Iterations</label>\n              <input\n                type=\"number\"\n                className=\"form-control form-control-sm\"\n                id=\"nrOfIterationsInput\"\n                value={nrOfIterations}\n                required\n                min={1}\n                onChange={(e) => setNrOfIterations(e.currentTarget.valueAsNumber)}\n              />\n            </div>\n            <div className=\"mb-3\">\n              <label htmlFor=\"vMinInput\">Min Velocity</label>\n              <input\n                type=\"number\"\n                className=\"form-control form-control-sm\"\n                id=\"vMinInput\"\n                value={vMin}\n                required\n                step={0.1}\n                onChange={(e) => setVMin(e.currentTarget.valueAsNumber)}\n              />\n            </div>\n            <div className=\"mb-3\">\n              <label htmlFor=\"vMaxInput\">Max Velocity</label>\n              <input\n                type=\"number\"\n                className=\"form-control form-control-sm\"\n                id=\"vMaxInput\"\n                value={vMax}\n                required\n                step={0.1}\n                onChange={(e) => setVMax(e.currentTarget.valueAsNumber)}\n              />\n            </div>\n            <div className=\"mb-3\">\n              <label htmlFor=\"inertiaWeightInput\">Inertia Weight</label>\n              <input\n                type=\"number\"\n                className=\"form-control form-control-sm\"\n                id=\"inertiaWeightInput\"\n                value={inertiaWeight}\n                required\n                step={0.1}\n                onChange={(e) => setInertiaWeight(e.currentTarget.valueAsNumber)}\n              />\n            </div>\n            <div className=\"mb-3\">\n              <label htmlFor=\"phi1Input\">Phi 1</label>\n              <input\n                type=\"number\"\n                className=\"form-control form-control-sm\"\n                id=\"phi1Input\"\n                value={phi1}\n                required\n                step={0.1}\n                onChange={(e) => setPhi1(e.currentTarget.valueAsNumber)}\n              />\n            </div>\n            <div className=\"mb-3\">\n              <label htmlFor=\"phi2Input\">Phi 2</label>\n              <input\n                type=\"number\"\n                className=\"form-control form-control-sm\"\n                id=\"phi2Input\"\n                value={phi2}\n                required\n                step={0.1}\n                onChange={(e) => setPhi2(e.currentTarget.valueAsNumber)}\n              />\n            </div>\n            <div className=\"mb-3\">\n              <label htmlFor=\"phi3Input\">Phi 3</label>\n              <input\n                type=\"number\"\n                className=\"form-control form-control-sm\"\n                id=\"phi3Input\"\n                value={phi3}\n                required\n                step={0.1}\n                onChange={(e) => setPhi3(e.currentTarget.valueAsNumber)}\n              />\n            </div>\n          </details>\n          <div className=\"text-end\">\n            <ButtonWithUpload\n              loading={loading}\n              text=\"Run MSO\"\n              onUploadResult={(value) => {\n                if (value) {\n                  addCollection({ data: JSON.parse(value), name: \"MSO\" });\n                  return true;\n                }\n              }}\n            />\n          </div>\n        </>\n      ) : (\n        <Alert variant=\"info\">\n          <p>No objectives are available.</p>\n        </Alert>\n      )}\n    </FormWrapper>\n  );\n};\n","import * as React from \"react\";\nimport { DEFAULT_COLLECTION, ICollection } from \"../../interfaces\";\nimport { embedStructures } from \"../../utils/api\";\nimport { useNameInput } from \"../../utils/hooks\";\nimport { ButtonWithUpload } from \"../ButtonWithUpload\";\nimport { FormWrapper } from \"./FormWrapper\";\nimport { parse } from 'papaparse';\n\nexport const ComputeEmbeddingsForm = ({\n  addCollection,\n  loading,\n  setLoading,\n}: {\n  addCollection(collection: ICollection): void;\n  loading: boolean;\n  setLoading(loading: boolean): void;\n}) => {\n  const [name, setName, nameInput] = useNameInput(\"cdddNameInput\", \"\");\n  const [cdddInput, setCdddInput] = React.useState<string>(\"\");\n\n  return (\n    <FormWrapper\n      title=\"Compute Embeddings\"\n      loading={loading}\n      setLoading={setLoading}\n      onSubmit={async () => {\n        const structures: Parameters<typeof embedStructures>[0]['structures'] = [];\n        const additional: { [key: string]: {[key: string]: string | number | boolean} } = {};\n\n        const result = parse<{\n          smiles: string;\n          [key: string]: string | number | boolean;\n        }>(cdddInput, {\n          header: true,\n          skipEmptyLines: true,\n          dynamicTyping: true,\n          transformHeader: (header) => {\n            if(['smiles', 'structure', 'structures'].includes(header.trim().toLocaleLowerCase())) {\n              return 'smiles';\n            }\n            return header.trim();\n          },\n          transform: (value, field) => {\n            if(field.toString().startsWith('emb_')) {\n              // Any value starting with emb_ will be parsed as JSON, such that [1.1, 1.2, 1.3] is a valid string\n              return JSON.parse(value);\n            }\n            return value;\n          }\n        });\n\n        if(!result.meta.fields?.includes('smiles')) {\n          throw Error('No header named \"smiles\" found. Please include a header called \"smiles\" in the column of the structure.');\n        }\n\n        result.data.filter((d) => d.smiles).forEach(({smiles, ...rest}) => {\n          const embeddings: {[key: string]: number[]} = {};\n          Object.keys(rest).filter((key) => key.startsWith('emb_')).forEach((key) => {\n            embeddings[key] = rest[key] as any as number[];\n            delete rest[key];\n          })\n\n          structures.push({\n            smiles,\n            embeddings\n          });\n          additional[smiles] = rest;\n        })\n\n        const newCollection = await embedStructures({\n          structures,\n          include_embedding: false\n        });\n\n        newCollection.data = newCollection.data.map((particle) => {\n          const additionalProperties = additional[particle.original_structure!];\n          // Inject the additional properties if there are any\n          if (additionalProperties) {\n            particle.properties = {\n              ...(particle.properties || {}),\n              ...additionalProperties,\n            };\n          }\n          return particle;\n        });\n        addCollection({\n          name,\n          ...newCollection,\n        });\n        setName(\"\");\n      }}\n    >\n      {nameInput}\n      <div className=\"mb-3\">\n        <label htmlFor=\"cdddTextarea\">Structures to convert</label>\n        <textarea\n          className=\"form-control form-control-sm\"\n          id=\"cdddTextarea\"\n          rows={3}\n          onChange={(e) => setCdddInput(e.currentTarget.value)}\n          value={cdddInput}\n        />\n        <small id=\"cdddTextareaHelp\" className=\"form-text text-muted\">\n          Any CSV file format with a header \"smiles\" is valid. You can add additional properties as columns, which will be shown in the visualizations and ranking. \n          Additionally, any column starting with \"emb_\" will be parsed as JSON (value has to be an array like \"[1.2, 1.3, 1.5, ...]\") and used as precomputed embedding.\n        </small>\n      </div>\n      <div className=\"text-end\">\n        <ButtonWithUpload\n          loading={loading}\n          text=\"Compute\"\n          onUploadData={(value) => {\n            setCdddInput(value || \"\");\n            return true;\n          }}\n          onUploadResult={(value) => {\n            if (value) {\n              addCollection({\n                data: JSON.parse(value),\n                name: DEFAULT_COLLECTION,\n              });\n              return true;\n            }\n          }}\n        />\n      </div>\n    </FormWrapper>\n  );\n};\n","import * as React from \"react\";\nimport { ICollection, IParticleSelection } from \"../../interfaces\";\nimport { ButtonWithUpload } from \"../ButtonWithUpload\";\nimport { hasSubstructureMatch } from \"../../utils/api\";\nimport { FormWrapper } from \"./FormWrapper\";\nimport { UseStructureInputAddon } from \"../UseStructureInputAddon\";\n\nexport const SubstructureMatchingForm = ({\n  collections,\n  setCollections,\n  selection,\n  loading,\n  setLoading,\n}: {\n  collections: ICollection[];\n  setCollections(collections: ICollection[]): void;\n  selection: IParticleSelection;\n  loading: boolean;\n  setLoading(loading: boolean): void;\n}) => {\n  const [smarts, setSmarts] = React.useState<string>(\"\");\n\n  const computeSubstructures = async () => {\n    return Promise.all(\n      collections.map(({ data }) =>\n        hasSubstructureMatch(\n          data.map(({ structure }) => structure),\n          smarts\n        )\n      )\n    ).then((results) => {\n      setCollections(\n        collections.map((c, i) => {\n          return {\n            ...c,\n            data: c.data.map((p) => ({\n              ...p,\n              properties: {\n                ...(p.properties || {}),\n                [`Has ${smarts}`]: Boolean(results[i].validity[p.structure]),\n                [`Count ${smarts}`]: results[i].counts[p.structure] ?? 0,\n              },\n            })),\n            selection: null,\n          };\n        })\n      );\n    });\n  };\n\n  return (\n    <FormWrapper\n      title=\"Substructure Matching\"\n      loading={loading}\n      setLoading={setLoading}\n      onSubmit={computeSubstructures}\n    >\n      <div className=\"mb-3\">\n        <label htmlFor=\"smartsStructureInput\">Substructure</label>\n        <div className=\"input-group input-group-sm\">\n          <UseStructureInputAddon value={smarts} selection={selection} setValue={setSmarts} />\n          <input\n            type=\"text\"\n            className=\"form-control form-control-sm\"\n            id=\"smartsStructureInput\"\n            aria-describedby=\"smartsStructureInput\"\n            value={smarts}\n            onChange={(e) => setSmarts(e.currentTarget.value)}\n          />\n        </div>\n        <small id=\"smartsStructureInputHelp\" className=\"form-text text-muted\">\n          Use a SMILES or SMARTS query\n        </small>\n      </div>\n      <div className=\"text-end\">\n        <ButtonWithUpload loading={loading} disabled={!smarts} text=\"Compute Substructure Matches\" />\n      </div>\n    </FormWrapper>\n  );\n};\n","import * as React from \"react\";\nimport { ICollection, IParticle, IParticleSelection } from \"../../interfaces\";\nimport { ButtonWithUpload } from \"../ButtonWithUpload\";\nimport { getTanimotoSimilarity } from \"../../utils/api\";\nimport { FormWrapper } from \"./FormWrapper\";\nimport { UseStructureInputAddon } from \"../UseStructureInputAddon\";\n\nexport const TanimotoForm = ({\n  collections,\n  setCollections,\n  selection,\n  loading,\n  setLoading,\n}: {\n  collections: ICollection[];\n  setCollections(collections: ICollection[]): void;\n  selection?: IParticleSelection;\n  loading: boolean;\n  setLoading(loading: boolean): void;\n}) => {\n  const [similarityRef, setSimilarityRef] = React.useState<string>(\"\");\n  const [similaryFP, setSimilarityFP] = React.useState<string>(\"ecfp4\");\n\n  const computeTanimotoSimilarity = () => {\n\n    if(similaryFP === \"embeddings\") {\n      setCollections(collections.map((c) => {\n        const reference: IParticle = Object.values(selection || {})?.[0]?.[0];\n        if(!reference || !reference.embedding || Object.entries(reference.embedding).length === 0) {\n          throw Error('This type of similarity requires an active selection (with precomputed embeddings)');\n        }\n        const availableEmbeddings = Object.keys(reference.embedding);\n          \n        return {\n          ...c,\n          data: c.data.map((p) => ({\n            ...p,\n            properties: {\n              ...(p.properties || {}),\n              ...(availableEmbeddings.reduce((acc, cur) => ({...acc, [`${cur} Distance ${similarityRef}`]: p.embedding?.[cur]?.reduce((acc, x, i) => {\n                const y = reference.embedding![cur][i];\n                // TODO: Implement other distance metrics (VAE requires different one...)\n                return acc - Math.pow(x - y, 2);\n              }, 0)}), {})),\n            },\n          })),\n          selection: null,\n        };\n      }));\n      return;\n    }\n\n    return Promise.all(\n      collections.map(async ({ data }) =>\n        getTanimotoSimilarity(\n          data.map((s) => s.structure),\n          similarityRef,\n          similaryFP\n        )\n      )\n    ).then((results) => {\n      setCollections(\n        collections.map((c, i) => {\n          return {\n            ...c,\n            data: c.data.map((p) => ({\n              ...p,\n              properties: {\n                ...(p.properties || {}),\n                [`${similaryFP} Distance ${similarityRef}`]: results[i].tanimoto[p.structure],\n              },\n            })),\n            selection: null,\n          };\n        })\n      );\n    });\n  };\n\n  return (\n    <FormWrapper\n      title=\"Tanimoto Similarity\"\n      loading={loading}\n      setLoading={setLoading}\n      onSubmit={computeTanimotoSimilarity}\n    >\n      <div className=\"mb-3\">\n        <label htmlFor=\"similarityRefStructureInput\">Reference structure</label>\n        <div className=\"input-group input-group-sm\">\n          <UseStructureInputAddon value={similarityRef} selection={selection} setValue={setSimilarityRef} />\n          <input\n            type=\"text\"\n            className=\"form-control form-control-sm\"\n            id=\"similarityRefStructureInput\"\n            aria-describedby=\"similarityRefStructureInput\"\n            value={similarityRef}\n            onChange={(e) => setSimilarityRef(e.currentTarget.value)}\n          />\n        </div>\n      </div>\n      <div className=\"mb-3\">\n        <label htmlFor=\"similarityFingerprintInput\">Fingerprint</label>\n        <select\n          className=\"form-control form-control-sm\"\n          id=\"similarityFingerprintInput\"\n          value={similaryFP}\n          onChange={(e) => setSimilarityFP(e.currentTarget.value)}\n        >\n          <option value=\"ecfp2\">ECFP2 (Morgan Fingerprint)</option>\n          <option value=\"ecfp4\">ECFP4 (Morgan Fingerprint)</option>\n          <option value=\"cddd\">Descriptors from CDDD (ChEMBL only)</option>\n          <option value=\"embeddings\">Embeddings</option>\n        </select>\n      </div>\n      <div className=\"text-end\">\n        <ButtonWithUpload loading={loading} disabled={!similarityRef} text=\"Compute Similarity\" />\n      </div>\n    </FormWrapper>\n  );\n};\n","import * as React from \"react\";\nimport { OverlayTrigger, Popover } from \"react-bootstrap\";\nimport { Layout } from \"react-grid-layout\";\n\nexport const GridItemOptions = React.memo(\n  ({\n    gridOptions,\n    key,\n    children,\n    onClose,\n    onSettings,\n    renderInfo,\n    enableMove = true,\n  }: {\n    gridOptions?: Partial<Layout>;\n    key: string;\n    children: React.ReactNode;\n    onClose?(): void;\n    onSettings?(): void;\n    renderInfo?(): React.ReactNode;\n    enableMove?: boolean;\n  }) => (\n    <>\n      {enableMove ? (\n        <i\n          className=\"fas fa-fw fa-arrows-alt react-grid-item-hidden react-grid-item-drag-handle\"\n          title=\"Move\"\n          style={{\n            position: \"absolute\",\n            zIndex: 1,\n            top: 3,\n            left: 5,\n            cursor: \"pointer\",\n          }}\n        />\n      ) : null}\n        {renderInfo ? (\n        <OverlayTrigger\n          trigger={[\"hover\", \"focus\"]}\n          placement=\"auto\"\n          overlay={\n            <Popover id={key}>\n              <Popover.Header as=\"h3\">Projection information</Popover.Header>\n              <Popover.Body>\n                {renderInfo()}\n              </Popover.Body>\n            </Popover>\n          }\n        >\n          <i\n            className=\"fas fa-fw fa-info-circle react-grid-item-hidden\"\n            style={{\n              position: \"absolute\",\n              zIndex: 1,\n              top: 3,\n              left: 30,\n              cursor: \"pointer\",\n            }}\n          />\n        </OverlayTrigger>\n      ) : null}\n      {onSettings ? (\n        <i\n          className=\"fas fa-fw fa-cog react-grid-item-hidden\"\n          title=\"Change settings\"\n          onClick={onSettings}\n          style={{\n            position: \"absolute\",\n            zIndex: 1,\n            top: 3,\n            left: 55,\n            cursor: \"pointer\",\n          }}\n        />\n      ) : null}\n      {onClose ? (\n        <i\n          className=\"fas fa-fw fa-times react-grid-item-hidden\"\n          title=\"Close\"\n          onClick={onClose}\n          style={{\n            position: \"absolute\",\n            zIndex: 1,\n            top: 3,\n            left: 80,\n            cursor: \"pointer\",\n          }}\n        />\n      ) : null}\n      {children}\n    </>\n  )\n);\n","import * as React from \"react\";\nimport GridLayout, { WidthProvider, Layout } from \"react-grid-layout\";\n\nconst SizedGridLayout = WidthProvider(GridLayout);\n\ndeclare type GridChild = React.ReactElement<{\n  key: Layout[\"i\"];\n  gridOptions?: Partial<Layout>;\n}>;\n\nexport const Grid = ({ children: _children }: { children: GridChild | GridChild[] }) => {\n  const [layout, setLayout] = React.useState<Layout[] | null>();\n\n  const children = React.useMemo(() => (!_children || Array.isArray(_children) ? _children.flat() : [_children]).filter((c) => c?.key), [\n    _children,\n  ]);\n\n  React.useEffect(() => {\n    const validChildren = children.filter((c) => c?.key != null);\n    const missingLayout = validChildren.filter((c) => !layout?.find((l) => l.i === c.key));\n\n    if (missingLayout.length > 0) {\n      setLayout([\n        ...(layout?.filter((l) => validChildren.find((c) => c.key === l.i)) || []),\n        ...missingLayout.map((c, i) => ({\n          // @ts-ignore\n          i: c.key as string,\n          h: 15,\n          w: 6,\n          x: i % 2 === 0 ? 0 : 6,\n          y: 1,\n          ...(c?.props?.gridOptions || {}),\n        })),\n      ]);\n    }\n  }, [children, layout]);\n\n  return layout ? (\n    <SizedGridLayout\n      draggableHandle=\".react-grid-item-drag-handle\"\n      cols={12}\n      rowHeight={10}\n      className=\"flex-fill\"\n      // preventCollision={true}\n      verticalCompact={true}\n      layout={layout}\n      compactType=\"horizontal\"\n      onLayoutChange={(layout) => {\n        window.dispatchEvent(new Event(\"resize\"));\n        setLayout(layout);\n      }}\n    >\n      {children.map((c) => (\n        <div key={c.key}>{c}</div>\n      ))}\n    </SizedGridLayout>\n  ) : null;\n};\n","import * as React from \"react\";\nimport { Figure } from \"react-plotly.js\";\nimport { ICollection, IParticleSelection } from \"../interfaces\";\nimport { PlotComponent, PLOTLY_CONFIG } from \"./PlotComponent\";\nimport { max, min } from \"d3-array\";\nimport Select, { OptionsType } from \"react-select\";\nimport isEqual from \"lodash.isequal\";\nimport { GridItemOptions } from \"./GridItemOptions\";\nimport { Grid } from \"./Grid\";\nimport { DEFAULT_COLORWAY, DEFAULT_PLOTLY_COLORSCALE } from \"../utils/constants\";\n\nexport interface IParallelCoordinatesPlotProps {\n  collections: ICollection[];\n  selection: IParticleSelection;\n  setSelection(selected: IParticleSelection): void;\n  /**\n   * Currently filtered selection. If passed, only the coordinates of filtered items are shown.\n   */\n  filterSelection?: IParticleSelection;\n}\n\ninterface ISelectOption {\n  label: string;\n  value: string;\n  order: \"asc\" | \"desc\";\n}\n\nexport const ParallelCoordinatesPlot = React.memo(({ collections, selection, setSelection, filterSelection }: IParallelCoordinatesPlotProps) => {\n  const [figureState, setFigureState] = React.useState<Figure | null>(null);\n  const [enabledProperties, setEnabledProperties] = React.useState<OptionsType<ISelectOption>>([]);\n  const [colorProperty, setColorProperty] = React.useState<ISelectOption | null>(null);\n  // const [selection, setSelection] = React.useState<IParticleSelection | null>(null);\n  const [constraintRange, setConstraintRange] = React.useState<{ [key: string]: [number, number][] } | null>(null);\n\n  const filteredCollections = React.useMemo(() => collections.filter((c) => !c.hidden), [collections]);\n  const availableProperties = React.useMemo(\n    () =>\n      Array.from(\n        new Set(\n          filteredCollections\n            .map((c) =>\n              Object.keys(c.data[0]?.properties || {})\n                // TODO: Find other condition\n                // .filter(([key, value]) => typeof value === \"number\")\n                // .map(([key, value]) => key)\n            )\n            .flat()\n        )\n      ),\n    [filteredCollections]\n  );\n\n  React.useEffect(() => {\n    // Cleanup\n    // setFilterSelection(null);\n    setConstraintRange(null);\n    // setSelection(null);\n  }, [filteredCollections, enabledProperties]);\n\n  React.useEffect(() => {\n    setFigureState((figureState) => {\n      if (enabledProperties.length < 2) {\n        return null;\n      }\n\n      const filtered = Object.values(filterSelection || {}).flat();\n      const all = filtered.length > 0 ? filtered : filteredCollections.map((c) => c.data).flat().slice(0, 500);\n\n      const newFigureState: Figure = {\n        frames: [],\n        layout: {\n          ...(figureState?.layout || {}),\n          autosize: true,\n          colorway: DEFAULT_COLORWAY,\n          showlegend: true,\n        },\n        data: [\n          {\n            // @ts-ignore\n            type: \"parcoords\",\n            line: {\n              //   // TODO Make semi-transparent,\n              // @ts-ignore\n              showscale: colorProperty ? false : false,\n              // colorscale: [\n              //   ['0.0', DEFAULT_COLORWAY[0] + '0a'],\n              //   ['1.0', DEFAULT_COLORWAY[1] + '0a']\n              // ],\n              // If we don't have a numeric scale, use a color map for the filteredCollections instead\n              // colorscale: colorProperty ? \"Portland\" : filteredCollections.map((c, i) => [i, DEFAULT_COLORWAY[i]]),\n              ...DEFAULT_PLOTLY_COLORSCALE,\n              color: colorProperty ? all.map((p) => p.properties![colorProperty.value] as number) : filteredCollections.map((c, i) => Array(c.data.length).fill(i.toString())).flat(),\n            },\n            // @ts-ignore\n            dimensions: [\n              ...enabledProperties.map(({ value, order }) => {\n                const values = all.map((p) => p.properties![value] as number);\n                const minValue = min(values);\n                const maxValue = max(values);\n                if (minValue == null || maxValue == null) {\n                  return null;\n                }\n                const range = [Math.min(0, minValue), maxValue];\n\n                return {\n                  range: order === \"desc\" ? range : range.reverse(),\n                  constraintrange: constraintRange?.[value],\n                  values,\n                  label: value,\n                };\n              }),\n            ],\n          },\n        ],\n      };\n      console.log(newFigureState)\n      return newFigureState;\n    });\n  }, [filteredCollections, filterSelection, enabledProperties, constraintRange, colorProperty]);\n\n  return (\n    <div className=\"d-flex flex-column flex-fill\">\n      <form>\n        <div className=\"row\">\n          <div className=\"col-md-10 mb-3\">\n            <label htmlFor=\"propertiesSelect\">Properties</label>\n            <Select<ISelectOption, true>\n              menuPosition=\"fixed\"\n              isMulti\n              className=\"mb-3\"\n              name=\"propertiesSelect\"\n              value={enabledProperties}\n              onChange={(e) => {\n                setEnabledProperties(e);\n              }}\n              options={availableProperties.map((p) => ({\n                value: p,\n                label: p,\n                order: \"desc\",\n              }))}\n              openMenuOnClick={false}\n              closeMenuOnSelect={false}\n              formatOptionLabel={(option, meta) => {\n                if (meta.context === \"value\") {\n                  return (\n                    <div className=\"d-flex flex-row align-items-center\">\n                      <span title={option.label} className=\"text-truncate\" style={{ maxWidth: 150 }}>\n                        {option.label}\n                      </span>\n                      <i\n                        role=\"button\"\n                        title=\"Change axis order\"\n                        className={`fas fa-fw fa-sort-amount-${option.order === \"asc\" ? \"up-alt\" : \"down\"} ms-1 me-1 `}\n                        onClick={(e) => {\n                          setEnabledProperties(\n                            enabledProperties.map((p) =>\n                              p === option\n                                ? {\n                                    ...p,\n                                    order: p.order === \"asc\" ? \"desc\" : \"asc\",\n                                  }\n                                : p\n                            )\n                          );\n                        }}\n                      />\n                    </div>\n                  );\n                }\n                return option.label;\n              }}\n            />\n          </div>\n          <div className=\"col-md-2 mb-3\">\n            <label htmlFor=\"colorBySelect\">Color By</label>\n            <Select<ISelectOption, false>\n              menuPosition=\"fixed\"\n              className=\"mb-3\"\n              name=\"colorBySelect\"\n              value={colorProperty}\n              isClearable={true}\n              onChange={(e) => {\n                setColorProperty(e);\n              }}\n              options={availableProperties.map((p) => ({\n                value: p,\n                label: p,\n                order: \"desc\",\n              }))}\n            />\n          </div>\n        </div>\n      </form>\n\n      {figureState ? (\n        <>\n          <Grid>\n            <GridItemOptions\n              enableMove={false}\n              key=\"parcoordsGridItem\"\n              gridOptions={{\n                w: 12,\n                h: 25,\n                y: 0,\n                x: 0,\n              }}\n            >\n            <i\n              className=\"fas fa-fw fa-sync-alt react-grid-item-hidden\"\n              title=\"Sync global selection with plot (up to 1000)\"\n              onClick={() => {\n                const allSelected = Object.values(selection || {}).flat();\n                if (allSelected.length <= 1000) {\n                  // If we have below a certain threshold of items, we can create the constraint range for each individual one\n                  setConstraintRange(\n                    enabledProperties.reduce((acc, { value }) => {\n                      return {\n                        ...acc,\n                        [value]: allSelected.map((p) => p.properties![value] as number).map((v) => [v, v + 0.0001]),\n                      };\n                    }, {})\n                  );\n                } else {\n                  setConstraintRange(null);\n                  // TODO: Check if current range is sufficient for current selection\n                  // setConstraintRange((currentRange) => {\n                  //   const allIncluded = allSelected.every((p) => Object.entries(currentRange || {}).every(([key, allRanges]) => {\n                  //     return allRanges.some(\n                  //       (range) => p.properties?.[key]! >= range[0] && p.properties?.[key]! <= range[1]\n                  //     );\n                  //   }));\n                  //   return allIncluded ? currentRange : null;\n                  // });\n                }\n              }}\n              style={{\n                position: \"absolute\",\n                zIndex: 1,\n                top: 3,\n                left: 55,\n                cursor: \"pointer\",\n              }}\n            />\n            <i\n              className=\"fas fa-fw fa-ban react-grid-item-hidden\"\n              title=\"Clear selection\"\n              onClick={() => {\n                setConstraintRange(null);\n              }}\n              style={{\n                position: \"absolute\",\n                zIndex: 1,\n                top: 3,\n                left: 80,\n                cursor: \"pointer\",\n              }}\n            />\n              <PlotComponent\n                style={{\n                  width: \"99%\",\n                  height: \"100%\",\n                }}\n                data={figureState.data}\n                layout={figureState.layout}\n                config={PLOTLY_CONFIG}\n                onRestyle={() => {\n                  // @ts-ignore\n                  const filter: { [key: string]: [number, number][] } = figureState.data[0].dimensions\n                    // @ts-ignore\n                    .filter((dim) => dim?.constraintrange)\n                    .reduce(\n                      // @ts-ignore\n                      (acc, cur) =>\n                        cur.constraintrange?.length > 0 ? { ...acc, [cur.label]: typeof cur.constraintrange[0] === 'number' ? [cur.constraintrange] : cur.constraintrange } : acc,\n                      {}\n                    );\n\n                  if (Object.entries(filter).length > 0) {\n                    const valid = filteredCollections.reduce(\n                      (acc, c) => ({\n                        ...acc,\n                        [c.name]: c.data.filter((p) =>\n                          Object.entries(filter).every(([key, allRanges]) => {\n                            return allRanges.some(\n                              (range) => p.properties?.[key]! >= range[0] && p.properties?.[key]! <= range[1]\n                            );\n                          })\n                        ),\n                      }),\n                      {}\n                    );\n                    setConstraintRange(filter);\n                    setSelection(Object.entries(valid).length > 0 ? valid : null);\n                  } else {\n                    setConstraintRange(null);\n                    setSelection(null);\n                  }\n                }}\n                onUpdate={(figure) => {\n                  // Synchronize ordering of parallel coordinates with select\n                  // @ts-ignore\n                  const newOrdering: string[] = figure.data?.[0].dimensions.filter(Boolean).map((d) => d.label);\n                  if (\n                    newOrdering &&\n                    !isEqual(\n                      newOrdering,\n                      enabledProperties.map((e) => e.value)\n                    )\n                  ) {\n                    setEnabledProperties(\n                      newOrdering.map((value) => enabledProperties.find((e) => e.value === value)!).filter(Boolean)\n                    );\n                  }\n                  // Inline save the figure to save the zoom\n                  //   figureState.data = figure.data;\n                  //   figureState.frames = figure.frames;\n                  //   figureState.layout = figure.layout;\n                }}\n              />\n            </GridItemOptions>\n          </Grid>\n        </>\n      ) : (\n        <p>Please select at least 2 properties from the dropdown.</p>\n      )}\n    </div>\n  );\n});\n","import { buildRanking, NumberColumn, Ranking, Taggle } from \"lineupjs\";\nimport * as React from \"react\";\nimport Select from \"react-select/creatable\";\nimport { ICollection, INearestNeighbors, IParticle, IParticleSelection } from \"../interfaces\";\nimport { normalizeArray, toNumber } from \"../utils\";\nimport { DEFAULT_PLOTLY_COLORSCALE } from \"../utils/constants\";\nimport { PlotComponent, PLOTLY_CONFIG } from \"./PlotComponent\";\nimport { LineupWrapper } from \"./ranking/LineupWrapper\";\nimport { StructureImageColumn } from \"./ranking/StructureImageColumn\";\nimport { StructureImage } from \"./StructureImage\";\n\nfunction getKNNByMetric(\n  particles: IParticle[],\n  reference: IParticle,\n  getter: (particle: IParticle) => number\n): INearestNeighbors {\n  const values = particles.map((particle) => getter(particle));\n  const referenceValue = getter(reference);\n  const difference = values\n    .map((value, index) => ({ diff: Math.abs(value - referenceValue), index }))\n    .sort((a, b) => a.diff - b.diff)\n    .slice(0, 50);\n  return {\n    distance_metric: \"absolute_difference\",\n    knn_ind: difference.map(({ index }) => index),\n    knn_dist: difference.map(({ diff }) => diff),\n    knn_particles: difference.map(({ index }) => particles[index]),\n  };\n}\n\nexport function LocalNeighborhoodPlot({\n  selected,\n  collection,\n}: {\n  selected: IParticle | null | undefined;\n  collection: ICollection | null | undefined;\n  setHover(hover: IParticle | null): void;\n  hover: IParticle | null;\n}) {\n  const [hover, setHover] = React.useState<IParticle | null>(null);\n  const [selection, setSelection] = React.useState<Set<IParticle>>(new Set());\n  const [referenceEmbedding, setReferenceEmbedding] = React.useState<string>(\"\");\n  const [enabledEmbeddings, setEnabledEmbeddings] = React.useState<string[]>([]);\n\n  React.useEffect(() => {\n    setHover(null);\n    setSelection(new Set());\n  }, [selected]);\n\n  const allAvailableProperties = React.useMemo(() => Object.keys(selected?.properties || {}), [selected]);\n  /* const allAvailableEmbeddings = React.useMemo(\n    () =>\n      Object.entries({\n        ...(selected?.nearest_neighbors || {}),\n        // TODO: Enable to allow properties as \"distance\"\n        // ...Object.fromEntries(\n        //   collection && selected\n        //     ? allAvailableProperties\n        //         .filter(([key, value]) => typeof value === \"number\")\n        //         .map(([key, value]) => [\n        //           key,\n        //           getKNNByMetric(collection.data, selected, (p) => p.properties[key] as number),\n        //         ])\n        //     : []\n        // ),\n      }),\n    [selected, collection, allAvailableProperties]\n  ); */\n\n  const filteredAvailableEmbeddings = React.useMemo(\n    () =>\n      enabledEmbeddings.length === 0 || !selected\n        ? []\n        : enabledEmbeddings\n            .map((e) => [e, selected.nearest_neighbors?.[e]!] as [string, INearestNeighbors])\n            .filter(([key, value]) => key && value),\n    [enabledEmbeddings, selected]\n  );\n\n  const getRankingBuilders = React.useCallback(() => {\n    // For each available embedding, create a ranking\n    return filteredAvailableEmbeddings.map(([key, value], i) => {\n      const rankingBuilder = buildRanking();\n      // rankingBuilder.column('_rank');\n      rankingBuilder.column(\"structure\");\n      if (i === 0) {\n        rankingBuilder.column(\"Occurances\");\n      }\n      rankingBuilder.column(`Distance_${key}`);\n      rankingBuilder.sortBy(`Distance_${key}`);\n      // rankingBuilder.allColumns();\n      return rankingBuilder;\n    });\n  }, [filteredAvailableEmbeddings]);\n\n  const adjustRankings = React.useCallback((lineup: Taggle, rankings: Ranking[]) => {\n    rankings.forEach((ranking) => {\n      const distanceColumn = ranking.flatColumns.find(\n        (col) => col instanceof NumberColumn && col.desc.label.toLowerCase().startsWith(\"distance\")\n      ) as NumberColumn | undefined;\n      // distanceColumn\n      distanceColumn?.setFilter({\n        filterMissing: true,\n        min: -Infinity,\n        max: Infinity,\n      });\n      // distanceColumn?.on(\"filterChanged\", (prev, current) => console.log(current));\n    });\n  }, []);\n\n  // Compute the \"histogram\" of index occurances --> the more often it occurs, the \"better\" the neighbor is\n  const indexOccurances = React.useMemo(\n    () =>\n      filteredAvailableEmbeddings.reduce<{ [index: number]: number }>((acc, [key, value]) => {\n        value.knn_ind.forEach((v) => {\n          acc[v] = (acc[v] || 0) + 1;\n        });\n        return acc;\n      }, {}),\n    [filteredAvailableEmbeddings]\n  );\n\n  const selectionCollections = React.useMemo(\n    () => [\n      {\n        name: \"Selection\",\n        data: (selection.size > 0\n          ? Array.from(selection)\n          : Array.from(new Set(filteredAvailableEmbeddings.map(([key, value]) => value.knn_particles).flat()))\n        ).map((p) => ({\n          ...p,\n          // Additionally store the original particle as reference for selection synchronization\n          originalParticle: p,\n          properties: {\n            Occurances: filteredAvailableEmbeddings\n              .filter(([key, value]) => value.knn_particles.includes(p))\n              .map(([key, value]) => key!) as any,\n            ...p.properties,\n            ...filteredAvailableEmbeddings.reduce<{ [key: string]: number | null }>((acc, [key, value]) => {\n              const index = value.knn_particles.indexOf(p);\n              acc[`Distance_${key}`] = index >= 0 ? value.knn_dist[index] : null;\n              return acc;\n            }, {}),\n          },\n        })),\n      },\n    ],\n    [selection, filteredAvailableEmbeddings]\n  );\n\n  const setSelectedFromLineup = React.useCallback(\n    (selection: IParticleSelection) =>\n      setHover(\n        // @ts-ignore\n        Object.values(selection || {}).flat()?.[0]?.originalParticle\n      ),\n    []\n  );\n\n  const normalizedDistances = React.useMemo(\n    () =>\n      Object.fromEntries(\n        filteredAvailableEmbeddings.map(([key, value]) => [key, normalizeArray(value.knn_dist, [0, 1])])\n      ),\n    [filteredAvailableEmbeddings]\n  );\n  const referenceIndexToDist = React.useMemo(() => {\n    const referenceNN = selected?.nearest_neighbors?.[referenceEmbedding];\n    return referenceNN && normalizedDistances[referenceEmbedding]\n      ? Object.fromEntries(referenceNN.knn_ind.map((cur, i) => [cur, normalizedDistances[referenceEmbedding][i]]))\n      : null;\n  }, [selected, referenceEmbedding, normalizedDistances]);\n\n  const plotDataLines = React.useMemo(() => {\n    const data: Partial<Plotly.PlotData>[] = [];\n    // For all embedding pairs (y-values)\n    filteredAvailableEmbeddings.forEach(([key, value], i) => {\n      if (i < 1) {\n        return;\n      }\n      const [previousKey, previousValue] = filteredAvailableEmbeddings[i - 1];\n      const previousInd = new Set(previousValue.knn_ind);\n      // console.log(selection.size > 0\n      //   ? value.knn_particles.map((v, i) => (selection.has(v) ? i : null)).filter((i) => i != null)\n      //   : undefined);\n      // Go through all nearest neighbors\n      value.knn_ind.forEach((ind, i) => {\n        // Check if the nearest neighbor is also in the previous track\n        if (previousInd.has(ind) && (selection.size === 0 || selection.has(value.knn_particles[i]))) {\n          // Retrieve the x values for the current and previous track\n          const x = normalizedDistances[key][i];\n          const previousX = normalizedDistances[previousKey][previousValue.knn_ind.indexOf(ind)];\n          // Add a line to the plot for exactly this pair\n          data.push({\n            x: [previousX, x],\n            y: [previousKey, key],\n            type: \"scatter\",\n            mode: \"lines\",\n            showlegend: false,\n            legendgroup: \"Pairwise Connections\",\n            opacity: Math.abs(previousX - x) / (value.knn_ind.length / 5),\n            line: {\n              color: \"gray\",\n            },\n          });\n        }\n      });\n    });\n    return data;\n  }, [filteredAvailableEmbeddings, normalizedDistances, selection]);\n\n  const plotDataSelection = React.useMemo<Partial<Plotly.PlotData>[]>(() => {\n    const selectedXValues = hover\n      ? filteredAvailableEmbeddings.map(([key, value], i) => {\n          const index = value.knn_particles.indexOf(hover);\n\n          console.log(\n            hover.index,\n            value.knn_particles,\n            value.knn_particles.find((p) => p.index === hover.index)\n          );\n          return index >= 0 ? normalizedDistances[key][index] : NaN;\n        })\n      : null;\n\n    if (selectedXValues) {\n      return [\n        {\n          x: selectedXValues.map((v) => (isNaN(v) ? 1 : v)),\n          y: filteredAvailableEmbeddings.map(([key, value]) => key),\n          type: \"scatter\",\n          mode: \"lines+markers\",\n          showlegend: false,\n          line: {\n            color: \"gold\",\n          },\n          marker: {\n            color: selectedXValues.map((v) => (isNaN(v) ? \"red\" : \"gold\")),\n            // size: selectedXValues.map((v) => isNaN(v) ? 0 : 10)\n          },\n        },\n      ];\n    }\n    return [];\n  }, [filteredAvailableEmbeddings, hover, normalizedDistances]);\n\n  const plotDataScatter = React.useMemo(() => {\n    return filteredAvailableEmbeddings.map(([key, value], i) => {\n      // By default, color each point by the number of occurances in the different embeddings\n      let color: Plotly.Color = value.knn_ind.map((ind) => indexOccurances[ind] / filteredAvailableEmbeddings.length);\n      //   If we have a reference, color each point by the position in the reference embedding\n      if (referenceIndexToDist) {\n        color = value.knn_ind.map((ind) => referenceIndexToDist[ind] || NaN);\n      } else if (referenceEmbedding && referenceEmbedding.startsWith(\"property=\")) {\n        color = value.knn_particles.map((p) => toNumber(p.properties[referenceEmbedding.slice(\"property=\".length)]));\n      }\n\n      return {\n        x: normalizedDistances[key],\n        y: value.knn_dist.map(() => key),\n        text: value.knn_dist.map((dist) => `${dist} (${value.distance_metric})`),\n        hoverinfo: \"none\" as const,\n        name: key,\n        type: \"scatter\" as const,\n        mode: \"markers\" as const,\n        customdata: value.knn_particles.map((p) => p.index!),\n        selectedpoints:\n          selection.size > 0\n            ? value.knn_particles.map((v, i) => (selection.has(v) ? i : null)).filter((i) => i != null)\n            : undefined,\n        showlegend: false,\n        showscale: true,\n        // line: {\n        //   width: 0\n        // },\n        marker: {\n          //   opacity: value.knn_ind.map((ind) => indexOccurances[ind] / filteredAvailableEmbeddings.length),\n          opacity: 0.4,\n          //   color: value.knn_ind.map((ind) => indexOccurances[ind] / filteredAvailableEmbeddings.length),\n          color,\n          coloraxis: \"coloraxis\",\n        },\n      };\n    });\n  }, [\n    filteredAvailableEmbeddings,\n    indexOccurances,\n    normalizedDistances,\n    referenceEmbedding,\n    referenceIndexToDist,\n    selection,\n  ]);\n\n  const data: Partial<Plotly.PlotData>[] = [...plotDataLines, ...plotDataSelection, ...plotDataScatter];\n\n  const getPointsFromEvent = (e: Pick<Plotly.PlotMouseEvent, \"points\">): IParticle[] => {\n    return collection\n      ? Array.from(\n          new Set(\n            e?.points\n              ?.sort((a, b) => +a.x! - +b.x!)\n              // TODO: This should be an collection.data[p.customdata] but it gives wrong indices after adding a property embedding.\n              ?.map((p) => collection.data.find((d) => d.index === (p.customdata as number))!)\n          )\n        ).filter(Boolean)\n      : [];\n  };\n\n  return (\n    <div\n      className=\"d-flex flex-column\"\n      style={{\n        position: \"relative\",\n        // overflowY: 'scroll',\n        // minHeight: 500\n      }}\n    >\n      <p className=\"text-muted\">\n        Inspect the nearest neighbors in the embedding spaces of the selected or hovered structure. Each embedding shows\n        the top-N nearest neighbors according to its distance metric. Generally, the color encodes in how many\n        embeddings a specific neighbor is also listed as neighbor, or if a reference embedding is given, it shows the\n        color of the position in the reference embedding (or black if it is no common neighbor).\n      </p>\n      {selected && collection ? (\n        <>\n          <div className=\"row\">\n            <div className=\"col d-flex flex-column align-items-center justify-content-center\">\n              <strong>Selected</strong>\n              {selected?.structure ? (\n                <StructureImage\n                  style={{ width: \"100%\" }}\n                  structure={selected.structure}\n                  align={undefined /* selected?.structure */}\n                />\n              ) : null}\n            </div>\n            <div className=\"col d-flex flex-column align-items-center\">\n              <strong>Hovered</strong>\n              {hover?.structure ? (\n                <StructureImage\n                  style={{ width: \"100%\" }}\n                  structure={hover.structure}\n                  align={undefined /* selected?.structure */}\n                />\n              ) : null}\n            </div>\n            <div className=\"col d-flex flex-column align-items-center\">\n              <strong>Similarity Map</strong>\n              {selected?.structure && hover?.structure ? (\n                <StructureImage\n                  style={{ width: \"100%\" }}\n                  structure={[selected.structure, hover.structure]}\n                  align={selected?.structure}\n                />\n              ) : null}\n            </div>\n          </div>\n          <div className=\"row\">\n            <div className=\"col-md-8 mb-3\">\n              <label>Enabled embeddings</label>\n              <Select<{ label: string; value: string }, true>\n                menuPosition=\"fixed\"\n                isMulti\n                value={enabledEmbeddings.map((p) => ({\n                  label: p,\n                  value: p,\n                }))}\n                onChange={(e) => {\n                  setEnabledEmbeddings(e.map((p) => p.value));\n                }}\n                options={[\n                  ...Object.entries(selected?.nearest_neighbors || {}).map(([key, value]) => ({\n                    label: `${key} (${value.distance_metric})`,\n                    value: key,\n                  })),\n                  ...allAvailableProperties.map((property) => ({\n                    label: `Property: ${property}`,\n                    value: `property=${property}`,\n                  })),\n                ]}\n                closeMenuOnSelect={false}\n              />\n            </div>\n            <div className=\"col-md-4 mb-3\">\n              <label>Color by</label>\n              <Select<{ label: string; value: string }, false>\n                menuPosition=\"fixed\"\n                value={\n                  referenceEmbedding\n                    ? {\n                        label: referenceEmbedding,\n                        value: referenceEmbedding,\n                      }\n                    : null\n                }\n                isClearable={true}\n                onChange={(e) => {\n                  setReferenceEmbedding(e?.value || \"\");\n                }}\n                options={[\n                  ...Object.entries(selected?.nearest_neighbors || {})\n                    .map(([key, value]) => key)\n                    .map((key) => ({\n                      label: key,\n                      value: key,\n                    })),\n                  ...allAvailableProperties.map((property) => ({\n                    label: `Property: ${property}`,\n                    value: `property=${property}`,\n                  })),\n                ]}\n              />\n            </div>\n          </div>\n          {data.length > 0 ? (\n            <>\n              <PlotComponent\n                className=\"mt-3 mb-5\"\n                style={{ width: \"100%\", height: filteredAvailableEmbeddings.length * 40 + 50 }}\n                data={data}\n                layout={{\n                  dragmode: \"lasso\",\n                  hovermode: \"closest\",\n                  autosize: true,\n                  legend: {\n                    // x: 1,\n                    // xanchor: \"right\",\n                    // y: 1,\n                    orientation: \"h\",\n                  },\n                  // @ts-ignore\n                  coloraxis: {\n                    // cmin: referenceIndexToDist ? undefined : 0,\n                    // cmax: referenceIndexToDist ? undefined : 1,\n                    // cmin: 0,\n                    // cmax: 1,\n                    ...DEFAULT_PLOTLY_COLORSCALE,\n                    colorbar: {\n                      title: \"Distance\",\n                      titleside: \"top\",\n                      thickness: 10,\n                      outlinewidth: 0,\n                      lenmode: \"fraction\",\n                      len: 0.75,\n                      yanchor: \"center\",\n                    },\n                  },\n                  scene: {\n                    aspectmode: \"data\",\n                  },\n                  margin: {\n                    // l: 250,\n                    r: 0,\n                    b: 0,\n                    t: 50,\n                    // pad: 4,\n                  },\n                  yaxis: {\n                    categoryorder: \"array\",\n                    categoryarray: filteredAvailableEmbeddings.map(([key, value]) => key).reverse(),\n                  },\n                }}\n                config={PLOTLY_CONFIG}\n                onSelected={(e) => {\n                  setSelection(new Set(getPointsFromEvent(e)));\n                }}\n                onHover={(e) => {\n                  setHover(getPointsFromEvent(e)?.[0]);\n                }}\n                onUnhover={() => {\n                  setHover(null);\n                }}\n              />\n              <div style={{ flex: \"1 1 500px\", display: \"flex\", overflow: \"auto\" }}>\n                {selectionCollections ? (\n                  <LineupWrapper\n                    collections={selectionCollections}\n                    setSelected={setSelectedFromLineup}\n                    // align={hover?.structure}\n                    getRankingBuilders={enabledEmbeddings.length <= 1 ? undefined : getRankingBuilders}\n                    adjustRankings={enabledEmbeddings.length === 0 ? undefined : adjustRankings}\n                  />\n                ) : null}\n              </div>\n            </>\n          ) : null}\n        </>\n      ) : null}\n    </div>\n  );\n}\n","import * as React from \"react\";\nimport Select from \"react-select/creatable\";\nimport { ICollection, IParticle, IParticleSelection } from \"../interfaces\";\nimport { Tooltip } from \"../utils/hooks\";\nimport { PlotComponent, PLOTLY_CONFIG } from \"./PlotComponent\";\nimport { LineupWrapper } from \"./ranking/LineupWrapper\";\nimport { StructureImage } from \"./StructureImage\";\n\nconst LAYOUT: Partial<Plotly.Layout> = {\n  dragmode: \"lasso\",\n  hovermode: \"closest\",\n  autosize: true,\n  margin: {\n    // l: 250,\n    r: 0,\n    b: 0,\n    t: 50,\n    // pad: 4,\n  },\n};\n\nexport const GroupFlowSankeyPlot = React.memo(({\n  collections,\n  selection,\n}: //   setHover,\n//   hover,\n{\n  selection: IParticleSelection;\n  collections: ICollection[];\n}) => {\n  const [collection, setCollection] = React.useState<ICollection | null>(null);\n  const [enabledProperties, setEnabledProperties] = React.useState<string[]>([]);\n  const [selectionCollections, setSelectionCollections] = React.useState<ICollection[]>([]);\n  const allAvailableProperties = React.useMemo(() => Object.keys(collection?.data?.[0]?.properties || {}), [collection]);\n  const [hover, setHover] = React.useState<IParticle[] | null>(null);\n\n  const data = React.useMemo<Partial<Plotly.PlotData>[][]>(() => {\n    \n    if (!collection || enabledProperties.length < 2) {\n      return [];\n    }\n\n    const map = new Map<IParticle, number[]>();\n    // Each unique value has to have a unique id, i.e. running index in this case. Otherwise, one could not distinguish the same labels of different properties.\n    let valueIndex = 0;\n    const labels: string[] = [];\n    enabledProperties.forEach((property, i) => {\n      const valueLookup = new Map<string, number>();\n      collection.data.forEach((d) => {\n        const value = `${d.properties[property]}`;\n        if (!valueLookup.has(value)) {\n          valueLookup.set(value, valueIndex++);\n          labels.push(`${value}`);\n        }\n\n        if (!map.has(d)) {\n          map.set(d, []);\n        }\n        map.get(d)![i] = valueLookup.get(value)!;\n      });\n\n      valueLookup.clear();\n    });\n\n    // Add selection (if any)\n    const selected = selection?.[collection.name];\n    if(selected) {\n      selected.forEach((particle) => {\n        map.get(particle)?.push(valueIndex);\n      });\n\n      // Add to labels, increase value index\n      labels.push(\"Selection\");\n      valueIndex++;\n    }\n\n    const matrix: IParticle[][][] = new Array(valueIndex).fill(null).map(() => []);\n    map.forEach((assignments, particle) => {\n      assignments.slice(1).forEach((next, currentIndex) => {\n        const current = assignments[currentIndex];\n        matrix[current][next] = matrix[current][next] || [];\n        matrix[current][next].push(particle);\n      });\n    });\n\n    const link = {\n      source: [] as number[],\n      target: [] as number[],\n      value: [] as number[],\n      customdata: [] as IParticle[][]\n    };\n    matrix.forEach((toValues, from) => {\n      toValues.forEach((particles, to) => {\n        link.source.push(from);\n        link.target.push(to);\n        link.value.push(particles.length);\n        link.customdata.push(particles);\n      });\n    });\n\n    console.log(matrix);\n\n    return [[\n      {\n        type: \"sankey\",\n        orientation: \"h\",\n        arrangement: \"fixed\",\n        // @ts-ignore\n        node: {\n          // pad: 15,\n          // thickness: 30,\n          // line: {\n          // color: \"black\",\n          // width: 0.5,\n          // },\n          label: labels,\n          // groups: [[1,2,3, 4,5,6,7,8,9]]\n          // color: [\"blue\", \"blue\", \"blue\", \"blue\", \"blue\", \"blue\"],\n          customdata: matrix.map((to, i) => (to[i] || []).flat())\n        },\n        link: {\n          ...link,\n          // color: 'rgba(200, 200, 200, 10)'\n        },\n      },\n    ]];\n  }, [selection, collection, enabledProperties]);\n\n  return (\n    <div\n      className=\"d-flex flex-column\"\n      style={{\n        position: \"relative\",\n        // overflowY: 'scroll',\n        // minHeight: 500\n      }}\n    >\n      <Tooltip>\n        {hover ? <StructureImage structure={hover.map((h) => h.structure)}\n            style={{\n              width: 180,\n              backgroundColor: \"rgba(255, 255, 255, 0.6)\",\n            }} /> : null}\n      </Tooltip>\n      <p className=\"text-muted\"></p>\n      <div className=\"row\">\n        <div className=\"col-md-3 mb-3\">\n          <label>Collection</label>\n          <Select<{ label: string; value: ICollection }>\n            menuPosition=\"fixed\"\n            value={collection ? { label: collection.name, value: collection } : null}\n            onChange={(e) => {\n              setCollection(e?.value || null);\n            }}\n            options={collections.map((c) => ({\n              label: c.name,\n              value: c,\n            }))}\n          />\n        </div>\n        <div className=\"col-md-9 mb-3\">\n          <label>Group by</label>\n          <Select<{ label: string; value: string }, true>\n            menuPosition=\"fixed\"\n            isDisabled={!collection}\n            isMulti\n            value={enabledProperties.map((p) => ({\n              label: p,\n              value: p,\n            }))}\n            onChange={(e) => {\n              setEnabledProperties(e.map((p) => p.value));\n            }}\n            options={allAvailableProperties.map((property) => ({\n              label: property,\n              value: property,\n            }))}\n            closeMenuOnSelect={false}\n          />\n        </div>\n      </div>\n      {data.length > 0 ? (\n        <> \n          {data.map((d, i) => <div><PlotComponent\n            key={i}\n            className=\"mt-3 mb-5\"\n            style={{ width: \"100%\", height: 500 }}\n            data={d}\n            layout={LAYOUT}\n            config={PLOTLY_CONFIG}\n            onClick={(e) => {\n              setSelectionCollections(e.points.map((p) => ({data: p.customdata as unknown as IParticle[], name: 'Selection' })));\n            }}\n            onHover={(e) => {\n              const hoveredPoints = (e.points?.map((p) => (p.customdata as unknown as  IParticle[]) || []).flat() || []);\n              setHover(hoveredPoints.length > 0 ? hoveredPoints : null);\n            }}\n            onUnhover={() => {\n              setHover(null);\n            }}\n          /></div>)}\n          <div style={{ flex: \"1 1 500px\", display: \"flex\", overflow: \"auto\" }}>\n            {selectionCollections ? (\n                  <LineupWrapper\n                    collections={selectionCollections}\n                    // setSelected={setSelectedFromLineup}\n                    // getRankingBuilders={enabledEmbeddings.length === 0 ? undefined : getRankingBuilders}\n                    // adjustRankings={enabledEmbeddings.length === 0 ? undefined : adjustRankings}\n                  />\n                ) : null}\n          </div>\n        </>\n      ) : null}\n    </div>\n  );\n});\n","import * as React from \"react\";\nimport { Modal, Button } from \"react-bootstrap\";\nimport { StructureCard } from \"./components/StructureCard\";\nimport { StructureCardGrid } from \"./components/StructureCardGrid\";\nimport { StructureImage } from \"./components/StructureImage\";\nimport { ICollection, IParticle, IParticleSelection, IServerCollection } from \"./interfaces\";\nimport groupByLodash from \"lodash.groupby\";\nimport { embedStructures, getTanimotoSimilarity } from \"./utils/api\";\nimport { PlotComponent, PLOTLY_CONFIG } from \"./components/PlotComponent\";\nimport { useNameInput } from \"./utils/hooks\";\nimport { FormWrapper } from \"./components/form\";\nimport { ButtonWithUpload } from \"./components/ButtonWithUpload\";\nimport cloneDeepWith from \"lodash.clonedeepwith\";\nimport { ParallelCoordinatesPlot } from \"./components/ParallelCoordinatesPlot\";\nimport { downloadCSVFile, normalizeArray } from \"./utils\";\nimport { Tabs, Tab } from \"react-bootstrap\";\nimport { extent } from \"d3-array\";\nimport { LocalNeighborhoodPlot } from \"./components/LocalNeighborhoodPlot\";\nimport Select from \"react-select/src/Select\";\nimport { GroupFlowSankeyPlot } from \"./components/GroupFlowSankeyPlot\";\n\nexport const ClusterSidePanel = React.memo(\n  ({\n    collections,\n    setCollections,\n    selection,\n    setSelection,\n    hover,\n    setHover,\n    setVisibleNeighborhoodSamplings,\n  }: {\n    collections: ICollection[];\n    setCollections(collections: ICollection[]): void;\n    selection: IParticleSelection;\n    setSelection(selected: IParticleSelection): void;\n    hover: IParticle | null;\n    setHover(hover: IParticle | null): void;\n    setVisibleNeighborhoodSamplings(collection: IParticle[] | null): void;\n  }) => {\n    const selectedParticles = React.useMemo<IParticle[]>(\n      () => (selection ? ([] as IParticle[]).concat(...Object.values(selection)) : []),\n      [selection]\n    );\n\n    const hoverOrSelected = hover || (selectedParticles.length === 1 ? selectedParticles[0] : null);\n    const selectedOrHover = (selectedParticles.length === 1 ? selectedParticles[0] : null) || hover;\n\n    const [lastHoverOrSelected, setHoverOrLastSelected] = React.useState<IParticle | null>(hoverOrSelected);\n\n    React.useEffect(() => {\n      if (hoverOrSelected) {\n        setHoverOrLastSelected(hoverOrSelected);\n      }\n    }, [hoverOrSelected]);\n\n    const selectionCollection =\n      selection && Object.entries(selection).length === 1\n        ? collections.find((c) => c.name === Object.keys(selection)[0])\n        : null;\n    const [visibleProjectionModels, setVisibleProjectionModels] = React.useState<\n      IServerCollection[\"projections\"] | null\n    >(null);\n\n    const [name, setName, nameInput] = useNameInput(\"newCollectionNameInput\", \"\");\n    const [recomputeEmbeddings, setRecomputeEmbeddings] = React.useState<boolean>(false);\n    const [knnEmbeddingKey, setKnnEmbeddingKey] = React.useState<string>(\"\");\n    const [removeFromOriginal, setRemoveFromOriginal] = React.useState<boolean>(false);\n    const [includeNeighbors, setIncludeNeighbors] = React.useState<{ [key: string]: number } | null>(null);\n    const [newCollectionLoading, setNewCollectionLoading] = React.useState<boolean>(false);\n    const [showStructures, setShowStructures] = React.useState<\n      | {\n          type: \"selection\";\n        }\n      | {\n          type: \"collection\";\n          collection: ICollection;\n        }\n      | null\n    >(null);\n    const [rankingSelection, setRankingSelection] = React.useState<IParticleSelection>(null);\n    const [heatmapData, setHeatmapData] = React.useState<\n      { data: Partial<Plotly.PlotData>; layout: Partial<Plotly.Layout> }[] | null\n    >(null);\n    const [heatmapLoading, setHeatmapLoading] = React.useState<boolean>(false);\n    const [heatmapHover, setHeatmapHover] = React.useState<string[] | null>(null);\n    const [heatmapHoverIndices, setHeatmapHoverIndices] = React.useState<number[] | null>(null);\n\n    const [parallelCoordinatesCollections, setParallelCoordinatesCollections] = React.useState<ICollection[] | null>(\n      null\n    );\n\n    const structuresToShow = React.useMemo<ICollection[] | null>(() => {\n      if (showStructures) {\n        if (showStructures.type === \"collection\") {\n          return [showStructures.collection];\n        }\n        const filteredParticles = showStructures.type === \"selection\" ? selectedParticles : null;\n        return filteredParticles\n          ? Object.entries(groupByLodash(filteredParticles, \"collection\")).map(([name, data]) => ({ name, data }))\n          : null;\n      }\n      return null;\n    }, [showStructures, selectedParticles]);\n\n    return (\n      <>\n        <Modal show={Boolean(visibleProjectionModels)} onHide={() => setVisibleProjectionModels(null)} size=\"xl\">\n          <Modal.Header closeButton>\n            <Modal.Title>Available projection models</Modal.Title>\n          </Modal.Header>\n          <Modal.Body>\n            {visibleProjectionModels ? (\n              <ul>\n                {Object.entries(visibleProjectionModels)\n                  .filter(([name, value]) => value.model)\n                  .map(([name, value]) => (\n                    <li key={name} className=\"text-truncate\">\n                      {name}: <span title={value.model || \"\"}>{value.model}</span>\n                    </li>\n                  ))}\n              </ul>\n            ) : null}\n          </Modal.Body>\n        </Modal>\n        <Modal\n          show={Boolean(showStructures && structuresToShow)}\n          onHide={() => setShowStructures(null)}\n          size=\"xl\"\n          dialogClassName=\"modal-full-width\"\n        >\n          {showStructures && structuresToShow ? (\n            <>\n              <Modal.Header closeButton>\n                <Modal.Title>View {structuresToShow.reduce((a, b) => a + b.data.length, 0)} entries</Modal.Title>\n              </Modal.Header>\n              <Modal.Body\n                style={{\n                  display: \"flex\",\n                  flexDirection: \"column\",\n                }}\n              >\n                <StructureCardGrid collections={structuresToShow} setSelected={(s) => setRankingSelection(s)} />\n              </Modal.Body>\n              <Modal.Footer>\n                <Button\n                  variant=\"primary\"\n                  onClick={() => {\n                    setShowStructures(null);\n                    setSelection(rankingSelection);\n                  }}\n                  disabled={!rankingSelection}\n                >\n                  Save as new selection\n                </Button>\n                <Button variant=\"secondary\" onClick={() => setShowStructures(null)}>\n                  Close\n                </Button>\n              </Modal.Footer>\n            </>\n          ) : null}\n        </Modal>\n        <Modal\n          show={Boolean(heatmapData)}\n          onHide={() => setHeatmapData(null)}\n          size=\"xl\"\n          dialogClassName=\"modal-full-width\"\n        >\n          {heatmapData ? (\n            <>\n              <Modal.Header closeButton>\n                <Modal.Title>View correlation</Modal.Title>\n              </Modal.Header>\n              <Modal.Body\n                style={{\n                  display: \"flex\",\n                  flexDirection: \"column\",\n                }}\n              >\n                <div style={{ height: 210, visibility: heatmapHover ? \"visible\" : \"hidden\", margin: \"0px auto\" }}>\n                  {heatmapHover ? (\n                    <div className=\"d-flex flex-row align-items-center\" style={{ gap: 50 }}>\n                      {heatmapHover.map((structure) => (\n                        <StructureImage\n                          structure={structure}\n                          style={{\n                            width: 210,\n                          }}\n                        />\n                      ))}\n                      {heatmapHover.length > 1 ? (\n                        <StructureImage\n                          structure={heatmapHover}\n                          style={{\n                            width: 210,\n                          }}\n                        />\n                      ) : null}\n                    </div>\n                  ) : null}\n                </div>\n                <div className=\"d-flex flex-row\">\n                  {heatmapData.map(({ data, layout }, i) => (\n                    <PlotComponent\n                      style={{ height: \"100%\", flex: 1 }}\n                      onHover={(e) => {\n                        if (e.points[0]) {\n                          setHeatmapHover(Array.from(new Set([e.points[0].x as string, e.points[0].y as string])));\n                          setHeatmapHoverIndices(e.points[0].pointIndex as any as number[]);\n                        }\n                      }}\n                      onUnhover={() => {\n                        setHeatmapHover(null);\n                        setHeatmapHoverIndices(null);\n                      }}\n                      data={\n                        heatmapHoverIndices\n                          ? [\n                              { ...data, opacity: 0.5 },\n                              {\n                                ...data,\n                                showlegend: false,\n                                showscale: false,\n                                z: (() => {\n                                  try {\n                                    const originalZ = data.z! as number[][];\n                                    // Copy the rows and cols only of the selected range\n                                    if (\n                                      heatmapHoverIndices &&\n                                      heatmapHoverIndices.length === 2 &&\n                                      originalZ.length > 0\n                                    ) {\n                                      const emptyZ = Array(originalZ.length)\n                                        .fill(null)\n                                        .map(() => Array(originalZ[0].length).fill(null));\n\n                                      const x = heatmapHoverIndices[0],\n                                        y = heatmapHoverIndices[1];\n                                      emptyZ[x] = originalZ[x];\n                                      emptyZ.forEach((row, i) => {\n                                        row[y] = originalZ[i][y];\n                                      });\n                                      return emptyZ;\n                                    }\n                                  } catch {\n                                    return data.z;\n                                  }\n                                })(),\n                                opacity: 1,\n                              },\n                            ]\n                          : [data]\n                      }\n                      layout={{\n                        dragmode: \"lasso\",\n                        hovermode: \"closest\",\n                        autosize: true,\n                        legend: {\n                          x: 1,\n                          xanchor: \"right\",\n                          y: 1,\n                        },\n                        scene: {\n                          aspectmode: \"data\",\n                        },\n                        margin: {\n                          l: 250,\n                          r: 0,\n                          b: 0,\n                          t: 25,\n                          pad: 4,\n                        },\n                        xaxis: {\n                          // automargin: true,\n                        },\n                        yaxis: {\n                          scaleanchor: \"x\",\n                          visible: i === 0,\n                          autorange: \"reversed\",\n                          // automargin: true,\n                        },\n                        ...layout,\n                      }}\n                      config={{ ...PLOTLY_CONFIG, displayModeBar: false }}\n                    />\n                  ))}\n                </div>\n              </Modal.Body>\n              <Modal.Footer>\n                <Button variant=\"secondary\" onClick={() => setHeatmapData(null)}>\n                  Close\n                </Button>\n              </Modal.Footer>\n            </>\n          ) : null}\n        </Modal>\n        <Modal\n          show={Boolean(parallelCoordinatesCollections)}\n          onHide={() => setParallelCoordinatesCollections(null)}\n          size=\"xl\"\n          dialogClassName=\"modal-full-width\"\n        >\n          {parallelCoordinatesCollections ? (\n            <>\n              <Modal.Header closeButton>\n                <Modal.Title>\n                  View parallel coordinates of {parallelCoordinatesCollections.map((c) => c.name).join(\", \")}\n                </Modal.Title>\n              </Modal.Header>\n              <Modal.Body>\n                <ParallelCoordinatesPlot\n                  collections={parallelCoordinatesCollections}\n                  selection={selection}\n                  setSelection={setSelection}\n                />\n              </Modal.Body>\n              <Modal.Footer>\n                <Button variant=\"secondary\" onClick={() => setParallelCoordinatesCollections(null)}>\n                  Close\n                </Button>\n              </Modal.Footer>\n            </>\n          ) : null}\n        </Modal>\n        <Tabs defaultActiveKey=\"collections\" className=\"mt-3 mb-3\" unmountOnExit={true}>\n          <Tab eventKey=\"collections\" title=\"Collections\">\n            {collections.length > 0 ? (\n              <>\n                {collections.map((c) => {\n                  return (\n                    <div key={c.name} className=\"d-flex align-items-center mb-1\">\n                      <span className=\"text-truncate me-auto\" title={c.name}>\n                        {c.name} <small>{c.data.length}</small>\n                      </span>\n                      <div className=\"btn-group btn-group-sm ms-2 me-2\" role=\"group\">\n                        <button\n                          type=\"button\"\n                          className=\"btn btn-light\"\n                          title=\"Show parallel coordinates\"\n                          onClick={() => {\n                            setParallelCoordinatesCollections([c]);\n                          }}\n                        >\n                          <i className=\"fas fa-fw fa-arrows-alt-h\" />\n                        </button>\n                        {Object.entries(c.projections || {}).some(([key, value]) => value.model) ? (\n                          <button\n                            type=\"button\"\n                            className=\"btn btn-light\"\n                            title=\"Show attached projection models\"\n                            onClick={() => {\n                              setVisibleProjectionModels(c.projections);\n                            }}\n                          >\n                            <i className=\"fas fa-fw fa-server\" />\n                          </button>\n                        ) : null}\n                        {c.type === \"neighborhoodSampling\" ? (\n                          <button\n                            type=\"button\"\n                            className=\"btn btn-light\"\n                            title=\"Show neighborhood grid\"\n                            onClick={() => {\n                              setVisibleNeighborhoodSamplings(c.data);\n                            }}\n                          >\n                            <i className=\"fas fa-fw fa-th\" />\n                          </button>\n                        ) : null}\n                        <button\n                          type=\"button\"\n                          className=\"btn btn-light\"\n                          title=\"Download SMILES as CSV\"\n                          onClick={() => {\n                            downloadCSVFile(c.data.map((d) => d.structure).join(\"\\n\"), \"export\");\n                          }}\n                        >\n                          <i className=\"fas fa-fw fa-cloud-download-alt\" />\n                        </button>\n                        <button\n                          type=\"button\"\n                          className=\"btn btn-light\"\n                          title=\"Show collection in table view\"\n                          onClick={() => {\n                            setShowStructures({\n                              type: \"collection\",\n                              collection: c,\n                            });\n                          }}\n                        >\n                          <i className=\"fas fa-fw fa-table\" />\n                        </button>\n                        <button\n                          type=\"button\"\n                          className=\"btn btn-light\"\n                          title={c.hidden ? \"Enable collection\" : \"Disable collection\"}\n                          onClick={() => {\n                            setCollections(\n                              collections.map((collection) =>\n                                c === collection ? { ...c, hidden: !c.hidden } : collection\n                              )\n                            );\n                          }}\n                        >\n                          <i className={`fas fa-fw ${c.hidden ? \"fa-eye-slash\" : \"fa-eye\"}`} />\n                        </button>\n                        <button\n                          type=\"button\"\n                          className=\"btn btn-danger\"\n                          title=\"Delete collection\"\n                          onClick={() => {\n                            setCollections(collections.filter((collection) => c !== collection));\n                          }}\n                        >\n                          <i className=\"fas fa-fw fa-times\" />\n                        </button>\n                      </div>\n                    </div>\n                  );\n                })}\n              </>\n            ) : (\n              <p className=\"lead\">No collections found</p>\n            )}\n          </Tab>\n          <Tab eventKey=\"selection\" title=\"Selection\">\n            {selection ? (\n              <>\n                <p>\n                  {selectedParticles.length} Selected{\" \"}\n                  <div className=\"btn-group btn-group-sm ms-2 me-2 float-end\" role=\"group\">\n                    <button\n                      type=\"button\"\n                      className=\"btn btn-sm btn-light\"\n                      title=\"Show in table view\"\n                      onClick={() => setShowStructures({ type: \"selection\" })}\n                    >\n                      <i className=\"fas fa-fw fa-table\" />\n                    </button>\n                    <button\n                      type=\"button\"\n                      className=\"btn btn-sm btn-light\"\n                      disabled={heatmapLoading || selectedParticles.length > 50}\n                      title=\"Compute distances\"\n                      onClick={async () => {\n                        setHeatmapLoading(true);\n                        const selectedWithEmbeddings = (\n                          await embedStructures({\n                            structures: selectedParticles.map((p) => ({smiles: p.structure})),\n                            include_embedding: true,\n                          })\n                        ).data;\n\n                        if (selectedWithEmbeddings.length > 0) {\n                          const cdddSimilarities = selectedWithEmbeddings.map((a) =>\n                            selectedWithEmbeddings.map((b) =>\n                              a.embedding![\"cddd\"].reduce((acc, x, i) => {\n                                const y = b.embedding![\"cddd\"][i];\n                                return acc + Math.pow(x - y, 2);\n                              }, 0)\n                            )\n                          );\n\n                          const selectedStructures = selectedWithEmbeddings.map((p) => p.structure);\n                          const tanimotoSimilaritiesRaw = await Promise.all(\n                            selectedStructures.map((structure) =>\n                              getTanimotoSimilarity(selectedStructures, structure, \"ecfp4\").then(\n                                ({ tanimoto }) => tanimoto\n                              )\n                            )\n                          );\n\n                          const tanimotoSimilarities = selectedStructures.map((x, i) =>\n                            selectedStructures.map((y) => tanimotoSimilaritiesRaw[i][y] || 0)\n                          );\n\n                          setHeatmapData(\n                            [\n                              {\n                                data: { z: cdddSimilarities, reversescale: true, zmin: 0 },\n                                layout: { title: \"CDDD Distance\" },\n                              },\n                              {\n                                data: { z: tanimotoSimilarities, zmin: 0, zmax: 1 },\n                                layout: { title: \"Morgan Similarities\" },\n                              },\n                            ].map(({ data, layout }) => ({\n                              data: {\n                                x: selectedStructures,\n                                y: selectedStructures,\n                                hoverinfo: \"z\",\n                                colorscale: \"YlGnBu\",\n                                type: \"heatmap\",\n                                ...data,\n                              },\n                              layout,\n                            }))\n                          );\n                        }\n                        setHeatmapLoading(false);\n                      }}\n                    >\n                      <i className={`fas fa-fw ${heatmapLoading ? \"fa-circle-notch fa-spin\" : \"fa-chess-board\"}`} />\n                    </button>\n                  </div>\n                </p>\n              </>\n            ) : null}\n            {selectedParticles.length > 0 ? (\n              <FormWrapper\n                title=\"Create new collection from selection\"\n                open={true}\n                loading={newCollectionLoading}\n                setLoading={setNewCollectionLoading}\n                onSubmit={async () => {\n                  if (selection) {\n                    let data = Object.values(selection).flat();\n\n                    if (includeNeighbors && data.length === 1) {\n                      const neighbors = Object.entries(includeNeighbors)\n                        .filter(([key, value]) => value)\n                        .map(([key, value]) => data[0].nearest_neighbors?.[key]?.knn_particles?.slice(0, value)!)\n                        .flat()\n                        .filter(Boolean);\n                      data.push(...neighbors);\n                      data = Array.from(new Set(data));\n                    }\n\n                    const newCollection = recomputeEmbeddings\n                      ? {\n                          name,\n                          ...(await embedStructures({\n                            structures: data.map((d) => ({smiles: d.structure})),\n                            include_embedding: true,\n                          })),\n                        }\n                      : {\n                          name,\n                          data: data.map((d) => ({\n                            ...cloneDeepWith(d, (value, key, object, stack) =>\n                              key === \"knn_particles\" ? undefined : value\n                            ),\n                            nearest_neighbors: undefined,\n                          })),\n                          // Add the projection model if only a single collection was selected\n                          projections: selectionCollection?.projections,\n                        };\n                    const oldCollections = removeFromOriginal\n                      ? collections.map((c) =>\n                          selection[c.name]\n                            ? {\n                                ...c,\n                                data: c.data.filter((d) => !selection[c.name].includes(d)),\n                              }\n                            : c\n                        )\n                      : collections;\n                    setCollections([...oldCollections, newCollection]);\n                    setSelection(null);\n                    setName(\"\");\n                  }\n                }}\n              >\n                <div className=\"d-flex justify-content-center\">\n                  {selectedParticles.length === 1 ? (\n                    <StructureCard structure={selectedParticles[0]} showProperties={false} />\n                  ) : (\n                    <StructureImage\n                      style={{ maxWidth: \"100%\" }}\n                      structure={selectedParticles.map((s) => s.structure)}\n                    />\n                  )}\n                </div>\n                {nameInput}\n                <div className=\"form-check form-switch me-sm-2\">\n                  <input\n                    type=\"checkbox\"\n                    className=\"form-check-input\"\n                    id=\"collectionsRecomputeEmbeddingsInput\"\n                    checked={recomputeEmbeddings}\n                    onChange={(e) => setRecomputeEmbeddings(e.currentTarget.checked)}\n                  />\n                  <label className=\"form-check-label\" htmlFor=\"collectionsRecomputeEmbeddingsInput\">\n                    Recompute embeddings, projections, ...\n                  </label>\n                </div>\n                <div className=\"form-check form-switch me-sm-2\">\n                  <input\n                    type=\"checkbox\"\n                    className=\"form-check-input\"\n                    id=\"collectionsRemoveOldInput\"\n                    checked={removeFromOriginal}\n                    onChange={(e) => setRemoveFromOriginal(e.currentTarget.checked)}\n                  />\n                  <label className=\"form-check-label\" htmlFor=\"collectionsRemoveOldInput\">\n                    Remove from original collection\n                  </label>\n                </div>\n                {selectedParticles.length === 1 && selectedParticles[0].nearest_neighbors ? (\n                  <div>\n                    <div className=\"form-check form-switch me-sm-2\">\n                      <input\n                        type=\"checkbox\"\n                        className=\"form-check-input\"\n                        id=\"collectionsEnableKNN\"\n                        checked={Boolean(includeNeighbors)}\n                        onChange={(e) => setIncludeNeighbors(e.currentTarget.checked ? {} : null)}\n                      />\n                      <label className=\"form-check-label\" htmlFor=\"collectionsEnableKNN\">\n                        Enable KNN\n                      </label>\n                    </div>\n                    {includeNeighbors &&\n                      Object.entries(selectedParticles[0].nearest_neighbors || {}).map(([key, value]) => (\n                        <div className=\"mb-3\">\n                          <label htmlFor=\"neighborhoodSamplesInput\" className=\"form-label\">\n                            {key} {includeNeighbors?.[key]}\n                          </label>\n                          <input\n                            type=\"range\"\n                            className=\"form-range\"\n                            id=\"neighborhoodSamplesInput\"\n                            value={includeNeighbors?.[key] || 0}\n                            onChange={(e) =>\n                              setIncludeNeighbors({ ...(includeNeighbors || {}), [key]: e.currentTarget.valueAsNumber })\n                            }\n                            min={0}\n                            max={value.knn_ind.length}\n                            step={1}\n                          />\n                        </div>\n                      ))}\n                  </div>\n                ) : null}\n                <div className=\"text-end\">\n                  <ButtonWithUpload loading={newCollectionLoading} disabled={!selection || !name} text=\"Create\" />\n                </div>\n              </FormWrapper>\n            ) : (\n              <p className=\"lead\">Select to create a new collection</p>\n            )}\n          </Tab>\n          <Tab eventKey=\"knn\" title=\"KNN\">\n            {true || hoverOrSelected ? (\n              <>\n                <LocalNeighborhoodPlot selected={lastHoverOrSelected} collection={collections.find((c) => c.name === hoverOrSelected?.collection)} setHover={setHover} hover={hover} />\n                {/*<select\n                  value={knnEmbeddingKey}\n                  onChange={(e) => setKnnEmbeddingKey(e.currentTarget.value)}\n                  className=\"custom-select custom-select-sm mb-1\"\n                >\n                  <option value=\"\">Choose embedding...</option>\n                  {Object.entries(hoverOrSelected.nearest_neighbors || {}).map(([key, value]) => (\n                    <option value={key}>{key}</option>\n                  ))}\n                </select>\n                {knnEmbeddingKey ? (<>\n                  <div\n                    style={{\n                      display: \"grid\",\n                      gridTemplateColumns: \"1fr 1fr 1fr 1fr\",\n                      gridColumnGap: 3,\n                      gridRowGap: 3,\n                    }}\n                  >\n                    {hoverOrSelected.nearest_neighbors?.[knnEmbeddingKey]?.knn_particles.map((p) => (\n                      <div className=\"d-flex overflow-auto\">\n                        <StructureImage style={{ width: \"100%\" }} structure={p.structure} />\n                      </div>\n                    ))}\n                  </div>\n                </>) : null} */}\n              </>\n            ) : null}\n          </Tab>\n          <Tab eventKey=\"sankey\" title=\"Group Flow\">\n            <GroupFlowSankeyPlot selection={selection} collections={collections} />\n          </Tab>\n          <Tab eventKey=\"details\" title=\"Details\">\n            {hoverOrSelected ? (\n              <StructureCard structure={hoverOrSelected} />\n            ) : (\n              <p className=\"lead\">Hover over a structure to see details</p>\n            )}\n          </Tab>\n        </Tabs>\n      </>\n    );\n  }\n);\n","import * as React from \"react\";\nimport { Figure } from \"react-plotly.js\";\nimport { ICollection, IParticle, IParticleSelection, IPlotOptions } from \"../interfaces\";\nimport { PlotComponent, PLOTLY_CONFIG } from \"./PlotComponent\";\nimport lodashGet from \"lodash.get\";\nimport { extent } from \"d3-array\";\nimport { normalizeArray, toExtent, toNumber } from \"../utils\";\nimport groupBy from \"lodash.groupby\";\nimport { scaleLinear, scaleSymlog } from \"d3-scale\";\nimport { color } from \"d3-color\";\nimport { useSyncedRef } from \"../utils/hooks\";\nimport { DEFAULT_COLORWAY, DEFAULT_PLOTLY_COLORSCALE } from \"../utils/constants\";\n\nconst TRAJECTORY_TRACE_NAME = \"Trajectories\";\n\nexport interface IProjectionPlotProps {\n  title: string;\n  collections: ICollection[];\n  xAccessor: string | (string | number)[];\n  yAccessor: string;\n  options: Partial<IPlotOptions>;\n  hover: IParticle | null;\n  setHover(particle: IParticle | null): void;\n  selected: IParticleSelection;\n  setSelected(selected: IParticleSelection): void;\n  children?: React.ReactNode;\n}\n\nexport const ScatterPlot = React.memo(\n  ({\n    title,\n    collections,\n    xAccessor,\n    yAccessor,\n    options,\n    hover: debouncedHover,\n    setHover,\n    selected,\n    setSelected,\n    children,\n  }: IProjectionPlotProps) => {\n    const [figureState, setFigureState] = React.useState<Figure | null>(null);\n    const [innerHover, setInnerHover] = React.useState<IParticle | null>(null);\n\n    // Use the most up-to-date hover if possible.\n    const hover = innerHover || debouncedHover;\n    const setHoverRef = useSyncedRef(setHover);\n\n    React.useEffect(() => {\n      const traces: Partial<Plotly.PlotData>[] = ((() => {\n        // return null;\n        const connectBy = options.connectBy;\n        if (!connectBy || connectBy.length === 0 || (hover == null && !selected)) {\n          return null;\n        }\n\n        const filteredCollections: Map<ICollection | undefined, IParticle[]> = new Map();\n        if (selected) {\n          Object.entries(selected).forEach(([name, selection]) => {\n            const collection = collections.find((c) => c.name === name);\n            filteredCollections.set(collection, selection);\n          });\n        }\n\n        filteredCollections.delete(undefined);\n        if (!hover && filteredCollections.size === 0) {\n          return null;\n        }\n\n        return [\n          (hover ? [collections.find((c) => c.name === hover.collection), [hover]] : [undefined, undefined]) as [\n            ICollection | undefined,\n            IParticle[] | undefined\n          ],\n          ...Array.from(filteredCollections.entries()),\n        ].map(([c, selection], i) => {\n          if (!c || !selection) {\n            return null;\n          }\n          const particles = c!.data;\n          const isHover = i === 0;\n\n          const knnHoverFields = connectBy.filter((v) => v.startsWith(\"knn=\")).map((v) => v.split(\"=\"));\n          const isKNNHover = knnHoverFields.length > 0;\n\n          let filteredParticles: IParticle[] | null = null;\n          if (isKNNHover) {\n            filteredParticles = particles;\n          } else {\n            const selectedInstancesByConnectBy = connectBy.map(\n              (c) => new Set(selection.map((p) => p?.properties?.[c]?.toString()).filter((id) => id != null))\n            );\n\n            filteredParticles = particles.filter((p) =>\n              connectBy.every((connectBy, i) =>\n                selectedInstancesByConnectBy[i].has(p.properties?.[connectBy]?.toString())\n              )\n            );\n          }\n\n          if (filteredParticles.length === 0) {\n            return null;\n          }\n\n          const allInstances: (IParticle | null)[] = [];\n          const allSizes: (number | null)[] = [];\n          const allColors: (string | null)[] = [];\n\n          const lineOpacityScaling = scaleSymlog().range([0.1, 0.8]).domain([particles.length, 0]);\n          const hoverColor = color(/* hover?.plotData?.color || */ \"rgb(0,0,0)\")?.darker()!;\n\n          const lineColor = hoverColor.copy();\n          lineColor.opacity = lineOpacityScaling(filteredParticles.length);\n          // const markerBorderColor = \"gray\";\n          hoverColor.opacity = 0.5;\n          const sizeScaling = scaleLinear().range([6, 12]);\n\n          // TOOD: This could be memoized.\n          let groups: [string, IParticle[]][] | null = null;\n          if (isKNNHover) {\n            groups = knnHoverFields.map((key) => [\n              key[1],\n              [\n                hover!,\n                ...(hover?.nearest_neighbors?.[key[1]]?.knn_particles.slice(0, +key[2]).reverse().filter(Boolean) ||\n                  []),\n              ],\n            ]);\n          } else {\n            groups = Object.entries(\n              groupBy(filteredParticles, (p) =>\n                connectBy.map((connectBy) => `${connectBy}:${p.properties?.[connectBy]}`).join(\", \")\n              )\n            );\n          }\n\n          // Cool plotly optimization: instead of creating many traces for lines, create a single trace with NaN separators.\n          // See https://www.somesolvedproblems.com/2019/05/how-to-make-plotly-faster-with-many.html\n          for (let [key, instances] of groups) {\n            instances = instances.filter((p) => lodashGet(p, xAccessor) != null && lodashGet(p, yAccessor) != null);\n            const instanceScaler = sizeScaling.domain([0, instances.length]);\n            allInstances.push(...instances);\n            allInstances.push(null);\n            allSizes.push(...instances.map((_, i) => instanceScaler(i)));\n            allSizes.push(null);\n            allColors.push(...instances.map((p, i) => (p === hover || p.selected ? \"gold\" : \"lightgray\")));\n            allColors.push(\"darkblue\");\n          }\n          const allBorderColors = allColors.map((c) => color(c!)!.darker().toString());\n          // @ts-ignore\n          return {\n            type: isHover ? \"scatter\" : \"scattergl\",\n            mode: \"lines+markers\",\n            x: allInstances.map((p) => lodashGet(p, xAccessor) ?? NaN),\n            y: allInstances.map((p) => lodashGet(p, yAccessor) ?? NaN),\n            name: TRAJECTORY_TRACE_NAME,\n            hoverinfo: \"skip\",\n            // opacity: hover ? (isHover ? 1.0 : 0.05) : 0.2,\n            marker: {\n              color: allColors,\n              size: allSizes,\n              line: {\n                color: allBorderColors,\n                width: 2,\n              },\n              opacity: 1,\n            },\n            colorscale: [\n              [0, \"##a2d4d5\"],\n              [1, \"#127273\"],\n            ],\n            line: {\n              color: lineColor.toString(),\n              width: isKNNHover ? 0 : 2,\n              shape: \"spline\",\n              // opacity: 0.5\n              // @ts-ignore\n            },\n            showlegend: false,\n          } as Partial<Plotly.PlotData>;\n        });\n      })()?.filter(Boolean) || []) as Partial<Plotly.PlotData>[];\n\n      setFigureState((figureState) => {\n        if (!figureState) {\n          return figureState;\n        }\n        const existing = figureState.data.find((d) => d.name === TRAJECTORY_TRACE_NAME);\n        if (traces.length === 0 && !existing) {\n          return figureState;\n        }\n        const data = [\n          ...figureState.data\n            .filter((d) => d.name !== TRAJECTORY_TRACE_NAME)\n            .map((d) => ({ ...d, opacity: traces.length > 0 ? 0.4 : undefined })),\n          ...traces,\n        ];\n        return { ...figureState, data };\n      });\n      // const result: Plotly.Data[] = [];\n      // groups.forEach(([group, instances]) => {\n      //   // const c = color(\n      //   //   instances.find((i) => i.plotData?.color)?.plotData?.color || \"#000000\"\n      //   // )!;\n      //   const c = color(hover?.plotData?.color || \"#000000\")!;\n      //   const sizeScaling = scaleLinear()\n      //     .domain([0, instances.length])\n      //     .range([8, 16]);\n      //   c.opacity = hover && instances.includes(hover) ? 0.5 : 0.3;\n      //   if (true || instances.length > 20 || groups.length > 20) {\n      //     result.push({\n      //       type: \"scattergl\",\n      //       mode: \"lines+markers\",\n      //       x: instances.map((p) => get(p, \"x\")),\n      //       y: instances.map((p) => get(p, \"y\")),\n      //       name: group,\n      //       hoverinfo: \"all\",\n      //       marker: {\n      //         color: \"lightblue\",\n      //         // @ts-ignore\n      //         size: instances.map((p, i) => sizeScaling(i)),\n      //         line: {\n      //           color: c.toString(),\n      //           width: 2,\n      //         },\n      //         opacity: 1,\n      //         // line: 'green'\n      //       },\n      //       line: {\n      //         color: c.toString(),\n      //         // shape: \"spline\",\n      //       },\n      //       showlegend: false,\n      //     });\n      //   } else {\n      //     // const widthScaling = scaleLinear()\n      //     //   .domain([0, instances.length])\n      //     //   .range([1, 6]);\n      //     // instances.slice(1).forEach((instance, i) => {\n      //     //   const instancePair = [instances[i], instance];\n      //     //   result.push({\n      //     //     type: \"scattergl\",\n      //     //     mode: \"lines+markers\",\n      //     //     x: instancePair.map((p) => get(p, \"x\")),\n      //     //     y: instancePair.map((p) => get(p, \"y\")),\n      //     //     name: group,\n      //     //     hoverinfo: \"all\",\n      //     //     marker: {\n      //     //       color: 'red',\n      //     //       size: 10\n      //     //     },\n      //     //     line: {\n      //     //       width: widthScaling(i),\n      //     //       color: c.toString(),\n      //     //       shape: \"spline\",\n      //     //       // dash: 'dot',\n      //     //     },\n      //     //     // legendgroup: `${group}`,\n      //     //     // showlegend: i === 0,\n      //     //     showlegend: false,\n      //     //   });\n      //     // });\n      //   }\n      // });\n\n      // return result;\n    }, [collections, xAccessor, yAccessor, options.connectBy, hover, selected]);\n\n    React.useEffect(() => {\n      const timeout = setTimeout(() => {\n        setFigureState((figureState) => {\n          const annotatedCollections = collections.map(({ data, hidden, name, plotOptions }) => {\n            const colorBy = plotOptions?.colorBy || options.colorBy;\n            const opacityBy = plotOptions?.opacityBy || options.opacityBy;\n            const sizeBy = plotOptions?.sizeBy || options.sizeBy;\n\n            const color = colorBy ? data.map((p) => toNumber(p.properties?.[colorBy])) : undefined;\n            const constantOpacity = typeof opacityBy === \"number\" ? opacityBy : undefined;\n            const opacity = opacityBy\n              ? data.map((p) => constantOpacity || toNumber(p.properties?.[opacityBy]))\n              : undefined;\n            // opacity: opacityBy\n            // ? normalizeArray(\n            //     points.map((p) => p.properties?.[opacityBy] as number),\n            //     0.3,\n            //     0.7\n            //   )\n            // : defaultOpacity,\n            const size = sizeBy ? data.map((p) => toNumber(p.properties?.[sizeBy], 5)) : undefined;\n            // @ts-ignore\n            const colorExtent: [number, number] = color ? extent(color) : undefined;\n            // @ts-ignore\n            const opacityExtent: [number, number] = opacity ? extent(opacity) : undefined;\n            // @ts-ignore\n            const sizeExtent: [number, number] = size ? extent(size) : undefined;\n\n            return {\n              data,\n              hidden,\n              name,\n              plotOptions,\n              colorExtent,\n              color,\n              opacity,\n              opacityExtent,\n              size,\n              sizeExtent,\n            };\n          });\n\n          const colorExtent = toExtent(annotatedCollections, (d) => d.colorExtent);\n          const opacityExtent = toExtent(annotatedCollections, (d) => d.opacityExtent);\n          const sizeref = options.sizeBy\n            ? (2.0 * Math.max(...annotatedCollections.map(({ sizeExtent }) => sizeExtent?.[1] || 0))) / 5 ** 2\n            : undefined;\n\n          const newFigureState: Figure = {\n            frames: [],\n            layout: {\n              ...(figureState?.layout || {}),\n              colorway: DEFAULT_COLORWAY,\n              dragmode: \"lasso\",\n              hovermode: \"closest\",\n              autosize: true,\n              legend: {\n                x: 1,\n                xanchor: \"right\",\n                y: 1.5,\n                bgcolor: \"rgba(255, 255, 255, 0.5)\",\n              },\n              title,\n              margin: {\n                // l: 0,\n                r: 0,\n                // b: 0,\n                // t: 25,\n                pad: 4,\n              },\n            },\n            // @ts-ignore\n            data: annotatedCollections.map(({ data, name, hidden, color, opacity, size, plotOptions }, i) => {\n              const existingData = (figureState?.data.find((d) => d.name === name) as Partial<Plotly.PlotData>) || {};\n\n              const groupBy = plotOptions?.groupBy || options.groupBy;\n              const colorBy = plotOptions?.colorBy || options.colorBy;\n              let groups = groupBy ? data.map((p) => p.properties?.[groupBy]?.toString() || \"N/A\") : undefined;\n\n              let x = data.map((p) => lodashGet(p, xAccessor));\n              let y = data.map((p) => lodashGet(p, yAccessor));\n              let indices = data.map((data, i) => [i, data.index!]);\n\n              if (y?.[0] && Array.isArray(y[0])) {\n                const extendedParticles = y.map((ys, i) => ({\n                  x: Array.from(new Array(ys.length).keys()),\n                  y: ys,\n                  indices: new Array(ys.length).fill(null).map(() => [i, data[i].index!]),\n                  color: Array.isArray(color) ? new Array(ys.length).fill(color[i]) : color,\n                  opacity: Array.isArray(opacity) ? new Array(ys.length).fill(opacity[i]) : opacity,\n                  size: Array.isArray(size) ? new Array(ys.length).fill(size[i]) : size,\n                  groups: Array.isArray(groups) ? new Array(ys.length).fill(groups[i]) : groups,\n                }));\n\n                x = extendedParticles.map((p) => p.x).flat();\n                y = extendedParticles.map((p) => p.y).flat();\n                indices = extendedParticles.map((p) => p.indices).flat();\n                color = Array.isArray(color) ? extendedParticles.map((p) => p.color).flat() : color;\n                opacity = Array.isArray(opacity) ? extendedParticles.map((p) => p.opacity).flat() : opacity;\n                size = Array.isArray(size) ? extendedParticles.map((p) => p.size).flat() : size;\n                groups = Array.isArray(groups) ? extendedParticles.map((p) => p.groups).flat() : groups;\n              }\n              console.log(color)\n              return {\n                ...existingData,\n                x,\n                y,\n                text: data.map((p) => p.structure),\n                hoverinfo: \"none\",\n                name,\n                type: \"scattergl\",\n                mode: \"markers\",\n                // Custom data has the [index of particle in filtered collection, index of particle in global collection] mapping\n                customdata: indices,\n                visible: !hidden ? true : \"legendonly\",\n                showlegend: false,\n                marker: {\n                  ...(existingData.marker || {}),\n                  color,\n                  cmin: colorExtent?.[0],\n                  cmax: colorExtent?.[1],\n                  opacity: opacity\n                    ? normalizeArray(opacity, [0.1, 0.9] /* , opacityExtent */)\n                    : data.length >= 5000\n                    ? 0.5\n                    : 0.5,\n                  // opacity: opacity || 0.5,\n                  symbol: i,\n                  size: size ?? (data.length >= 5000 ? 3.5 : 5),\n                  sizeref,\n                  sizemin: 2,\n                  sizemax: 5,\n                  colorbar: colorBy\n                    ? {\n                        title: colorBy.length > 10 ? colorBy.slice(0, 7) + \"...\" : colorBy,\n                        titleside: \"top\",\n                        thickness: 10,\n                        outlinewidth: 0,\n                        lenmode: \"fraction\",\n                        len: 0.75,\n                        yanchor: \"middle\",\n                      }\n                    : undefined,\n                    ...DEFAULT_PLOTLY_COLORSCALE,\n                    // colorscale: \"Portland\",\n                    // reversescale: true\n                },\n                transforms: (groupBy\n                  ? [\n                      {\n                        type: \"groupby\",\n                        groups,\n                        styles: Array.from(new Set(groups))\n                          .sort((a, b) => a.localeCompare(b))\n                          .map((target, i) => ({\n                            target,\n                            value: { marker: { symbol: i } },\n                          })),\n                      },\n                    ]\n                  : []) as Plotly.Transform[],\n              };\n            }),\n          };\n          return newFigureState;\n        });\n      }, 300);\n\n      return () => {\n        clearTimeout(timeout);\n      };\n    }, [title, collections, xAccessor, yAccessor, JSON.stringify(options)]);\n\n    React.useEffect(() => {\n      setFigureState((figureState) =>\n        figureState\n          ? {\n              ...figureState,\n              data: figureState.data.map((data) => {\n                const selectedIndices = new Set(selected?.[data.name!]?.map((s) => s.index!) || []);\n                let selectedpoints: undefined | number[] = undefined;\n                if (selectedIndices.size > 0) {\n                  selectedpoints = [];\n                  ((data as Partial<Plotly.PlotData>).customdata as [number, number][]).forEach(\n                    ([_, particleIndex], pointIndex) => {\n                      if (selectedIndices.has(particleIndex)) {\n                        selectedpoints!.push(pointIndex);\n                      }\n                    }\n                  );\n                }\n                return {\n                  ...data,\n                  selectedpoints,\n                };\n              }),\n            }\n          : null\n      );\n    }, [selected]);\n\n    React.useEffect(() => {\n      const timeout = setTimeout(() => setHoverRef.current?.(innerHover), 50);\n\n      return () => {\n        clearTimeout(timeout);\n      };\n    }, [innerHover, setHoverRef]);\n\n    const getPointsFromEvent = (e: Readonly<Plotly.PlotSelectionEvent> | null): IParticleSelection => {\n      const points = e?.points || [];\n      const handledIndices = new Set<number>();\n      return points.length > 0\n        ? points.reduce<{ [key: string]: IParticle[] }>((acc, p) => {\n            // @ts-ignore\n            const collection = collections?.[p.curveNumber];\n            const [pointIndex, particleIndex] = p.customdata as any as [number, number];\n            const particle: IParticle | null = collection?.data?.[pointIndex];\n            if (particle && !handledIndices.has(pointIndex)) {\n              handledIndices.add(pointIndex);\n              if (!acc[collection.name]) {\n                acc[collection.name] = [];\n              }\n              acc[collection.name].push(particle);\n            }\n            return acc;\n          }, {})\n        : null;\n    };\n\n    return (\n      <>\n        {figureState ? (\n          <PlotComponent\n            style={{\n              width: \"100%\",\n              height: \"100%\",\n            }}\n            data={figureState.data}\n            layout={figureState.layout}\n            config={PLOTLY_CONFIG}\n            onSelected={(e) => {\n              setSelected(getPointsFromEvent(e));\n            }}\n            onDeselect={() => {\n              setSelected(null);\n            }}\n            onClick={(e) => {\n              setSelected(getPointsFromEvent(e));\n              setInnerHover(null);\n            }}\n            onHover={(e) => {\n              setInnerHover(Object.values(getPointsFromEvent(e)!).flat()?.[0]);\n            }}\n            onUnhover={() => {\n              setInnerHover(null);\n            }}\n            onUpdate={(figure) => {\n              // Inline save the figure to save the zoom\n              figureState.data = figure.data;\n              figureState.frames = figure.frames;\n              figureState.layout = figure.layout;\n            }}\n          />\n        ) : null}\n        {children}\n      </>\n    );\n  }\n);\n","import * as React from \"react\";\nimport { ICollection, IParticleSelection } from \"../../interfaces\";\nimport { ButtonWithUpload } from \"../ButtonWithUpload\";\nimport { getMatchedMolecularPairs, embedStructures } from \"../../utils/api\";\nimport { FormWrapper } from \"./FormWrapper\";\nimport { UseStructureInputAddon } from \"../UseStructureInputAddon\";\nimport { useNameInput } from \"../../utils/hooks\";\n\nexport const MatchedMolecularPairsForm = ({\n  addCollection,\n  selection,\n  loading,\n  setLoading,\n}: {\n  addCollection(collection: ICollection): void;\n  selection?: IParticleSelection;\n  loading: boolean;\n  setLoading(loading: boolean): void;\n}) => {\n  const [structure, setStructure] = React.useState<string>(\"\");\n  const [name, setName, nameInput] = useNameInput(\"mmpNameInput\", `MMP ${structure}`);\n  const [substructure, setSubstructure] = React.useState<string>(\"\");\n  const [minVariableSize, setMinVariableSize] = React.useState<number>(0);\n  const [maxVariableSize, setMaxVariableSize] = React.useState<number>(1);\n  const [minConstantSize, setMinConstantSize] = React.useState<number>(0);\n  const [minRadius, setMinRadius] = React.useState<number>(0);\n  const [minPairs, setMinPairs] = React.useState<number>(0);\n\n  return (\n    <FormWrapper\n      title={\n        <>\n          Matched Molecular Pairs &nbsp;\n          <a\n            style={{ fontSize: \"smaller\" }}\n            href=\"https://github.com/rdkit/mmpdb#4-identify-possible-transforms\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n          >\n            <i className=\"fas fa-fw fa-info-circle\" />\n          </a>\n        </>\n      }\n      loading={loading}\n      setLoading={setLoading}\n      onSubmit={async () => {\n        const {structures} = await getMatchedMolecularPairs({\n          structure,\n          substructure: substructure,\n          min_variable_size: minVariableSize,\n          max_variable_size: maxVariableSize,\n          min_constant_size: minConstantSize,\n          min_radius: minRadius,\n          min_pairs: minPairs,\n        });\n        if(structures.length === 0) {\n          throw Error('No matching pairs found');\n        }\n        const embeddedCollection = await embedStructures({structures: structures.map((smiles) => ({smiles})), include_embedding: true});\n        addCollection({\n          name,\n          ...embeddedCollection\n        });\n        setName('');\n      }}\n    >\n      {nameInput}\n      <div className=\"mb-3\">\n        <label htmlFor=\"mmpStructureInput\">Structure</label>\n        <div className=\"input-group input-group-sm\">\n          <UseStructureInputAddon value={structure} selection={selection} setValue={setStructure} />\n          <input\n            type=\"text\"\n            className=\"form-control form-control-sm\"\n            id=\"mmpStructureInput\"\n            aria-describedby=\"mmpStructureInput\"\n            value={structure}\n            onChange={(e) => setStructure(e.currentTarget.value)}\n          />\n        </div>\n      </div>\n      <details>\n        <summary>Advanced Settings</summary>\n        <div className=\"mb-3\">\n          <label htmlFor=\"minVariableSizeInput\">Min Variable Size</label>\n          <input\n            type=\"number\"\n            className=\"form-control form-control-sm\"\n            id=\"minVariableSizeInput\"\n            value={minVariableSize}\n            required\n            min={0}\n            onChange={(e) => setMinVariableSize(e.currentTarget.valueAsNumber)}\n          />\n        </div>\n        <div className=\"mb-3\">\n          <label htmlFor=\"maxVariableSizeInput\">Max Variable Size</label>\n          <input\n            type=\"number\"\n            className=\"form-control form-control-sm\"\n            id=\"maxVariableSizeInput\"\n            value={maxVariableSize}\n            required\n            min={0}\n            onChange={(e) => setMaxVariableSize(e.currentTarget.valueAsNumber)}\n          />\n        </div>\n        <div className=\"mb-3\">\n          <label htmlFor=\"minConstantSizeInput\">Min Constant Size</label>\n          <input\n            type=\"number\"\n            className=\"form-control form-control-sm\"\n            id=\"minConstantSizeInput\"\n            value={minConstantSize}\n            required\n            min={0}\n            onChange={(e) => setMinConstantSize(e.currentTarget.valueAsNumber)}\n          />\n        </div>\n        <div className=\"mb-3\">\n          <label htmlFor=\"minRadiusInput\">Min Radius</label>\n          <input\n            type=\"number\"\n            className=\"form-control form-control-sm\"\n            id=\"minRadiusInput\"\n            value={minRadius}\n            min={0}\n            required\n            onChange={(e) => setMinRadius(e.currentTarget.valueAsNumber)}\n          />\n        </div>\n        <div className=\"mb-3\">\n          <label htmlFor=\"minPairsInput\">Min Pairs</label>\n          <input\n            type=\"number\"\n            className=\"form-control form-control-sm\"\n            id=\"minPairsInput\"\n            value={minPairs}\n            min={0}\n            required\n            onChange={(e) => setMinPairs(e.currentTarget.valueAsNumber)}\n          />\n        </div>\n        <div className=\"mb-3\">\n          <label htmlFor=\"mmpSmartsStructureInput\">SMARTS Substructure</label>\n          <div className=\"input-group input-group-sm\">\n            <UseStructureInputAddon value={substructure} selection={selection} setValue={setSubstructure} />\n            <input\n              type=\"text\"\n              className=\"form-control form-control-sm\"\n              id=\"mmpSmartsStructureInput\"\n              aria-describedby=\"mmpSmartsStructureInput\"\n              value={substructure}\n              onChange={(e) => setSubstructure(e.currentTarget.value)}\n            />\n          </div>\n        </div>\n      </details>\n      <div className=\"text-end\">\n        <ButtonWithUpload loading={loading} disabled={!structure} text=\"Compute MMP\" />\n      </div>\n    </FormWrapper>\n  );\n};\n","import * as React from \"react\";\nimport { ICollection, IParticle, IParticleSelection } from \"../../interfaces\";\nimport { ButtonWithUpload } from \"../ButtonWithUpload\";\nimport { getNeighborSamples, getTanimotoSimilarity } from \"../../utils/api\";\nimport { FormWrapper } from \"./FormWrapper\";\nimport { UseStructureInputAddon } from \"../UseStructureInputAddon\";\nimport { Modal } from \"react-bootstrap\";\nimport { StructureImage } from \"../StructureImage\";\nimport { useNameInput } from \"../../utils/hooks\";\n\nexport const NeighborSamplingForm = ({\n  visible,\n  setVisible,\n  collections,\n  setCollections,\n  selection,\n  loading,\n  setLoading,\n}: {\n  visible: IParticle[] | null;\n  setVisible(collection: IParticle[] | null): void;\n  collections: ICollection[];\n  setCollections(collections: ICollection[]): void;\n  selection?: IParticleSelection;\n  loading: boolean;\n  setLoading(loading: boolean): void;\n}) => {\n  const [smiles, setSmiles] = React.useState<string>(\"\");\n  const [method, setMethod] = React.useState<string>(\"chembl_pca\");\n  const [nr, setNr] = React.useState<number>(5);\n  const [scale, setScale] = React.useState<number>(1);\n  const [name, setName, nameInput] = useNameInput(\"neighborhoodNameInput\", `${method} ${nr}*${scale} Neighborhood of ${smiles}`);\n\n  const computeNeighborSamples = async () => {\n    const serverCollection = await getNeighborSamples(smiles, nr, method, scale);\n    const similarity = await getTanimotoSimilarity(\n      serverCollection.data.map((p) => p.structure),\n      smiles,\n      \"ecfp4\"\n    );\n\n    const data = serverCollection.data.map((p) => ({\n      ...p,\n      properties: { ...(p.properties || {}), neighborhoodSimilarity: similarity.tanimoto[p.structure] },\n    }));\n    setCollections([\n      ...collections,\n      {\n        ...serverCollection,\n        name,\n        data,\n        type: \"neighborhoodSampling\",\n      },\n    ]);\n    setName(\"\");\n    setVisible(data);\n  };\n\n  return (\n    <>\n      <Modal show={Boolean(visible)} onHide={() => setVisible(null)} size=\"xl\">\n        <Modal.Header closeButton>\n          <Modal.Title>Neighborhood Sampling</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          {visible ? (\n            <>\n              <div\n                style={{\n                  display: \"grid\",\n                  gridTemplateColumns: `repeat(${Math.sqrt(visible.length)}, 1fr)`,\n                }}\n              >\n                {visible.map((sample, i) => (\n                  <StructureImage\n                    key={i}\n                    structure={sample.structure}\n                    align={visible[Math.floor(visible.length / 2)].structure}\n                    title={`Similarity to reference: ${sample.properties?.[\"neighborhoodSimilarity\"]}`}\n                    style={{\n                      width: \"100%\",\n                      opacity: sample.properties?.[\"neighborhoodSimilarity\"] as number,\n                      border: `1px solid ${Math.floor(visible.length / 2) === i ? \"gold\" : \"rgba(0, 0, 0, 0.05)\"}`,\n                    }}\n                  />\n                ))}\n              </div>\n            </>\n          ) : null}\n        </Modal.Body>\n      </Modal>\n      <FormWrapper\n        title=\"Neighborhood Sampling\"\n        loading={loading}\n        setLoading={setLoading}\n        onSubmit={computeNeighborSamples}\n      >\n        {nameInput}\n        <div className=\"mb-3\">\n          <label htmlFor=\"neighborhoodStructureInput\">Reference structure</label>\n          <div className=\"input-group input-group-sm\">\n            <UseStructureInputAddon value={smiles} selection={selection} setValue={setSmiles} />\n            <input\n              type=\"text\"\n              className=\"form-control form-control-sm\"\n              id=\"neighborhoodStructureInput\"\n              aria-describedby=\"neighborhoodStructureInput\"\n              value={smiles}\n              onChange={(e) => setSmiles(e.currentTarget.value)}\n            />\n          </div>\n        </div>\n        <div className=\"mb-3\">\n          <label htmlFor=\"neighborhoodSamplesInput\" className=\"form-label\">Nr. of Samples: {nr}</label>\n          <input\n            type=\"range\"\n            className=\"form-range\"\n            id=\"neighborhoodSamplesInput\"\n            value={nr}\n            onChange={(e) => setNr(e.currentTarget.valueAsNumber)}\n            min={3}\n            max={15}\n            step={2}\n          />\n        </div>\n        <div className=\"mb-3\">\n          <label htmlFor=\"neighborhoodScaleInput\" className=\"form-label\">Scale: {scale}</label>\n          <input\n            type=\"range\"\n            className=\"form-range\"\n            id=\"neighborhoodScaleInput\"\n            value={scale}\n            onChange={(e) => setScale(e.currentTarget.valueAsNumber)}\n            min={0.1}\n            max={5}\n            step={0.1}\n          />\n        </div>\n        <div className=\"mb-3\">\n          <label htmlFor=\"neighborhoodSamplesMethod\">Method</label>\n          <div className=\"input-group input-group-sm\">\n            <select\n              className=\"form-control\"\n              id=\"neighborhoodSamplesMethod\"\n              value={method}\n              onChange={(e) => {\n                setMethod(e.currentTarget.value);\n              }}\n            >\n              <option value=\"chembl_pca\">PCA of ChEMBL</option>\n              <option value=\"random_orthogonal\">Random Orthogonal</option>\n            </select>\n          </div>\n        </div>\n        <div className=\"text-end\">\n          <ButtonWithUpload loading={loading} disabled={!smiles} text=\"Compute Neighbors\" />\n        </div>\n      </FormWrapper>\n    </>\n  );\n};\n","import * as React from \"react\";\nimport { ICollection, IParticleSelection } from \"../../interfaces\";\nimport { computeProjectionsWithModels } from \"../../utils/api\";\nimport { ButtonWithUpload } from \"../ButtonWithUpload\";\nimport { FormWrapper } from \"./FormWrapper\";\n\nexport const RecomputeEmbeddingsForm = ({\n  collections,\n  setCollections,\n  selection,\n  loading,\n  setLoading,\n}: {\n  collections: ICollection[];\n  setCollections(collections: ICollection[]): void;\n  selection: IParticleSelection;\n  loading: boolean;\n  setLoading(loading: boolean): void;\n}) => {\n  const [from, setFrom] = React.useState<ICollection | null>(null);\n  const [projection, setProjection] = React.useState<string | null>(\"all\");\n  const [to, setTo] = React.useState<ICollection | null>(null);\n\n  const recomputeProjections = async () => {\n    if (from?.projections && to && projection) {\n      const recomputedParticles = await computeProjectionsWithModels(\n        to.data,\n        projection === \"all\" ? Object.entries(from.projections).reduce((acc, [key, value]) => ({...acc, [key]: value.model}), {}) : { [projection]: from.projections[projection].model }\n      );\n\n      const toName = (projection: string): string => `${from.name}_${projection}_base`;\n\n      const newTo = {\n        ...to,\n        data: to.data.map((d, i) => ({\n          ...d,\n          projection: {\n            ...d.projection,\n            ...Object.entries(recomputedParticles.projection).reduce(\n              (acc, [projection, data]) => ({\n                ...acc,\n                [toName(projection)]: data[i],\n              }),\n              {}\n            ),\n          },\n        })),\n        projections: {\n          ...(to.projections || {}),\n          ...Object.entries(recomputedParticles.projections || {}).reduce((acc, [projection, data]) => ({\n            ...acc,\n            [toName(projection)]: data\n          }), {})\n        }\n      };\n\n      const newFrom = {\n        ...from,\n        data: from.data.map((d) => ({\n          ...d,\n          projection: {\n            ...d.projection,\n            ...Object.keys(recomputedParticles.projection).reduce(\n              (acc, projection) => ({\n                ...acc,\n                [toName(projection)]: d.projection[projection],\n              }),\n              {}\n            ),\n          },\n        })),\n      };\n      // throw Error('TEST');\n\n      setCollections(collections.map((c) => (c === to ? newTo : c === from ? newFrom : c)));\n\n      setTo(newTo);\n      setFrom(newFrom);\n    }\n  };\n\n  const collectionsWithProjections = collections.filter(\n    (c) => c.projections && Object.entries(c.projections).some(([key, value]) => value.model)\n  );\n\n  const collectionsWithEmbeddings = collections.filter(\n    (c) => c.data?.[0].embedding && Object.entries(c.data?.[0].embedding).length > 0\n  );\n\n  return (\n    <FormWrapper\n      title=\"Recompute Projections\"\n      loading={loading}\n      setLoading={setLoading}\n      onSubmit={recomputeProjections}\n    >\n      {collectionsWithProjections.length > 0 ? (\n        <>\n          <div className=\"mb-3\">\n            <label htmlFor=\"recomputeProjectionFrom\">Reference collection</label>\n            <div className=\"input-group input-group-sm\">\n              <select\n                className=\"form-control\"\n                id=\"recomputeProjectionFrom\"\n                value={from?.name}\n                onChange={(e) => {\n                  const from = e.currentTarget.value;\n                  setFrom(from ? collections.find((c) => c.name === from)! : null);\n                }}\n              >\n                <option value=\"\">Select...</option>\n                {collectionsWithProjections.map((c) => (\n                  <option key={c.name} value={c.name}>{c.name}</option>\n                ))}\n              </select>\n            </div>\n          </div>\n          {from ? (\n            <div className=\"mb-3\">\n              <label htmlFor=\"recomputeProjectionProjection\">Projection</label>\n              <div className=\"input-group input-group-sm\">\n                <select\n                  className=\"form-control\"\n                  id=\"recomputeProjectionProjection\"\n                  value={projection || undefined}\n                  onChange={(e) => {\n                    setProjection(e.currentTarget.value);\n                  }}\n                >\n                  <option value=\"all\">All</option>\n                  {Object.entries(from?.projections || {})\n                    .filter(([key, value]) => value.model)\n                    .map(([key, value]) => (\n                      <option value={key}>{key}</option>\n                    ))}\n                </select>\n              </div>\n            </div>\n          ) : null}\n          <div className=\"mb-3\">\n            <label htmlFor=\"recomputeProjectionTo\">Subset collection</label>\n            <div className=\"input-group input-group-sm\">\n              <select\n                className=\"form-control\"\n                id=\"recomputeProjectionTo\"\n                value={to?.name}\n                onChange={(e) => {\n                  const to = e.currentTarget.value;\n                  setTo(to ? collections.find((c) => c.name === to)! : null);\n                }}\n              >\n                <option value=\"\">Select...</option>\n                {collectionsWithEmbeddings.map((c) => (\n                  <option value={c.name}>{c.name}</option>\n                ))}\n              </select>\n            </div>\n          </div>\n          <div className=\"text-end\">\n            <ButtonWithUpload\n              loading={loading}\n              disabled={Boolean(!from || !to || from === to)}\n              text=\"Compute Projections\"\n            />\n          </div>\n        </>\n      ) : (\n        <p>At least 2 collections must be available.</p>\n      )}\n    </FormWrapper>\n  );\n};\n","import * as React from \"react\";\nimport { ICollection, IParticleSelection } from \"../../interfaces\";\nimport { ButtonWithUpload } from \"../ButtonWithUpload\";\nimport { getMatchedMolecularPairs, embedStructures, getStonedSelfies } from \"../../utils/api\";\nimport { FormWrapper } from \"./FormWrapper\";\nimport { UseStructureInputAddon } from \"../UseStructureInputAddon\";\nimport { useNameInput } from \"../../utils/hooks\";\n\nexport const StonedSelfiesForm = ({\n  addCollection,\n  selection,\n  loading,\n  setLoading,\n}: {\n  addCollection(collection: ICollection): void;\n  selection?: IParticleSelection;\n  loading: boolean;\n  setLoading(loading: boolean): void;\n}) => {\n  const [structure, setStructure] = React.useState<string>(\"\");\n  const [name, setName, nameInput] = useNameInput(\"stonedSelfiesNameInput\", `SELFIES ${structure}`);\n  const [substructure, setSubstructure] = React.useState<string>(\"\");\n  const [randomSamples, setRandomSamples] = React.useState<number>(1000);\n  const [maxMutations, setMaxMutations] = React.useState<number>(5);\n\n  return (\n    <FormWrapper\n      title={\n        <>\n          Stoned Selfies &nbsp;\n          <a\n            style={{ fontSize: \"smaller\" }}\n            href=\"https://github.com/aspuru-guzik-group/stoned-selfies\"\n            target=\"_blank\"\n            rel=\"noreferrer\"\n          >\n            <i className=\"fas fa-fw fa-info-circle\" />\n          </a>\n        </>}\n      loading={loading}\n      setLoading={setLoading}\n      onSubmit={async () => {\n        const { structures } = await getStonedSelfies({\n          structure,\n          substructure,\n          random_samples: randomSamples,\n          max_mutations: maxMutations,\n        });\n        if (structures.length === 0) {\n          throw Error(\"No stoned selfies found\");\n        }\n        const embeddedCollection = await embedStructures({ structures: structures.map((smiles) => ({smiles})), include_embedding: true });\n        addCollection({\n          name,\n          ...embeddedCollection,\n        });\n        setName(\"\");\n      }}\n    >\n      {nameInput}\n      <div className=\"mb-3\">\n        <label htmlFor=\"stonedSelfiesStructureInput\">Structure</label>\n        <div className=\"input-group input-group-sm\">\n          <UseStructureInputAddon value={structure} selection={selection} setValue={setStructure} />\n          <input\n            type=\"text\"\n            className=\"form-control form-control-sm\"\n            id=\"stonedSelfiesStructureInput\"\n            aria-describedby=\"stonedSelfiesStructureInput\"\n            value={structure}\n            onChange={(e) => setStructure(e.currentTarget.value)}\n          />\n        </div>\n      </div>\n      <details>\n        <summary>Advanced Settings</summary>\n        <div className=\"mb-3\">\n          <label htmlFor=\"stonedSelfiesSubstructureInput\">Substructure</label>\n          <div className=\"input-group input-group-sm\">\n            <UseStructureInputAddon value={substructure} selection={selection} setValue={setSubstructure} />\n            <input\n              type=\"text\"\n              className=\"form-control form-control-sm\"\n              id=\"stonedSelfiesSubstructureInput\"\n              aria-describedby=\"stonedSelfiesSubstructureInput\"\n              value={substructure}\n              onChange={(e) => setSubstructure(e.currentTarget.value)}\n            />\n          </div>\n        </div>\n        <div className=\"mb-3\">\n          <label htmlFor=\"stonedSelfiesRandomSamplesInput\" className=\"form-label\">Nr. of Random Samples: {randomSamples}</label>\n          <input\n            type=\"range\"\n            className=\"form-range\"\n            id=\"stonedSelfiesRandomSamplesInput\"\n            value={randomSamples}\n            onChange={(e) => setRandomSamples(e.currentTarget.valueAsNumber)}\n            min={500}\n            max={50000}\n          />\n        </div>\n        <div className=\"mb-3\">\n          <label htmlFor=\"stonedSelfiesMaxPermutationsInput\" className=\"form-label\">Maximum Permutations: {maxMutations}</label>\n          <input\n            type=\"range\"\n            className=\"form-range\"\n            id=\"stonedSelfiesMaxPermutationsInput\"\n            value={maxMutations}\n            onChange={(e) => setMaxMutations(e.currentTarget.valueAsNumber)}\n            min={1}\n            max={20}\n          />\n        </div>\n      </details>\n      <div className=\"text-end\">\n        <ButtonWithUpload loading={loading} disabled={!structure} text=\"Compute\" />\n      </div>\n    </FormWrapper>\n  );\n};\n","import * as React from \"react\";\nimport castArray from \"lodash.castarray\";\nimport Select from \"react-select/creatable\";\n\nexport interface GenericPlotSelectOption<T> {\n  option: T | null | undefined;\n  setOption(option: T | null): void;\n}\n\nexport interface IPlotSelectExtension {\n  component: React.FunctionComponent<{\n    availableNearestNeighbors: string[];\n    availableClusters: string[];\n    availableProperties: string[];\n  } & GenericPlotSelectOption<string>>;\n  additionalOptions: {label: string, value: string}[];\n}\n\nexport function PlotSelect<IsMulti extends boolean = false>({\n  inline = true,\n  multi,\n  option,\n  setOption,\n  label,\n  options,\n  id,\n  disabled,\n  availableNearestNeighbors,\n  availableClusters,\n  availableProperties,\n  extensions,\n}: {\n  inline?: boolean;\n  options: string[];\n  disabled?: boolean;\n  id: string;\n  label?: string;\n  multi: IsMulti;\n  availableNearestNeighbors: string[];\n  availableClusters: string[];\n  availableProperties: string[];\n  extensions?: IPlotSelectExtension[];\n} & (IsMulti extends true ? GenericPlotSelectOption<string[]> : GenericPlotSelectOption<string>)) {\n  const values: string[] = React.useMemo(() => castArray(option).filter(Boolean) as string[], [option]);\n\n  return (\n    <div className={`d-flex position-relative ${inline ? 'col-sm-3' : 'col-12'}`}>\n      {label ? (\n        <label\n          className={`my-1 me-2 align-self-center ${inline ? \"\" : \"col-sm-2 d-flex\"}`}\n          style={{ whiteSpace: \"nowrap\" }}\n          htmlFor={id}\n        >\n          {label}\n        </label>\n      ) : null}\n      <div className={`my-1 me-sm-2 flex-fill ${inline ? \"\" : \"col-sm-10\"}`} style={{ minWidth: 100 }}>\n        <div className=\"row\">\n          <div className=\"col\">\n            <Select<{ label: string; value: string }, IsMulti>\n              menuPosition=\"fixed\"\n              isMulti={multi}\n              isClearable\n              styles={{ menu: (base) => ({ ...base, zIndex: 999 }) }}\n              onCreateOption={(value) => {\n                setOption(value as any);\n              }}\n              value={values.map((p) => ({\n                label: p,\n                value: p,\n              }))}\n              onChange={(e) => {\n                if (!e) {\n                  setOption(null);\n                  return;\n                }\n                // @ts-ignore\n                const values: { label: string; value: string }[] = castArray(e);\n                if (multi) {\n                  setOption(values.map((p) => p.value) as any);\n                } else {\n                  setOption(values?.[0]?.value as any);\n                }\n              }}\n              options={[\n                ...(extensions || []).map((e) => e.additionalOptions || []).flat(),\n                ...options.map((option) => ({\n                  label: option,\n                  value: option,\n                })),\n              ]}\n            />\n          </div>\n          {extensions?.map((e) => (\n            <e.component\n              setOption={(e) => {\n                if(!e) {\n                  return null;\n                }\n                const values: string[] = castArray(e);\n                if (multi) {\n                  setOption(values.map((p) => p) as any);\n                } else {\n                  setOption(values?.[0] as any);\n                }\n              }}\n              availableNearestNeighbors={availableNearestNeighbors}\n              availableClusters={availableClusters}\n              availableProperties={availableProperties}\n              option={values?.[0]}\n            />\n          ))}\n        </div>\n      </div>\n    </div>\n  );\n}\n","import * as React from \"react\";\nimport { GenericPlotSelectOption, IPlotSelectExtension } from \"./PlotSelect\";\n\nexport const PlotSelectJaccardExtension: IPlotSelectExtension = {\n  component: ({\n    option,\n    setOption,\n    availableNearestNeighbors,\n  }: {\n    availableNearestNeighbors: string[];\n  } & GenericPlotSelectOption<string>) => {\n    const [key, jaccardEmb1, jaccardEmb2, jaccardNN] = option?.split(\"=\") || [];\n    const isJaccard = key === \"jaccard\";\n\n    return isJaccard ? (\n      <>\n        <div className=\"col\">\n          <select\n            className=\"form-control\"\n            value={jaccardEmb1 || \"\"}\n            onChange={(e) =>\n              setOption(`jaccard=${e.currentTarget.value}=${jaccardEmb2 || \"\"}=${jaccardNN || \"\"}` as any)\n            }\n          >\n            <option value=\"\">Select...</option>\n            {availableNearestNeighbors.map((nn) => (\n              <option value={nn}>{nn}</option>\n            ))}\n          </select>\n        </div>\n        <div className=\"col\">\n          <select\n            className=\"form-control\"\n            value={jaccardEmb2 || \"\"}\n            onChange={(e) =>\n              setOption(`jaccard=${jaccardEmb1 || \"\"}=${e.currentTarget.value}=${jaccardNN || \"\"}` as any)\n            }\n          >\n            <option value=\"\">Select...</option>\n            {availableNearestNeighbors.map((nn) => (\n              <option value={nn}>{nn}</option>\n            ))}\n          </select>\n        </div>\n        <div className=\"col\">\n          <input\n            className=\"form-control\"\n            type=\"number\"\n            min={1}\n            max={50}\n            value={+jaccardNN || \"\"}\n            onChange={(e) =>\n              setOption(`jaccard=${jaccardEmb1 || \"\"}=${jaccardEmb2 || \"\"}=${e.currentTarget.value}` as any)\n            }\n          />\n        </div>\n      </>\n    ) : null;\n  },\n  additionalOptions: [\n    {\n      label: \"Ratio of matching nearest neighbors\",\n      value: \"jaccard=\",\n    },\n  ],\n};\n","import * as React from \"react\";\nimport { ARRAY_DISTANCE_METRICS } from \"../utils/constants\";\nimport { GenericPlotSelectOption, IPlotSelectExtension } from \"./PlotSelect\";\n\nexport const PlotSelectNNDiffExtension: IPlotSelectExtension = {\n  component: ({\n    option,\n    setOption,\n    availableNearestNeighbors,\n    availableProperties,\n  }: {\n    availableNearestNeighbors: string[];\n    availableProperties: string[];\n  } & GenericPlotSelectOption<string>) => {\n    const [key, emb, property, method, nn] = option?.split(\"=\") || [];\n    const isNNDiff = key === \"nn_diff\";\n\n    return isNNDiff ? (\n      <>\n        <div className=\"col\">\n          <select\n            className=\"form-control\"\n            value={emb || \"\"}\n            onChange={(e) =>\n              setOption(`nn_diff=${e.currentTarget.value}=${property || \"\"}=${method || \"\"}=${nn || \"\"}` as any)\n            }\n          >\n            <option value=\"\">Select...</option>\n            {availableNearestNeighbors.map((nn) => (\n              <option value={nn}>{nn}</option>\n            ))}\n          </select>\n        </div>\n        <div className=\"col\">\n          <select\n            className=\"form-control\"\n            value={property || \"\"}\n            onChange={(e) =>\n              setOption(`nn_diff=${emb || \"\"}=${e.currentTarget.value}=${method || \"\"}=${nn || \"\"}` as any)\n            }\n          >\n            <option value=\"\">Select...</option>\n            {availableProperties.map((prop) => (\n              <option value={prop}>{prop}</option>\n            ))}\n          </select>\n        </div>\n        <div className=\"col\">\n          <select\n            className=\"form-control\"\n            value={method || \"\"}\n            onChange={(e) =>\n              setOption(`nn_diff=${emb || \"\"}=${property || \"\"}=${e.currentTarget.value}=${nn || \"\"}` as any)\n            }\n          >\n            <option value=\"\">Select...</option>\n            {Object.keys(ARRAY_DISTANCE_METRICS).map((prop) => (\n              <option value={prop}>{prop}</option>\n            ))}\n          </select>\n        </div>\n        <div className=\"col\">\n          <input\n            className=\"form-control\"\n            type=\"number\"\n            min={1}\n            max={50}\n            value={+nn || \"\"}\n            onChange={(e) =>\n              setOption(`nn_diff=${emb || \"\"}=${property || \"\"}=${method || \"\"}=${e.currentTarget.value}` as any)\n            }\n          />\n        </div>\n      </>\n    ) : null;\n  },\n  additionalOptions: [\n    {\n      label: \"Properties of nearest neighbors\",\n      value: \"nn_diff=\",\n    },\n  ],\n};\n","import * as React from \"react\";\nimport { GenericPlotSelectOption, IPlotSelectExtension } from \"./PlotSelect\";\n\nexport const PlotSelectKNNExtension: IPlotSelectExtension = {\n  component: ({\n    option,\n    setOption,\n    availableNearestNeighbors,\n  }: {\n    availableNearestNeighbors: string[];\n  } & GenericPlotSelectOption<string>) => {\n    const [key, emb, nn] = option?.split(\"=\") || [];\n    const isKNN = key === \"knn\";\n\n    return isKNN ? (\n      <>\n        <div className=\"col\">\n          <select\n            className=\"form-control\"\n            value={emb || \"\"}\n            onChange={(e) =>\n              setOption(`knn=${e.currentTarget.value}=${nn || \"\"}` as any)\n            }\n          >\n            <option value=\"\">Select...</option>\n            {availableNearestNeighbors.map((nn) => (\n              <option value={nn}>{nn}</option>\n            ))}\n          </select>\n        </div>\n        <div className=\"col\">\n          <input\n            className=\"form-control\"\n            type=\"number\"\n            min={1}\n            max={50}\n            value={+nn || \"\"}\n            onChange={(e) =>\n              setOption(`knn=${emb || \"\"}=${e.currentTarget.value}` as any)\n            }\n          />\n        </div>\n      </>\n    ) : null;\n  },\n  additionalOptions: [\n    {\n      label: \"K-Nearest Neighbors\",\n      value: \"knn=\",\n    },\n  ],\n};\n","import * as React from \"react\";\nimport { GenericPlotSelectOption, IPlotSelectExtension } from \"./PlotSelect\";\n\nexport const PlotSelectClusterExtension: IPlotSelectExtension = {\n  component: ({\n    option,\n    setOption,\n    availableNearestNeighbors,\n    availableClusters,\n    availableProperties,\n  }: {\n    availableNearestNeighbors: string[];\n    availableClusters: string[];\n    availableProperties: string[];\n  } & GenericPlotSelectOption<string>) => {\n    const [key, emb] = option?.split(\"=\") || [];\n    const isNNDiff = key === \"cluster\";\n\n    return isNNDiff ? (\n      <>\n        <div className=\"col\">\n          <select\n            className=\"form-control\"\n            value={emb || \"\"}\n            onChange={(e) =>\n              setOption(`cluster=${e.currentTarget.value}` as any)\n            }\n          >\n            <option value=\"\">Select...</option>\n            {availableClusters.map((nn) => (\n              <option value={nn}>{nn}</option>\n            ))}\n          </select>\n        </div>\n      </>\n    ) : null;\n  },\n  additionalOptions: [\n    {\n      label: \"Clusters\",\n      value: \"cluster=\",\n    },\n  ],\n};\n","import * as React from \"react\";\nimport { GenericPlotSelectOption, IPlotSelectExtension } from \"./PlotSelect\";\n\nexport const PlotSelectEvalExtension: IPlotSelectExtension = {\n  component: ({ option, setOption }: {} & GenericPlotSelectOption<string>) => {\n    const [key, func] = option?.split(\"=\") || [];\n    const isEval = key === \"eval\";\n\n    return isEval ? (\n      <>\n        <div className=\"col-8\">\n          <div className=\"input-group\">\n            <span className=\"input-group-text\">\n              <code>(p) ={\">\"} </code>\n            </span>\n            <input\n              className=\"form-control\"\n              type=\"text\"\n              value={func || \"\"}\n              onChange={(e) => setOption(`eval=${e.currentTarget.value || \"\"}` as any)}\n            />\n          </div>\n        </div>\n      </>\n    ) : null;\n  },\n  additionalOptions: [\n    {\n      label: \"Custom function\",\n      value: \"eval=\",\n    },\n  ],\n};\n","import * as React from \"react\";\nimport { IEnabledProjection } from \"../../interfaces\";\nimport { PlotSelect } from \"../PlotSelect\";\nimport uniqueId from \"lodash.uniqueid\";\nimport { PlotSelectJaccardExtension } from \"../PlotSelectJaccardExtension\";\nimport { PlotSelectNNDiffExtension } from \"../PlotSelectNNDiffExtension\";\nimport { PlotSelectKNNExtension } from \"../PlotSelectKNNExtension\";\nimport { PlotSelectClusterExtension } from \"../PlotSelectClusterExtension\";\nimport { PlotSelectEvalExtension } from \"../PlotSelectEvalExtension\";\n\nexport const ProjectionSettingsForm = ({\n  inline,\n  config,\n  setConfig,\n  availableProjections,\n  availableNearestNeighbors,\n  availableClusters,\n  availableProperties,\n  availableOpacityProperties,\n  availableConnectByProperties,\n}: {\n  inline: boolean;\n  config: IEnabledProjection;\n  setConfig(value: IEnabledProjection): void;\n  availableProjections?: string[];\n  availableNearestNeighbors: string[];\n  availableClusters: string[];\n  availableProperties: string[];\n  availableOpacityProperties: string[];\n  availableConnectByProperties: string[];\n}) => {\n  const [id, setId] = React.useState<string>(uniqueId());\n  return (\n    <form className=\"row\">\n      {availableProjections ? (\n        <PlotSelect\n          multi={false}\n          inline={inline}\n          id={`projection${id}Select`}\n          label=\"Projection\"\n          option={config.projection}\n          options={availableProjections}\n          setOption={(projection: string) => {\n            setConfig({ ...config, projection });\n          }}\n          availableNearestNeighbors={availableNearestNeighbors}\n          availableClusters={availableClusters}\n          availableProperties={availableProperties}\n        />\n      ) : null}\n      <PlotSelect\n        multi={false}\n        inline={inline}\n        id={`colorEncoding${id}Select`}\n        label=\"Color Encoding\"\n        // disabled={groupBy !== null}\n        option={config.plotOptions.colorBy}\n        options={availableProperties}\n        setOption={(colorCoding: string) => {\n          setConfig({ ...config, plotOptions: { ...config.plotOptions, colorBy: colorCoding } });\n        }}\n        availableNearestNeighbors={availableNearestNeighbors}\n        availableClusters={availableClusters}\n        availableProperties={availableProperties}\n        extensions={[PlotSelectJaccardExtension, PlotSelectNNDiffExtension, PlotSelectClusterExtension, PlotSelectEvalExtension]}\n      />\n      <PlotSelect\n        multi={false}\n        inline={inline}\n        id={`opacity${id}Select`}\n        label=\"Opacity By\"\n        // disabled={colorCoding !== null}\n        option={typeof config.plotOptions.opacityBy === \"number\" ? \"constant\" : config.plotOptions.opacityBy}\n        options={availableOpacityProperties}\n        setOption={(opacityBy: string) => {\n          setConfig({\n            ...config,\n            plotOptions: { ...config.plotOptions, opacityBy: opacityBy === \"constant\" ? 0.5 : opacityBy },\n          });\n        }}\n        availableNearestNeighbors={availableNearestNeighbors}\n        availableClusters={availableClusters}\n        availableProperties={availableProperties}\n        extensions={[PlotSelectJaccardExtension, PlotSelectNNDiffExtension, PlotSelectClusterExtension, PlotSelectEvalExtension]}\n      />\n      {typeof config.plotOptions.opacityBy === \"number\" ? (\n        <div className=\"mb-3 me-sm-2\">\n          {/* <label for=\"formControlRange\" className=\"form-label\">Example Range input</label> */}\n          <input\n            type=\"range\"\n            className=\"form-range\"\n            min={0}\n            max={1}\n            step={0.01}\n            value={config.plotOptions.opacityBy}\n            onChange={(e) => {\n              setConfig({\n                ...config,\n                plotOptions: { ...config.plotOptions, opacityBy: e.currentTarget.valueAsNumber },\n              });\n            }}\n          />\n        </div>\n      ) : null}\n      <PlotSelect\n        multi={false}\n        inline={inline}\n        id={`grouping${id}Select`}\n        label=\"Group By\"\n        // disabled={colorCoding !== null}\n        option={config.plotOptions.groupBy}\n        options={availableProperties}\n        setOption={(groupBy: string) => {\n          setConfig({ ...config, plotOptions: { ...config.plotOptions, groupBy } });\n        }}\n        availableNearestNeighbors={availableNearestNeighbors}\n        availableClusters={availableClusters}\n        availableProperties={availableProperties}\n        extensions={[PlotSelectJaccardExtension, PlotSelectNNDiffExtension, PlotSelectClusterExtension, PlotSelectEvalExtension]}\n      />\n      <PlotSelect\n        multi={false}\n        inline={inline}\n        id={`sizeBy${id}Select`}\n        label=\"Size by\"\n        option={config.plotOptions.sizeBy}\n        options={availableProperties}\n        setOption={(sizeBy: string) => {\n          setConfig({ ...config, plotOptions: { ...config.plotOptions, sizeBy } });\n        }}\n        availableNearestNeighbors={availableNearestNeighbors}\n        availableClusters={availableClusters}\n        availableProperties={availableProperties}\n        extensions={[PlotSelectJaccardExtension, PlotSelectNNDiffExtension, PlotSelectEvalExtension]}\n      />\n      <PlotSelect\n        inline={inline}\n        id={`connectBy${id}Select`}\n        label=\"Connect by\"\n        multi={true}\n        option={config.plotOptions.connectBy}\n        options={availableConnectByProperties}\n        setOption={(option: string[]) => {\n          setConfig({\n            ...config,\n            plotOptions: { ...config.plotOptions, connectBy: option.length === 0 ? null : option },\n          });\n        }}\n        availableNearestNeighbors={availableNearestNeighbors}\n        availableClusters={availableClusters}\n        availableProperties={availableProperties}\n        extensions={[PlotSelectJaccardExtension, PlotSelectNNDiffExtension, PlotSelectKNNExtension, PlotSelectClusterExtension, PlotSelectEvalExtension]}\n      />\n    </form>\n  );\n};\n","import * as React from \"react\";\nimport { Modal } from \"react-bootstrap\";\nimport { Button } from \"react-bootstrap\";\nimport { IEnabledProjection } from \"../interfaces\";\nimport { ProjectionSettingsForm } from \"./form/ProjectionSettingsForm\";\n\nexport function ProjectionSettingsModal({\n  config: oldConfig,\n  availableProjections,\n  availableNearestNeighbors,\n  availableClusters,\n  availableProperties,\n  availableOpacityProperties,\n  availableConnectByProperties,\n  onHide,\n  onSave,\n}: {\n  config: IEnabledProjection | undefined;\n  availableProjections?: string[];\n  availableNearestNeighbors: string[];\n  availableClusters: string[];\n  availableProperties: string[];\n  availableOpacityProperties: string[];\n  availableConnectByProperties: string[];\n  onHide?(): void;\n  onSave?(value: IEnabledProjection): void;\n}) {\n  const [config, setConfig] = React.useState<IEnabledProjection | undefined>(oldConfig);\n\n  React.useEffect(() => {\n    setConfig(oldConfig);\n  }, [oldConfig]);\n\n  return (\n    <>\n      <Modal show={Boolean(config)} onHide={onHide} size=\"lg\">\n        <Modal.Header closeButton>\n          <Modal.Title>Configure {config?.value}</Modal.Title>\n        </Modal.Header>\n        <Modal.Body>\n          {config ? (\n            <>\n              <div className=\"d-flex position-relative\">\n                <label\n                  className={`my-1 me-2 col-sm-2 d-flex align-items-center`}\n                  style={{ whiteSpace: \"nowrap\" }}\n                  htmlFor=\"projectionNameInput\"\n                >\n                  Name\n                </label>\n                <div className={`my-1 me-sm-2 flex-fill col-sm-10`}>\n                  <input\n                    type=\"text\"\n                    id=\"projectionNameInput\"\n                    className=\"form-control\"\n                    value={config.label}\n                    onChange={(e) =>\n                      setConfig({ ...config, value: e.currentTarget.value, label: e.currentTarget.value })\n                    }\n                  />\n                </div>\n              </div>\n              <ProjectionSettingsForm\n                inline={false}\n                availableProjections={availableProjections}\n                availableNearestNeighbors={availableNearestNeighbors}\n                availableClusters={availableClusters}\n                availableConnectByProperties={availableConnectByProperties}\n                availableProperties={availableProperties}\n                availableOpacityProperties={availableOpacityProperties}\n                setConfig={setConfig}\n                config={config}\n              />\n            </>\n          ) : null}\n        </Modal.Body>\n        <Modal.Footer>\n          <Button variant=\"secondary\" onClick={onHide}>\n            Close\n          </Button>\n          <Button variant=\"primary\" onClick={() => (config ? onSave?.(config) : null)}>\n            Save\n          </Button>\n        </Modal.Footer>\n      </Modal>\n    </>\n  );\n}\n","import * as React from \"react\";\nimport { LoadingPage } from \"./components/LoadingPage\";\nimport {\n  DEFAULT_CHEMBL_COLLECTION,\n  EActiveTabs,\n  ICollection,\n  IEnabledProjection,\n  IParticle,\n  IParticleSelection,\n  IPlotOptions,\n  IRegistry,\n} from \"./interfaces\";\nimport { StructureCardGrid } from \"./components/StructureCardGrid\";\nimport { HorizontalCollapse } from \"./components/HorizontalCollapse\";\nimport { ClusterSidePanel } from \"./ClusterSidePanel\";\nimport { Tooltip } from \"./utils/hooks\";\nimport { GridItemOptions } from \"./components/GridItemOptions\";\nimport { Grid } from \"./components/Grid\";\nimport { ComputeEmbeddingsForm, MSOForm, TanimotoForm, SubstructureMatchingForm } from \"./components/form\";\nimport { getChemblUMAPEmbedding } from \"./utils/api\";\nimport { ScatterPlot } from \"./components/ScatterPlot\";\nimport { InterpolationForm } from \"./components/form/InterpolationForm\";\nimport { MatchedMolecularPairsForm } from \"./components/form/MatchedMolecularPairsForm\";\nimport { NeighborSamplingForm } from \"./components/form/NeighborSamplingForm\";\nimport { RecomputeEmbeddingsForm } from \"./components/form/RecomputeEmbeddingsForm\";\nimport CreatableSelect from \"react-select/creatable\";\nimport { ParallelCoordinatesPlot } from \"./components/ParallelCoordinatesPlot\";\nimport { StonedSelfiesForm } from \"./components/form/StonedSelfiesForm\";\nimport { StructureImage } from \"./components/StructureImage\";\nimport { ProjectionSettingsModal } from \"./components/ProjectionSettingsModal\";\nimport { ProjectionSettingsForm } from \"./components/form/ProjectionSettingsForm\";\nimport pickBy from \"lodash.pickby\";\n// @ts-ignore Typings?\nimport Split from \"react-split\";\nimport ReactResizeDetector from \"react-resize-detector\";\n\nconst NR_OF_LATENT_SPACE_PARTICLES = 10;\n\nexport function EmbeddingPage({\n  registry,\n  collections,\n  setCollections,\n  interpolationStructures,\n  setInterpolationStructures,\n  setActiveTab,\n}: {\n  registry: IRegistry | null;\n  collections: ICollection[];\n  setCollections(collections: ICollection[]): void;\n  interpolationStructures: string[];\n  setInterpolationStructures(structures: string[]): void;\n  setActiveTab(tab: EActiveTabs): void;\n}) {\n  const allParticles = React.useMemo(\n    () => collections.reduce<IParticle[]>((acc, cur) => [...acc, ...cur.data], []),\n    [collections]\n  );\n\n  const [visibleNeighborhoodSamplings, setVisibleNeighborhoodSamplings] = React.useState<IParticle[] | null>(null);\n  const [loading, setLoading] = React.useState<boolean>(false);\n  const [clusterCollapsed, setClusterCollapsed] = React.useState<boolean>(false);\n  const [optionsCollapsed, setOptionsCollapsed] = React.useState<boolean>(false);\n  const [enabledProjections, setEnabledProjections] = React.useState<IEnabledProjection[]>([\n    {\n      label: \"ecfp4_umap\",\n      value: \"ecfp4_umap\",\n      projection: \"ecfp4_umap\",\n      plotOptions: {},\n    },\n  ]);\n  const [editProjection, setEditProjection] = React.useState<IEnabledProjection | undefined>(undefined);\n\n  const [hover, setHover] = React.useState<IParticle | null>(null);\n  const [filtered, setFiltered] = React.useState<IParticleSelection>(null);\n  // Wrap the setSelected into a shallow list compare to avoid rerenders\n  // eslint-disable-next-line react-hooks/exhaustive-deps\n  // const selected = React.useMemo(() => mainParticles.filter((p) => p.selected), [mainParticles, _selectedChanged]);\n  // const selected = React.useMemo<{ [key: string]: IParticle[] } | undefined>(() => undefined, []);\n  const [selection, _setSelection] = React.useState<IParticleSelection>(null);\n  const setSelection = React.useCallback(\n    (s: IParticleSelection) => {\n      collections.forEach((c) => c.data.forEach((p) => (p.selected = false)));\n      if (s) {\n        const _setParticleSelected = (particle: IParticle) => (particle.selected = true);\n        if (Array.isArray(s)) {\n          s.forEach(_setParticleSelected);\n        } else {\n          Object.values(s).forEach((particles) => particles.forEach(_setParticleSelected));\n        }\n      }\n      _setSelection(s);\n    },\n    [collections]\n  );\n\n  // Plot options\n  const [plotOptions, setPlotOptions] = React.useState<IPlotOptions>({\n    colorBy: null,\n    opacityBy: null,\n    groupBy: null,\n    connectBy: null,\n    sizeBy: null,\n  });\n\n  const [customX, setCustomX] = React.useState<string | null>(null);\n  const [customY, setCustomY] = React.useState<string | null>(null);\n  const [customPlotSettings, setCustomPlotSettings] = React.useState<IEnabledProjection | undefined>(undefined);\n\n  // Ranking options\n  const [showSelectedOnly, setShowSelectedOnly] = React.useState<boolean>(false);\n\n  const [availableProperties, availableProjections, availableEmbeddings, availableNearestNeighbors, availableClusters] =\n    React.useMemo(() => {\n      const keys: (keyof IParticle)[] = [\"properties\", \"projection\", \"embedding\", \"nearest_neighbors\", \"clusters\"];\n      return keys.map((field) =>\n        Array.from(\n          allParticles\n            .reduce<Set<string>>((acc, cur) => {\n              Object.keys(cur[field] || {}).forEach((key) => acc.add(key));\n              return acc;\n            }, new Set())\n            .keys()\n        )\n      );\n    }, [allParticles]);\n\n  const availableOpacityProperties = React.useMemo(() => [...availableProperties, \"constant\"], [availableProperties]);\n  const availableConnectByProperties = React.useMemo(() => availableProperties, [availableProperties]);\n\n  React.useEffect(() => {\n    if (plotOptions.colorBy && !availableProperties.includes(plotOptions.colorBy)) {\n      // setPlotOptions({ ...plotOptions, colorBy: null });\n    }\n    if (\n      plotOptions.opacityBy &&\n      typeof plotOptions.opacityBy !== \"number\" &&\n      !availableOpacityProperties.includes(plotOptions.opacityBy)\n    ) {\n      setPlotOptions({ ...plotOptions, opacityBy: null });\n    }\n    if (plotOptions.groupBy && !availableProperties.includes(plotOptions.groupBy)) {\n      setPlotOptions({ ...plotOptions, groupBy: null });\n    }\n    if (\n      plotOptions.connectBy &&\n      plotOptions.connectBy.some((option) => !availableConnectByProperties.includes(option))\n    ) {\n      // setPlotOptions({ ...plotOptions, connectBy: null });\n    }\n    if (plotOptions.sizeBy && !availableProperties.includes(plotOptions.sizeBy)) {\n      setPlotOptions({ ...plotOptions, sizeBy: null });\n    }\n  }, [availableProperties, availableOpacityProperties, availableConnectByProperties, plotOptions]);\n\n  React.useEffect(\n    () => {\n      if (false && !collections.find((c) => c.name === DEFAULT_CHEMBL_COLLECTION)) {\n        getChemblUMAPEmbedding()\n          .then((data) => setCollections([...collections, { data, name: DEFAULT_CHEMBL_COLLECTION }]))\n          .catch((e) => console.error(\"Error loading chembl umap\", e));\n      }\n    },\n    [\n      /* collections, setCollections */\n    ]\n  );\n\n  const filteredCollections = React.useMemo<ICollection[]>(() => {\n    return filtered ? Object.entries(filtered).map(([name, data]) => ({ name, data })) : collections;\n  }, [filtered, collections]);\n\n  const visibleCollections = React.useMemo<ICollection[]>(() => {\n    return showSelectedOnly && selection\n      ? Object.entries(selection).map(([name, data]) => ({ name, data }))\n      : collections;\n  }, [collections, showSelectedOnly, selection]);\n\n  const latentSpaceCollections = React.useMemo<{ [key: string]: ICollection[] } | null>(() => {\n    return true\n      ? availableEmbeddings.reduce<{ [key: string]: any }>(\n          (acc, cur) => ({\n            ...acc,\n            [cur]: filteredCollections.map((c) => {\n              // Restrict to the first n particles\n              const data = c.data\n                .slice(0, NR_OF_LATENT_SPACE_PARTICLES)\n                .filter((d) => d.embedding?.[cur])\n                .map((d) => {\n                  return d.embedding![cur].map((y, x) => ({\n                    ...d,\n                    properties: {\n                      ...(d.properties || {}),\n                      latentX: x,\n                      latentY: y,\n                    },\n                  }));\n                })\n                .flat();\n              return {\n                ...c,\n                data,\n              };\n            }),\n          }),\n          {}\n        )\n      : null;\n  }, [filteredCollections, availableEmbeddings]);\n\n  return (\n    <>\n      <Tooltip>\n        {hover ? (\n          // <StructureCard\n          //   structure={hover}\n          //   showProperties={false}\n          //   style={{\n          //     width: 180,\n          //     backgroundColor: 'rgba(255, 255, 255, 0.2)'\n          //   }}\n          // />\n          <StructureImage\n            structure={hover.structure}\n            style={{\n              width: 180,\n              backgroundColor: \"rgba(255, 255, 255, 0.6)\",\n            }}\n          />\n        ) : null}\n      </Tooltip>\n      <ProjectionSettingsModal\n        config={editProjection}\n        availableNearestNeighbors={availableNearestNeighbors}\n        availableClusters={availableClusters}\n        availableProjections={availableProjections}\n        availableProperties={availableProperties}\n        availableOpacityProperties={availableOpacityProperties}\n        availableConnectByProperties={availableConnectByProperties}\n        onHide={() => setEditProjection(undefined)}\n        onSave={(value) => {\n          setEditProjection(undefined);\n          // TODO: Hacky way to distinguish if the custom plot or one of the added plots was edited.\n          if(enabledProjections.includes(editProjection!)) {\n            setEnabledProjections((projections) => projections.map((p) => (p === editProjection ? value : p)));\n          } else if(!customPlotSettings || customPlotSettings === editProjection) {\n            setCustomPlotSettings(value);\n          }\n        }}\n      />\n      <HorizontalCollapse\n        label=\"Options\"\n        position=\"left\"\n        size=\"col-3\"\n        collapsed={optionsCollapsed}\n        setCollapsed={setOptionsCollapsed}\n      >\n        <ComputeEmbeddingsForm\n          addCollection={(collection) => setCollections([...collections, collection])}\n          loading={loading}\n          setLoading={setLoading}\n        />\n        <MSOForm\n          availableObjectives={registry?.objectives}\n          addCollection={(collection) => setCollections([...collections, collection])}\n          selection={selection}\n          loading={loading}\n          setLoading={setLoading}\n        />\n        <InterpolationForm\n          open={false}\n          setCollection={(collection) => {\n            setCollections([...collections.filter((c) => c.name !== collection.name), collection]);\n          }}\n          loading={loading}\n          setLoading={setLoading}\n          setStructures={setInterpolationStructures}\n          structures={interpolationStructures}\n        />\n        <MatchedMolecularPairsForm\n          addCollection={(collection) => setCollections([...collections, collection])}\n          loading={loading}\n          setLoading={setLoading}\n          selection={selection}\n        />\n        <SubstructureMatchingForm\n          collections={collections}\n          setCollections={setCollections}\n          selection={selection}\n          loading={loading}\n          setLoading={setLoading}\n        />\n        <TanimotoForm\n          collections={collections}\n          setCollections={setCollections}\n          selection={selection}\n          loading={loading}\n          setLoading={setLoading}\n        />\n        <NeighborSamplingForm\n          visible={visibleNeighborhoodSamplings}\n          setVisible={setVisibleNeighborhoodSamplings}\n          collections={collections}\n          setCollections={setCollections}\n          selection={selection}\n          loading={loading}\n          setLoading={setLoading}\n        />\n        <RecomputeEmbeddingsForm\n          collections={collections}\n          setCollections={setCollections}\n          selection={selection}\n          loading={loading}\n          setLoading={setLoading}\n        />\n        <StonedSelfiesForm\n          addCollection={(collection) => setCollections([...collections, collection])}\n          selection={selection}\n          loading={loading}\n          setLoading={setLoading}\n        />\n      </HorizontalCollapse>\n      {/*<div className=\"mt-5\" style={{ position: \"relative\", width: 0 }}>\n        <div className=\"sticky-top\" style={{ top: \"20%\", width: 100 }}>\n          {hover ? (\n            <StructureCard\n              structure={hover}\n              style={{\n                left: 5,\n                width: \"100%\",\n              }}\n            />\n          ) : null}\n        </div>\n      </div>*/}\n      <Split\n        // minSize={250}\n        gutterSize={5}\n        sizes={[75, 25]}\n        className={`split col-${optionsCollapsed ? \"12\" : \"9\"}`}\n        style={{\n          height: \"100%\",\n          paddingLeft: optionsCollapsed ? 40 : 0,\n          // marginRight: 40,\n        }}\n        onDragEnd={() => {\n          window.dispatchEvent(new Event('resize'));\n        }}\n      >\n        <div\n          // className=\"col-md-10\"\n          style={{\n            display: \"flex\",\n            flexDirection: \"column\",\n            height: \"100%\",\n            overflow: \"auto\",\n            paddingRight: 15,\n          }}\n        >\n          <LoadingPage\n            loading={loading && collections.length === 0}\n            fallback=\"Please select structures for embedding\"\n            loadingText=\"Computing embedding of structures...\"\n          >\n            {collections.length > 0 ? (\n              <>\n                <details>\n                  <summary>\n                    <h6 className=\"d-inline-block\">\n                      Plot Options <small className=\"text-muted\">to customize the projection plots</small>\n                    </h6>\n                  </summary>\n                  <div className=\"ms-3\">\n                    {[\n                      {\n                        name: \"General\",\n                        plotOptions,\n                        setter: (options: Partial<IPlotOptions>) => setPlotOptions({ ...plotOptions, ...options }),\n                      },\n                      ...collections.map((collection) => ({\n                        name: collection.name,\n                        plotOptions: collection.plotOptions || {},\n                        setter: (options: Partial<IPlotOptions>) =>\n                          setCollections(\n                            collections.map((c) =>\n                              c === collection\n                                ? {\n                                    ...c,\n                                    plotOptions: {\n                                      ...(c.plotOptions || {}),\n                                      ...options,\n                                    },\n                                  }\n                                : c\n                            )\n                          ),\n                      })),\n                    ].map(({ name, setter, plotOptions }, i) => (\n                      <details open={i === 0}>\n                        <summary>\n                          {name} Options{\" \"}\n                          <small className=\"text-muted\">{Object.values(plotOptions).filter(Boolean).length}</small>\n                        </summary>\n                        <ProjectionSettingsForm\n                          inline={true}\n                          availableNearestNeighbors={availableNearestNeighbors}\n                          availableClusters={availableClusters}\n                          availableConnectByProperties={availableConnectByProperties}\n                          availableProperties={availableProperties}\n                          availableOpacityProperties={availableOpacityProperties}\n                          setConfig={(newConfig) => setter(newConfig.plotOptions)}\n                          config={{\n                            label: \"General\",\n                            value: \"\",\n                            projection: \"\",\n                            plotOptions,\n                          }}\n                        />\n                      </details>\n                    ))}\n                  </div>\n                </details>\n\n                <details className=\"row\" style={{ position: \"relative\" }} open={true}>\n                  <summary>\n                    <h6 className=\"d-inline-block\">\n                      Parallel Coordinates <small className=\"text-muted\">to compare multiple numeric properties</small>\n                    </h6>\n                  </summary>\n                  <ParallelCoordinatesPlot\n                    collections={filteredCollections}\n                    selection={selection}\n                    setSelection={setSelection}\n                  />\n                </details>\n\n                <details className=\"row\" style={{ position: \"relative\" }} open={true}>\n                  <summary>\n                    <h6 className=\"d-inline-block\">\n                      Custom Plot <small className=\"text-muted\">to compare two arbitrary properties</small>\n                    </h6>\n                  </summary>\n                  <Grid>\n                    <GridItemOptions\n                      key=\"Custom\"\n                      gridOptions={{\n                        w: 12,\n                        h: 25,\n                        y: 0,\n                        x: 0,\n                      }}\n                      onSettings={() => setEditProjection(customPlotSettings || {\n                        label: 'Custom',\n                        value: 'Custom',\n                        projection: null,\n                        plotOptions: {}\n                      })}\n                    >\n                      <ScatterPlot\n                        title={customX && customY ? `${customX} vs. ${customY}` : \"Please select two axis properties\"}\n                        collections={filteredCollections}\n                        options={{ ...plotOptions, ...pickBy(customPlotSettings?.plotOptions || {}, (v) => v) }}\n                        hover={hover}\n                        setHover={setHover}\n                        selected={selection}\n                        setSelected={setSelection}\n                        xAccessor={`properties.${customX}`}\n                        yAccessor={`properties.${customY}`}\n                      >\n                        <div\n                          style={{\n                            width: 150,\n                            position: \"absolute\",\n                            left: -45,\n                            top: \"50%\",\n                            transform: \"rotate(-90deg)\",\n                          }}\n                        >\n                          <select\n                            className=\"form-control form-control-sm\"\n                            value={customY || \"\"}\n                            onChange={(e) => setCustomY(e.currentTarget.value || null)}\n                          >\n                            <option value=\"\">Select...</option>\n                            {availableProperties.map((p) => (\n                              <option key={p}>{p}</option>\n                            ))}\n                          </select>\n                        </div>\n                        <div\n                          style={{\n                            width: 150,\n                            position: \"absolute\",\n                            left: \"40%\",\n                            bottom: 0,\n                          }}\n                        >\n                          <select\n                            className=\"form-control form-control-sm\"\n                            value={customX || \"\"}\n                            onChange={(e) => setCustomX(e.currentTarget.value || null)}\n                          >\n                            <option value=\"\">Select...</option>\n                            {availableProperties.map((p) => (\n                              <option key={p}>{p}</option>\n                            ))}\n                          </select>\n                        </div>\n                      </ScatterPlot>\n                    </GridItemOptions>\n                  </Grid>\n                </details>\n\n                <details className=\"row\" style={{ position: \"relative\" }} open={true}>\n                  <summary>\n                    <h6 className=\"d-inline-block\">\n                      Latent Space Visualization <small className=\"text-muted\"></small>\n                    </h6>\n                  </summary>\n                  <Grid>\n                    {Object.keys(latentSpaceCollections || []).map((embedding) => (\n                      <GridItemOptions\n                        key={embedding}\n                        gridOptions={{\n                          w: 12,\n                          h: 25,\n                          y: 0,\n                          x: 0,\n                        }}\n                      >\n                        <ScatterPlot\n                          title={`Top ${NR_OF_LATENT_SPACE_PARTICLES} in ${embedding.toUpperCase()} Latent Space`}\n                          collections={latentSpaceCollections![embedding]}\n                          options={plotOptions}\n                          hover={hover}\n                          setHover={(hover) => {\n                            setHover(\n                              hover\n                                ? collections\n                                    .find((c) => c.name === hover.collection)\n                                    ?.data.find((d) => d.index === hover.index) || null\n                                : null\n                            );\n                          }}\n                          selected={selection}\n                          setSelected={(selected) => {\n                            setSelection(selected);\n                          }}\n                          xAccessor={`properties[latentX]`}\n                          yAccessor={`properties[latentY]`}\n                        />\n                      </GridItemOptions>\n                    ))}\n                  </Grid>\n                </details>\n\n                <details open={true}>\n                  <summary>\n                    <h6 className=\"d-inline-block\">\n                      Projections{\" \"}\n                      <small className=\"text-muted\">\n                        {enabledProjections.length} out of {availableProjections.length}\n                      </small>\n                    </h6>\n                  </summary>\n                  <CreatableSelect<IEnabledProjection, true>\n                    isMulti\n                    name=\"projections\"\n                    value={enabledProjections}\n                    onChange={(e) => {\n                      setEnabledProjections(e.map((v) => v));\n                    }}\n                    onCreateOption={(label) => {\n                      const newOption: IEnabledProjection = {\n                        label: label,\n                        value: label,\n                        projection: \"\",\n                        plotOptions: {},\n                      };\n                      setEnabledProjections([...enabledProjections, newOption]);\n                      setEditProjection(newOption);\n                    }}\n                    options={availableProjections.map((p) => ({\n                      label: p,\n                      value: p,\n                      projection: p,\n                      plotOptions: {},\n                    }))}\n                    closeMenuOnSelect={false}\n                  />\n                  <div className=\"row\" style={{ position: \"relative\" }}>\n                    <Grid>\n                      {\n                        enabledProjections\n                          // .filter((p) => availableProjections.includes(p.projection))\n                          .map((config, i) => (\n                            <GridItemOptions\n                              key={config.value}\n                              onClose={() => {\n                                setEnabledProjections(enabledProjections.filter((p) => p !== config));\n                              }}\n                              onSettings={() => setEditProjection(config)}\n                              gridOptions={{\n                                w: 6,\n                                h: 25,\n                                y: 0 + Math.floor(i / 2) * 25,\n                                x: i % 2 === 0 ? 0 : 6,\n                              }}\n                              renderInfo={() => (\n                                <>\n                                  {filteredCollections.map((c) => (\n                                    <div className=\"d-flex flex-column\">\n                                      <strong className=\"text-nowrap text-truncate\">{c.name}</strong>\n                                      {Object.entries(c.projections?.[config.projection!] || {})\n                                        .filter(([key, value]) => typeof value === \"number\")\n                                        .map(([key, value]) => (\n                                          <div className=\"text-nowrap d-flex\">\n                                            <span className=\"text-truncate\">{key}</span>\n                                            <span className=\"flex-fill\">\n                                              : {(value as number).toFixed(3) || \"Not available\"}\n                                            </span>\n                                          </div>\n                                        ))}\n                                    </div>\n                                  ))}\n                                </>\n                              )}\n                            >\n                              <ScatterPlot\n                                title={config.value}\n                                collections={filteredCollections}\n                                // Pick only \"valid\" values, as otherwise null would override the previous value\n                                options={{ ...plotOptions, ...pickBy(config.plotOptions, (v) => v) }}\n                                hover={hover}\n                                setHover={setHover}\n                                selected={selection}\n                                setSelected={setSelection}\n                                xAccessor={`projection[${config.projection}][0]`}\n                                yAccessor={`projection[${config.projection}][1]`}\n                              />\n                            </GridItemOptions>\n                          )) as any\n                      }\n                    </Grid>\n                  </div>\n                </details>\n\n                <StructureCardGrid\n                  collections={visibleCollections}\n                  selected={selection}\n                  setSelected={setSelection}\n                  setFiltered={setFiltered}\n                  tableClass=\"main-ranking\"\n                  structureCardProps={(structure) => ({\n                    className: structure === hover ? \"border-primary\" : structure.selected ? \"border-secondary\" : \"\",\n                  })}\n                  renderTopForm={\n                    <>\n                      <div className=\"form-check form-switch me-sm-2\">\n                        <input\n                          type=\"checkbox\"\n                          className=\"form-check-input\"\n                          id=\"customSwitch1\"\n                          checked={showSelectedOnly}\n                          onChange={(e) => setShowSelectedOnly(e.currentTarget.checked)}\n                        />\n                        <label className=\"form-check-label\" htmlFor=\"customSwitch1\">\n                          Show selected only\n                        </label>\n                      </div>\n                      <button\n                        className=\"btn btn-sm btn-primary\"\n                        disabled={!selection}\n                        onClick={() => {\n                          setInterpolationStructures(\n                            Object.values(selection!)\n                              .flat()\n                              .map(({ structure }) => structure)\n                          );\n                          setActiveTab(EActiveTabs.INTERPOLATION);\n                        }}\n                      >\n                        Use for interpolation\n                      </button>\n                    </>\n                  }\n                />\n              </>\n            ) : null}\n          </LoadingPage>\n        </div>\n        <div>\n          {/* <HorizontalCollapse\n        label=\"Collections\"\n        position=\"right\"\n        size=\"col-md-4\"\n        collapsed={clusterCollapsed}\n        setCollapsed={setClusterCollapsed}\n      > */}\n          <ReactResizeDetector handleWidth>\n            {({ width, height }) => (\n              <div\n                style={{\n                  height: \"100%\",\n                  overflow: \"auto\",\n                  paddingRight: 15,\n                }}\n              >\n                {width! > 200 ? (\n                  <ClusterSidePanel\n                    collections={collections}\n                    setCollections={setCollections}\n                    selection={selection}\n                    setSelection={setSelection}\n                    setVisibleNeighborhoodSamplings={setVisibleNeighborhoodSamplings}\n                    hover={hover}\n                    setHover={setHover}\n                  />\n                ) : (\n                  <span style={{ transform: \"rotate(90deg)\", position: \"absolute\", top: \"50%\", whiteSpace: \"nowrap\" }}>\n                    Additional Options\n                  </span>\n                )}\n              </div>\n            )}\n          </ReactResizeDetector>\n          {/* </HorizontalCollapse> */}\n        </div>\n      </Split>\n    </>\n  );\n}\n","import { ReportHandler } from \"web-vitals\";\n\nconst reportWebVitals = (onPerfEntry?: ReportHandler) => {\n  if (onPerfEntry && onPerfEntry instanceof Function) {\n    import(\"web-vitals\").then(({ getCLS, getFID, getFCP, getLCP, getTTFB }) => {\n      getCLS(onPerfEntry);\n      getFID(onPerfEntry);\n      getFCP(onPerfEntry);\n      getLCP(onPerfEntry);\n      getTTFB(onPerfEntry);\n    });\n  }\n};\n\nexport default reportWebVitals;\n","import React from \"react\";\nimport ReactDOM from \"react-dom\";\nimport \"@fortawesome/fontawesome-free/css/all.min.css\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport \"lineupjs/build/LineUpJS.css\";\nimport \"react-grid-layout/css/styles.css\";\nimport \"react-resizable/css/styles.css\";\nimport \"./scss/main.css\";\nimport App from \"./App\";\nimport reportWebVitals from \"./reportWebVitals\";\n\nReactDOM.render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>,\n  document.getElementById(\"root\")\n);\n\n// If you want to start measuring performance in your app, pass a function\n// to log results (for example: reportWebVitals(console.log))\n// or send to an analytics endpoint. Learn more: https://bit.ly/CRA-vitals\nreportWebVitals();\n","import { stringifyWithoutCycles } from \".\";\nimport { IInterpolatedParticle, IParticle, IRegistry, IServerCollection } from \"../interfaces\";\n\nfunction fetchRaw({ url, data, method = \"POST\" }: { url: string; data?: any; method?: string }): Promise<Response> {\n  return fetch(url, {\n    headers: {\n      \"Content-Type\": \"application/json\",\n    },\n    // @ts-ignore\n    // mode: '*cors', // no-cors, *cors, same-origin\n    method,\n    redirect: \"follow\",\n    body: stringifyWithoutCycles(data),\n  }).then(async (res) => {\n    if (!res.ok) {\n      throw Error((await res.json().catch(() => null))?.message || res.statusText);\n    }\n    return res;\n  });\n}\n\nfunction fetchJSON<T>(url: string, data: any): Promise<T> {\n  return fetchRaw({ url, data }).then((res) => res.json());\n}\n\nfunction fetchText(url: string, data: any): Promise<string> {\n  return fetchRaw({ url, data }).then((res) => res.text());\n}\n\nexport function runMSO(options: {\n  structure: string;\n  iterations?: number;\n  num_swarms?: number;\n  num_part?: number;\n  v_min?: number;\n  v_max?: number;\n  inertia_weight?: number;\n  phi1?: number;\n  phi2?: number;\n  phi3?: number;\n  objectives: any[];\n}): Promise<IServerCollection<IParticle>> {\n  return fetchJSON(\"/api/pso/\", options);\n}\n\nexport function embedStructures(data: {\n  structures: {\n    smiles: string;\n    embeddings?: {[key: string]: number[]};\n  }[];\n  include_embedding?: boolean;\n}): Promise<IServerCollection<IParticle>> {\n  return fetchJSON<IServerCollection<IParticle>>(\"/api/embedding/\", data);\n}\n\nexport function getChemblUMAPEmbedding(): Promise<IParticle[]> {\n  return fetchRaw({\n    url: \"/api/embedding/\",\n    method: \"GET\",\n  }).then((res) => res.json());\n}\n\nexport function interpolateStructures(\n  structures: string[],\n  maxSamples?: number\n): Promise<IServerCollection<IInterpolatedParticle>> {\n  return fetchJSON(\"/api/interpolation/\", {\n    structures,\n    maxSamples,\n  });\n}\n\nexport function getImageURL(\n  structure: string,\n  substructure: string | null = null,\n  align: string | null = null\n): string {\n  return `/api/image/?structure=${encodeURIComponent(structure)}${\n    substructure ? `&substructure=${encodeURIComponent(substructure)}` : \"\"\n  }${align ? `&align=${encodeURIComponent(align)}` : \"\"}`;\n}\n\nexport function getReducedImages(\n  structures: string[],\n  method: \"single\" | \"murcko\" | \"mcs\" | \"similarity\" | \"auto\" = \"auto\"\n): Promise<string | null> {\n  return fetchText(\"/api/image/\", {\n    structures,\n    method,\n  }).catch(() => null);\n}\n\nexport function computeProjectionsWithModels(\n  particles: Pick<IParticle, 'structure' | 'embedding'>[],\n  models: { [key: string]: string }\n): Promise<{\n  projections: IServerCollection[\"projections\"];\n  projection: { [key: string]: number[][] };\n  additional?: { [key: string]: number[][] | null };\n}> {\n  return fetchJSON(\"/api/projection/models\", {\n    particles: particles.map((p) => ({structure: p.structure, embedding: p.embedding})),\n    models,\n  });\n}\n\nexport function hasSubstructureMatch(\n  structures: string[],\n  smarts: string\n): Promise<{\n  validity: { [key: string]: boolean };\n  counts: { [key: string]: number };\n}> {\n  return fetchJSON(\"/api/mol/substructures/\", {\n    structures,\n    smarts,\n  });\n}\n\nexport function getTanimotoSimilarity(\n  structures: string[],\n  reference: string,\n  fingerprint: string\n): Promise<{\n  tanimoto: { [key: string]: number };\n}> {\n  return fetchJSON(\"/api/mol/tanimoto/\", {\n    structures,\n    reference,\n    fingerprint,\n  });\n}\n\nexport function getNeighborSamples(\n  structure: string,\n  samples: number,\n  method: string,\n  scale: number\n): Promise<IServerCollection<IInterpolatedParticle>> {\n  return fetchJSON(\"/api/sampling/\", {\n    structure,\n    samples,\n    method,\n    scale,\n  });\n}\n\nexport function getMatchedMolecularPairs(options: {\n  structure: string;\n  min_variable_size?: number;\n  max_variable_size?: number;\n  min_constant_size?: number;\n  min_radius?: number;\n  min_pairs?: number;\n  substructure?: string;\n}): Promise<{\n  structures: string[];\n}> {\n  return fetchJSON(\"/api/mmp/\", options);\n}\n\nexport function getStonedSelfies(options: {\n  structure: string;\n  substructure: string;\n  random_samples?: number;\n  max_mutations?: number;\n}): Promise<{\n  structures: string[];\n}> {\n  return fetchJSON(\"/api/stoned_selfies/\", options);\n}\n\nexport function getRegistry(): Promise<IRegistry> {\n  return fetchRaw({\n    url: \"/api/registry/\",\n    method: \"GET\",\n  }).then((res) => res.json());\n}\n","import throttle from \"lodash.throttle\";\nimport * as React from \"react\";\nimport * as ReactDOM from \"react-dom\";\nimport {CollectionContext} from '../CollectionContext';\n\nexport function useSyncedRef<T>(value: T): React.MutableRefObject<T> {\n  const valueRef = React.useRef<T>(value);\n  valueRef.current = value;\n  return valueRef;\n}\n\nexport const useMousePosition = (active: boolean): { x: number; y: number } | null => {\n  const [position, setPosition] = React.useState<{\n    x: number;\n    y: number;\n  } | null>(null);\n\n  React.useEffect(() => {\n    if (active) {\n      const setFromEvent = throttle((e: MouseEvent) => setPosition({ x: e.clientX, y: e.clientY }), 5);\n      window.addEventListener(\"mousemove\", setFromEvent);\n\n      return () => {\n        window.removeEventListener(\"mousemove\", setFromEvent);\n      };\n    } else {\n      setPosition(null);\n    }\n  }, [active]);\n\n  return position;\n};\n\nexport const Tooltip = ({ children, anchor = 'right' }: { children: React.ReactNode, anchor?: 'top' | 'right' }) => {\n  const [node, setNode] = React.useState<HTMLDivElement | null>(null);\n  const position = useMousePosition(Boolean(node && children));\n\n  React.useEffect(() => {\n    const container = document.createElement(\"div\");\n    container.style.position = \"absolute\";\n    container.style.pointerEvents = \"none\";\n    container.style.transform = anchor === 'right' ? \"translate(10%, -50%)\" : \"translate(-50%, 5%)\";\n    container.style.zIndex = \"10000\";\n    document.body.appendChild(container);\n    setNode(container);\n\n    return () => {\n      document.body.removeChild(container);\n    };\n  }, [anchor]);\n\n  React.useEffect(() => {\n    if (node) {\n      if (position) {\n        node.style.left = `${position.x}px`;\n        node.style.top = `${position.y}px`;\n        node.style.display = \"block\";\n      } else {\n        node.style.display = \"none\";\n      }\n    }\n  }, [node, position]);\n\n  return node && children && position ? ReactDOM.createPortal(children, node) : null;\n};\n\nexport function usePrevious<T>(value: T | null): T | null {\n  // The ref object is a generic container whose current property is mutable ...\n  // ... and can hold any value, similar to an instance property on a class\n  const ref = React.useRef<T | null>(null);\n\n  // Store current value in ref\n  React.useEffect(() => {\n    ref.current = value;\n  }, [value]); // Only re-run if value changes\n\n  // Return previous value (happens before update in useEffect above)\n  return ref.current;\n}\n\n\nexport function useNameInput(id: string, initialValue: string): [string, React.Dispatch<React.SetStateAction<string>>, React.ReactNode] {\n  const [name, setName] = React.useState<string>(\"\");\n  const uniqueRef = React.useRef(id);\n  const collections = React.useContext(CollectionContext);\n\n  // Remove any [ ] . characters as they are matched with lodash.get and break lineup for example.\n  const currentName = (name || initialValue).replaceAll(/\\[|\\]|\\./g, '_');\n\n  const nameAlreadyTaken = collections.some((c) => c.name === currentName);\n\n  return [currentName, setName, <div className=\"mb-3\">\n    <label htmlFor={uniqueRef.current}>Name</label>\n    <input\n      type=\"text\"\n      className={`form-control form-control-sm ${nameAlreadyTaken ? \"is-invalid\" : \"\"}`}\n      id={uniqueRef.current}\n      required={nameAlreadyTaken ? true : !initialValue} // Required depends if we have a valid placeholder\n      pattern={nameAlreadyTaken ? '^$' : undefined} // Add a regex matching only the empty string if the name is already taken\n      value={name}\n      placeholder={initialValue}\n      onChange={(e) => setName(e.currentTarget.value)}\n    />\n    {nameAlreadyTaken ? (\n      <div className=\"invalid-feedback\">Collection with this name already exists.</div>\n    ) : null}\n  </div>];\n}\n\nexport function timeIt<T>(name: string, f: () => T): T {\n  console.time(name);\n  const result = f();\n  console.timeEnd(name);\n  return result;\n}","import * as React from \"react\";\n\nexport const DetailsSummaryWrapper = ({\n  open = false,\n  lead = true,\n  title,\n  children,\n}: {\n  open?: boolean;\n  lead?: boolean;\n  title: React.ReactNode;\n  children: React.ReactNode;\n}) => {\n\n  return (\n    <details open={open}>\n      <summary className={`d-flex ${lead ? 'lead' : ''}`} style={{alignItems: 'center'}}>{title}</summary>\n      {children}\n    </details>\n  );\n};\n","import * as React from \"react\";\nimport { Alert } from \"react-bootstrap\";\nimport { DetailsSummaryWrapper } from \"./DetailsSummaryWrapper\";\n\nexport const FormWrapper = ({\n  open = false,\n  title,\n  loading = false,\n  setLoading = () => null,\n  onSubmit,\n  children,\n}: {\n  open?: boolean;\n  title: React.ReactNode;\n  loading?: boolean;\n  setLoading?(loading: boolean): void;\n  onSubmit(): void | Promise<any>;\n  children: React.ReactNode;\n}) => {\n  const [error, setError] = React.useState<string | null>(null);\n\n  return (\n    <DetailsSummaryWrapper open={open} title={title}>\n      <form\n        onSubmit={async (e) => {\n          e.preventDefault();\n          e.stopPropagation();\n\n          if (e.currentTarget.reportValidity()) {\n            setLoading(true);\n\n            try {\n              setError(null);\n              await onSubmit();\n            } catch (e) {\n              console.error(e);\n              setError(e.toString());\n            }\n\n            setLoading(false);\n          }\n        }}\n      >\n        {error ? (\n          <Alert variant=\"danger\" onClose={() => setError(null)} dismissible>\n            <p>{error}</p>\n          </Alert>\n        ) : null}\n        {children}\n      </form>\n\n    </DetailsSummaryWrapper>\n  );\n};\n","import { extent } from \"d3-array\";\nimport { scaleLinear } from \"d3-scale\";\n\nexport function normalizeArray<T extends number | number[]>(\n  list: T,\n  range: [number, number],\n  domain?: [number | undefined, number | undefined]\n): T {\n  if (typeof list === \"number\" || !Array.isArray(list)) {\n    return list;\n  }\n  if (!domain) {\n    domain = extent(list);\n  }\n  if (typeof domain[0] !== \"number\" || typeof domain[1] !== \"number\") {\n    return list;\n  }\n  if (domain[0] === domain[1] && domain[0] >= range[0] && domain[0] <= range[1]) {\n    return list;\n  }\n  var scale = scaleLinear()\n    .domain(domain as [number, number])\n    .range(range);\n  return list.map((n) => scale(n)) as any;\n}\n\nexport function toNumber(n: number | string | null | boolean | undefined, def: number = 0): number {\n  if (n == null) {\n    return def;\n  }\n  if (n === true) {\n    return 1;\n  } else if (n === false) {\n    return 0;\n  }\n  const v = parseFloat(n.toString());\n  return isNaN(v) ? def : v;\n}\n\nexport function toExtent<T>(\n  data: T[],\n  getter: (d: T) => [number, number] | [undefined, undefined] | undefined\n): [number, number] | [undefined, undefined] {\n  return data.reduce<[number, number] | [undefined, undefined]>(\n    (acc, d) => {\n      const current = getter(d);\n      if (current) {\n        if (acc[0] == null || (current[0] != null && current[0]! < acc[0]!)) {\n          acc[0] = current[0];\n        }\n        if (acc[1] == null || (current[1] != null && current[1]! > acc[1]!)) {\n          acc[1] = current[1];\n        }\n      }\n      return acc;\n    },\n    [undefined, undefined]\n  );\n}\n\nexport function stringifyWithoutCycles(data: any): string {\n  return JSON.stringify(data, (key, value) => {\n    if (key === \"knn_particles\") {\n      return null;\n    }\n    return value;\n  });\n}\n\nexport async function downloadFile(blob: Blob, name: string) {\n  const href = await URL.createObjectURL(blob);\n  const link = document.createElement(\"a\");\n  link.href = href;\n  link.download = name;\n  document.body.appendChild(link);\n  link.click();\n  document.body.removeChild(link);\n}\n\nexport async function downloadJSONFile(data: any, name: string) {\n  const json = stringifyWithoutCycles(data);\n  const blob = new Blob([json], { type: \"application/json\" });\n  downloadFile(blob, name + \".json\");\n}\n\nexport async function downloadCSVFile(data: string, name: string) {\n  const blob = new Blob([data], { type: \"text/csv\" });\n  downloadFile(blob, name + \".csv\");\n}\n\n/**\n * Injects a cached getter function into an object.\n * @param object Object to be inejected into.\n * @param key Key of the newly injected getter.\n * @param valueCreator Function returning the value of the injected getter.\n * @param options Options.\n */\nexport function injectGetter<T>(object: object, key: PropertyKey, valueCreator: () => T, {\n  cache = true\n}: {\n  cache?: boolean;\n} = {}): void {\n  Object.defineProperty(object, key, {\n    get: function () {\n      const value = valueCreator();\n      if(cache) {\n        // Remove the getter function.\n        delete (object as any)[key];\n        // Assign the actual value and return it.\n        // return ((object as any)[key] = value);\n        // Inject the getter again instead, now without the \"replace\" logic.\n        injectGetter(object, key, () => value, { cache: false });\n      }\n      return value;\n    },\n    configurable: true,\n    enumerable: true,\n  });\n}\n","import * as React from \"react\";\nimport { getImageURL, getReducedImages } from \"../utils/api\";\nimport { svgToImageSrc } from \"./ranking/StructureImageRenderer\";\n\nexport const StructureImage = React.memo(\n  ({\n    structure,\n    align,\n    image,\n    ...innerProps\n  }: {\n    structure: string | string[];\n    align?: string;\n    image?: string;\n  } & React.ImgHTMLAttributes<HTMLImageElement>) => {\n    const [src, setSrc] = React.useState<string | undefined | null>(undefined);\n\n    const text = /* Array.isArray(structure)\n      ? `Common structure of ${structure.length} structure`\n      : `Structure of ${structure}` */ '';\n\n    React.useEffect(() => {\n      if(image) {\n        setSrc(svgToImageSrc(image));\n      } else if (Array.isArray(structure)) {\n        getReducedImages(structure).then((res) => {\n          setSrc(res ? svgToImageSrc(res) : null);\n        });\n      } else {\n        setSrc(getImageURL(structure, null, align));\n      }\n    }, [structure, image, align]);\n\n    return src ? (\n      <img\n        src={src}\n        alt={text}\n        title={text}\n        loading={\"lazy\"}\n        onLoad={(e) => (e.currentTarget.style.visibility = \"visible\")}\n        onError={(e) => (e.currentTarget.style.visibility = \"hidden\")}\n        {...(innerProps || {})}\n      />\n    ) : (src === undefined ? (\n      <div style={{ ...(innerProps?.style || {}), display: \"flex\", justifyContent: \"center\" }}>\n        <span className=\"spinner-grow spinner-grow-sm\" role=\"status\" aria-hidden=\"true\" />\n      </div>\n    ) : null);\n  }\n);\n","export const DEFAULT_COLORWAY = [\n  \"#4e79a7\",\n  \"#f28e2c\",\n  \"#e15759\",\n  \"#76b7b2\",\n  \"#59a14f\",\n  \"#edc949\",\n  \"#af7aa1\",\n  \"#ff9da7\",\n  \"#9c755f\",\n  \"#bab0ab\",\n];\n\nexport const ARRAY_DISTANCE_METRICS: { [key: string]: (value: number, values: number[]) => number } = {\n  euclidean_difference: (value, values) => Math.sqrt(values.reduce((acc, cur) => acc + Math.pow(cur - value, 2), 0)),\n  mean: (value, values) => values.reduce((acc, cur) => acc + Math.abs(cur), 0) / values.length,\n  mean_rel_diff: (value, values) => values.reduce((acc, cur) => acc + Math.abs(cur), 0) / values.length / value,\n  mean_rel_diff_log10: (value, values) =>\n    values.reduce((acc, cur) => acc + Math.log10(Math.abs(cur)), 0) / values.length / Math.log10(value),\n  max: (value, values) => Math.max(...values),\n  max_difference: (value, values) => Math.abs(Math.abs(value) - Math.abs(Math.max(...values))),\n  min: (value, values) => Math.min(...values),\n  min_difference: (value, values) => Math.abs(Math.abs(value) - Math.abs(Math.min(...values))),\n};\n\nexport const isProxySymbol = Symbol(\"isProxy\");\n\nexport const DEFAULT_PLOTLY_COLORSCALE = {\n  colorscale: [\n    [\"0\", \"#D0EBFF\"],\n    [\"0.5\", \"#49a7bd\"],\n    [\"1.0\", \"#31347a\"],\n  ],\n  reversescale: false,\n};\n","export interface INearestNeighbors {\n  distance_metric: string;\n  knn_dist: number[];\n  knn_ind: number[];\n  knn_particles: IParticle[];\n}\n\nexport interface IParticle {\n  selected?: boolean;\n  collection: string;\n  index?: number;\n  structure: string;\n  original_structure?: string;\n  images?: string[];\n  embedding?: { [key: string]: number[] };\n  nearest_neighbors?: {\n    [key: string | symbol]: INearestNeighbors;\n  };\n  clusters?: {\n    [key: string | symbol]: {\n      distance_metric: string;\n      label: number;\n    };\n  };\n  properties: {\n    [key: string | symbol]: string | number | boolean | null | undefined;\n  };\n  projection: { [key: string]: number[] };\n}\n\nexport function isParticle(p: any): p is IParticle {\n  return p.structure && p.projection;\n}\n\nexport const DEFAULT_COLLECTION = \"Particles\";\nexport const DEFAULT_CHEMBL_COLLECTION = \"ChEMBL\";\n\nexport interface IPlotOptions {\n  colorBy: string | null;\n  opacityBy: number | string | null;\n  groupBy: string | null;\n  connectBy: string[] | null;\n  sizeBy: string | null;\n}\n\nexport interface IEnabledProjection {\n  label: string;\n  value: string;\n  projection: string | null;\n  plotOptions: Partial<IPlotOptions>;\n}\n\nexport interface IServerCollection<T extends IParticle = IParticle> {\n  data: T[];\n  projections?: {\n    [key: string]: {\n      trustworthiness?: number;\n      trustworthiness_additional?: number;\n      explained_variance?: number;\n      model?: string;\n    };\n  };\n}\n\nexport interface ICollection<T extends IParticle = IParticle> extends IServerCollection<T> {\n  name: string;\n  type?: \"neighborhoodSampling\";\n  hidden?: boolean;\n  plotOptions?: Partial<IPlotOptions>;\n}\n\nexport interface IInterpolatedParticle extends IParticle {\n  scaffold: boolean;\n}\n\nexport interface IObjective {\n  description: string;\n  name: string;\n  weight: number;\n  desirability: { x: number; y: number }[];\n  additional_args?: { [key: string]: string };\n}\nexport interface IRegistry {\n  objectives: IObjective[];\n}\n\nexport declare type IParticleSelection = { [key: string]: IParticle[] } | null;\n\nexport enum EActiveTabs {\n  EMBEDDING,\n  INTERPOLATION,\n}\n"],"sourceRoot":""}